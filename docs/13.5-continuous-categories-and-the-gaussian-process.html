<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="13.5 Continuous categories and the Gaussian process | Notes for Statistical Rethinking 2nd ed. by Richard McElreath" />
<meta property="og:type" content="book" />






<meta name="date" content="2021-12-04" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="13.5 Continuous categories and the Gaussian process | Notes for Statistical Rethinking 2nd ed. by Richard McElreath">

<title>13.5 Continuous categories and the Gaussian process | Notes for Statistical Rethinking 2nd ed. by Richard McElreath</title>

<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#index">Index</a></li>
<li><a href="1-the-golem-of-prague.html#the-golem-of-prague"><span class="toc-section-number">1</span> The Golem of Prague</a></li>
<li class="has-sub"><a href="2-small-worlds-and-large-worlds.html#small-worlds-and-large-worlds"><span class="toc-section-number">2</span> Small Worlds and Large Worlds</a>
<ul>
<li><a href="2.1-the-garden-of-forking-data.html#the-garden-of-forking-data"><span class="toc-section-number">2.1</span> The garden of forking data</a></li>
<li><a href="2.2-building-a-model.html#building-a-model"><span class="toc-section-number">2.2</span> Building a model</a></li>
<li><a href="2.3-components-of-the-model.html#components-of-the-model"><span class="toc-section-number">2.3</span> Components of the model</a></li>
<li class="has-sub"><a href="2.4-making-the-model-go.html#making-the-model-go"><span class="toc-section-number">2.4</span> Making the model go</a>
<ul>
<li><a href="2.4-making-the-model-go.html#markov-chain-monte-carlo"><span class="toc-section-number">2.4.1</span> Markov chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="3-sampling-from-the-imaginary.html#sampling-from-the-imaginary"><span class="toc-section-number">3</span> Sampling from the Imaginary</a>
<ul>
<li><a href="3.1-sampling-from-a-grid-approximate-posterior.html#sampling-from-a-grid-approximate-posterior"><span class="toc-section-number">3.1</span> Sampling from a grid-approximate posterior</a></li>
<li><a href="3.2-sampling-to-summarize.html#sampling-to-summarize"><span class="toc-section-number">3.2</span> Sampling to summarize</a></li>
<li><a href="3.3-sampling-to-simulate-prediction.html#sampling-to-simulate-prediction"><span class="toc-section-number">3.3</span> Sampling to simulate prediction</a></li>
<li><a href="3.4-lets-practice-with-brms.html#lets-practice-with-brms"><span class="toc-section-number">3.4</span> Let’s practice with brms</a></li>
<li><a href="practice.html#practice">Practice</a></li>
<li><a href="homework-week-1.html#homework-week-1">Homework: week 1</a></li>
</ul></li>
<li class="has-sub"><a href="4-geocentric-models.html#geocentric-models"><span class="toc-section-number">4</span> Geocentric Models</a>
<ul>
<li><a href="4.1-why-normal-distributions-are-normal.html#why-normal-distributions-are-normal"><span class="toc-section-number">4.1</span> Why normal distributions are normal</a></li>
<li><a href="4.2-a-language-for-describing-models.html#a-language-for-describing-models"><span class="toc-section-number">4.2</span> A language for describing models</a></li>
<li><a href="4.3-gaussian-model-of-height.html#gaussian-model-of-height"><span class="toc-section-number">4.3</span> Gaussian model of height</a></li>
<li><a href="4.4-linear-prediction.html#linear-prediction"><span class="toc-section-number">4.4</span> Linear prediction</a></li>
<li><a href="4.5-curves-from-lines.html#curves-from-lines"><span class="toc-section-number">4.5</span> Curves from lines</a></li>
<li><a href="4.6-practice-1.html#practice-1"><span class="toc-section-number">4.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="5-the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles"><span class="toc-section-number">5</span> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li><a href="5.1-spurious-association.html#spurious-association"><span class="toc-section-number">5.1</span> Spurious association</a></li>
<li><a href="5.2-masked-relationship.html#masked-relationship"><span class="toc-section-number">5.2</span> Masked relationship</a></li>
<li><a href="5.3-categorical-variables.html#categorical-variables"><span class="toc-section-number">5.3</span> Categorical variables</a></li>
<li><a href="5.4-practice-2.html#practice-2"><span class="toc-section-number">5.4</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="6-the-haunted-dag-the-causal-terror.html#the-haunted-dag-the-causal-terror"><span class="toc-section-number">6</span> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li><a href="6.1-multicollinearity.html#multicollinearity"><span class="toc-section-number">6.1</span> Multicollinearity</a></li>
<li><a href="6.2-post-treatment-bias.html#post-treatment-bias"><span class="toc-section-number">6.2</span> Post-treatment bias</a></li>
<li><a href="6.3-collider-bias.html#collider-bias"><span class="toc-section-number">6.3</span> Collider bias</a></li>
<li><a href="6.4-confronting-confounding.html#confronting-confounding"><span class="toc-section-number">6.4</span> Confronting confounding</a></li>
<li><a href="6.5-summary.html#summary"><span class="toc-section-number">6.5</span> Summary</a></li>
<li><a href="6.6-practice-3.html#practice-3"><span class="toc-section-number">6.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="7-ulysses-compass.html#ulysses-compass"><span class="toc-section-number">7</span> Ulysses’ Compass</a>
<ul>
<li><a href="7.1-the-problem-with-parameters.html#the-problem-with-parameters"><span class="toc-section-number">7.1</span> The problem with parameters</a></li>
<li><a href="7.2-entropy-and-accuracy.html#entropy-and-accuracy"><span class="toc-section-number">7.2</span> Entropy and accuracy</a></li>
<li><a href="7.3-golem-taming-regularization.html#golem-taming-regularization"><span class="toc-section-number">7.3</span> Golem taming: regularization</a></li>
<li><a href="7.4-predicting-predictive-accuracy.html#predicting-predictive-accuracy"><span class="toc-section-number">7.4</span> Predicting predictive accuracy</a></li>
<li><a href="7.5-model-comparison.html#model-comparison"><span class="toc-section-number">7.5</span> Model comparison</a></li>
<li><a href="7.6-practice-4.html#practice-4"><span class="toc-section-number">7.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="8-conditional-manatees.html#conditional-manatees"><span class="toc-section-number">8</span> Conditional Manatees</a>
<ul>
<li><a href="8.1-building-an-interaction.html#building-an-interaction"><span class="toc-section-number">8.1</span> Building an interaction</a></li>
<li><a href="8.2-symmetry-of-interactions.html#symmetry-of-interactions"><span class="toc-section-number">8.2</span> Symmetry of interactions</a></li>
<li><a href="8.3-continuous-interactions.html#continuous-interactions"><span class="toc-section-number">8.3</span> Continuous interactions</a></li>
</ul></li>
<li class="has-sub"><a href="9-markov-chain-monte-carlo-1.html#markov-chain-monte-carlo-1"><span class="toc-section-number">9</span> Markov Chain Monte Carlo</a>
<ul>
<li><a href="9.1-good-king-markov-and-his-island-kingdom.html#good-king-markov-and-his-island-kingdom"><span class="toc-section-number">9.1</span> Good King Markov and his island kingdom</a></li>
<li><a href="9.2-metropolis-algorithm.html#metropolis-algorithm"><span class="toc-section-number">9.2</span> Metropolis algorithm</a></li>
<li><a href="9.3-hamiltonian-monte-carlo.html#hamiltonian-monte-carlo"><span class="toc-section-number">9.3</span> Hamiltonian Monte Carlo</a></li>
<li><a href="9.4-easy-hmc-ulam.html#easy-hmc-ulam"><span class="toc-section-number">9.4</span> Easy HMC: <code>ulam</code></a></li>
<li><a href="9.5-care-and-feeding-of-your-markov-chain.html#care-and-feeding-of-your-markov-chain"><span class="toc-section-number">9.5</span> Care and feeding of your Markov chain</a></li>
</ul></li>
<li class="has-sub"><a href="10-big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model"><span class="toc-section-number">10</span> Big Entropy and the Generalized Linear Model</a>
<ul>
<li><a href="10.1-maximum-entropy.html#maximum-entropy"><span class="toc-section-number">10.1</span> Maximum entropy</a></li>
<li><a href="10.2-generalized-linear-models.html#generalized-linear-models"><span class="toc-section-number">10.2</span> Generalized linear models</a></li>
</ul></li>
<li class="has-sub"><a href="11-god-spiked-the-integers.html#god-spiked-the-integers"><span class="toc-section-number">11</span> God Spiked the Integers</a>
<ul>
<li><a href="11.1-binomial-regression.html#binomial-regression"><span class="toc-section-number">11.1</span> Binomial regression</a></li>
<li><a href="11.2-poisson-regression.html#poisson-regression"><span class="toc-section-number">11.2</span> Poisson regression</a></li>
<li><a href="11.3-multinomial-and-categorical-models.html#multinomial-and-categorical-models"><span class="toc-section-number">11.3</span> Multinomial and categorical models</a></li>
</ul></li>
<li class="has-sub"><a href="12-models-with-memory.html#models-with-memory"><span class="toc-section-number">12</span> Models With Memory</a>
<ul>
<li><a href="12.1-example-multilevel-tadpoles.html#example-multilevel-tadpoles"><span class="toc-section-number">12.1</span> Example: Multilevel tadpoles</a></li>
<li><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#varying-effects-and-the-underfittingoverfitting-trade-off"><span class="toc-section-number">12.2</span> Varying effects and the underfitting/overfitting trade-off</a></li>
<li><a href="12.3-more-than-one-type-of-cluster.html#more-than-one-type-of-cluster"><span class="toc-section-number">12.3</span> More than one type of cluster</a></li>
<li><a href="12.4-divergent-transitions-and-non-centered-priors.html#divergent-transitions-and-non-centered-priors"><span class="toc-section-number">12.4</span> Divergent transitions and non-centered priors</a></li>
<li><a href="12.5-multilevel-posterior-predictions.html#multilevel-posterior-predictions"><span class="toc-section-number">12.5</span> Multilevel posterior predictions</a></li>
</ul></li>
<li class="has-sub"><a href="13-adventures-in-covariance.html#adventures-in-covariance"><span class="toc-section-number">13</span> Adventures in Covariance</a>
<ul>
<li><a href="13.1-varying-slopes-by-construction.html#varying-slopes-by-construction"><span class="toc-section-number">13.1</span> Varying slopes by construction</a></li>
<li><a href="13.2-advanced-varying-slopes.html#advanced-varying-slopes"><span class="toc-section-number">13.2</span> Advanced varying slopes</a></li>
<li><a href="13.3-instruments-and-causal-designs.html#instruments-and-causal-designs"><span class="toc-section-number">13.3</span> Instruments and causal designs</a></li>
<li><a href="13.4-social-relations-as-correlated-varying-effects.html#social-relations-as-correlated-varying-effects"><span class="toc-section-number">13.4</span> Social relations as correlated varying effects</a></li>
<li><a href="13.5-continuous-categories-and-the-gaussian-process.html#continuous-categories-and-the-gaussian-process"><span class="toc-section-number">13.5</span> Continuous categories and the Gaussian process</a></li>
<li><a href="13.6-bonus-multilevel-growth-models-and-the-melsm.html#bonus-multilevel-growth-models-and-the-melsm"><span class="toc-section-number">13.6</span> Bonus: Multilevel growth models and the MELSM</a></li>
</ul></li>
<li class="has-sub"><a href="14-missing-data-and-other-opportunities.html#missing-data-and-other-opportunities"><span class="toc-section-number">14</span> Missing Data and Other Opportunities</a>
<ul>
<li><a href="14.1-measurement-error.html#measurement-error"><span class="toc-section-number">14.1</span> Measurement error</a></li>
<li><a href="14.2-missing-data.html#missing-data"><span class="toc-section-number">14.2</span> Missing data</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="continuous-categories-and-the-gaussian-process" class="section level2" number="13.5">
<h2><span class="header-section-number">13.5</span> Continuous categories and the Gaussian process</h2>
<p>All of the varying effects so far, whether they were intercepts or slopes, have been defined over discrete, unordered categories. For example, cafés are unique places, and there is no sense in which café 1 comes before café 2.</p>
<p>But what about continuous dimensions of variation like age or income or stature? Individuals of the same age share some of the same exposures. They listened to some of the same music, heard about the same politicians, and experienced the same weather events. And individuals of similar ages also experienced some of these same exposures, but to a lesser extent than individuals of the same age.</p>
<p>It doesn’t make sense to estimate a unique varying intercept for all individuals of the same age, ignoring the fact that individuals of similar ages should have more similar intercepts.</p>
<p>Luckily, there is a way to apply the varying effects approach to continuous categories of this kind. This will allow us to estimate a unique intercept (or slope) for any age, while still regarding age as a continuous dimension in which similar ages have more similar intercepts (or slopes). The general approach is known as GAUSSIAN PROCESS REGRESSION.</p>
<div class="figure">
<img src="slides/L19/01.png" alt="Get to take everything we've learned and put it together." width="80%" />
<p class="caption marginnote shownote">
Get to take everything we’ve learned and put it together.
</p>
</div>
<div class="figure">
<img src="slides/L19/02.png" alt="Data story. General phenomoent that doesn't just applhy to American politics. Birth year of voters. On the veritcal we have the Republican vote share of individuals in that birth year. Share of the vote they have to the presidential candidates in that year. Each of the colours is a different election year. As you get closer to the present, younger people are allowed to vote, so you can seee the curves are shifting to the left. If you plotted this graph by age, you would see this view. Interesting view that the hills and valleys line up, even though in any particular year it can move up and down quite a lot. 2008 is much lower down across all age groups. Bu tthe peaks and valleys are in teh same place. These are cohort effecs. Something abou thteh year you're born in sets your politial preference for live. It's something that heppns to people born around that time that happens in their life. " width="80%" />
<p class="caption marginnote shownote">
Data story. General phenomoent that doesn’t just applhy to American politics. Birth year of voters. On the veritcal we have the Republican vote share of individuals in that birth year. Share of the vote they have to the presidential candidates in that year. Each of the colours is a different election year. As you get closer to the present, younger people are allowed to vote, so you can seee the curves are shifting to the left. If you plotted this graph by age, you would see this view. Interesting view that the hills and valleys line up, even though in any particular year it can move up and down quite a lot. 2008 is much lower down across all age groups. Bu tthe peaks and valleys are in teh same place. These are cohort effecs. Something abou thteh year you’re born in sets your politial preference for live. It’s something that heppns to people born around that time that happens in their life.
</p>
</div>
<div class="figure">
<img src="slides/L19/03.png" alt="They fit a bit heirarchical Bayesian model to find the age it is that sets their poltical orientation. What matters is that when your're 18, who is present, what party theyr'e from, and are they popular. THen you can predict their political orientation for the rest of their life. Things that happen when you're older don't have nearly as much of an effect. Year of birth is linear, but also a category. It's an orderd category. If we can to take effects like this seriously, we need to take them into account. Called continuous cateogries. Trough in 1950 is the Nixon effect. Most conservative is the Reagan effect. He was winnign the Cold War. " width="80%" />
<p class="caption marginnote shownote">
They fit a bit heirarchical Bayesian model to find the age it is that sets their poltical orientation. What matters is that when your’re 18, who is present, what party theyr’e from, and are they popular. THen you can predict their political orientation for the rest of their life. Things that happen when you’re older don’t have nearly as much of an effect. Year of birth is linear, but also a category. It’s an orderd category. If we can to take effects like this seriously, we need to take them into account. Called continuous cateogries. Trough in 1950 is the Nixon effect. Most conservative is the Reagan effect. He was winnign the Cold War.
</p>
</div>
<div class="figure">
<img src="slides/L19/04.png" alt="You can assert that they have linear effects, but then you're giving up on thise non-monotonic cohort effects. Or ny number of other interesting things as well, like income. No reaon that every paddditnoal percent of income has the same effect. How is location a category? It's a proxy of things you haven't measured. Location is a proxy for common exposures. Phylogentic distance analagous to location. No obvious cutpoints, but similar values are similar in their effects. If you want an infinite number of categories, buecasue it's continuous, you want pooling. So we'll make models with infiinte cateogories, and fit arbitrary function swith pooling, and it'll work great. In machine learning is Gaussain process regression. " width="80%" />
<p class="caption marginnote shownote">
You can assert that they have linear effects, but then you’re giving up on thise non-monotonic cohort effects. Or ny number of other interesting things as well, like income. No reaon that every paddditnoal percent of income has the same effect. How is location a category? It’s a proxy of things you haven’t measured. Location is a proxy for common exposures. Phylogentic distance analagous to location. No obvious cutpoints, but similar values are similar in their effects. If you want an infinite number of categories, buecasue it’s continuous, you want pooling. So we’ll make models with infiinte cateogories, and fit arbitrary function swith pooling, and it’ll work great. In machine learning is Gaussain process regression.
</p>
</div>
<p><strong><em>14.5.1. Example: Spatial autocorrelation in Oceanic tools</em></strong></p>
<div class="figure">
<img src="slides/L19/05.png" alt="Two examples with code on how to do this. First is with spatial autocorrelation, where shared space is a proxy for unmeasured confounds. Let's go back to tools. Interested in predicting number of tools based on size of population. One of the problems is that islands that are close to others can just go and get the tools rather than inventing them. Certainly down near Tonga there were a lo tof effects. So distance between islands is a proxy for contact. " width="80%" />
<p class="caption marginnote shownote">
Two examples with code on how to do this. First is with spatial autocorrelation, where shared space is a proxy for unmeasured confounds. Let’s go back to tools. Interested in predicting number of tools based on size of population. One of the problems is that islands that are close to others can just go and get the tools rather than inventing them. Certainly down near Tonga there were a lo tof effects. So distance between islands is a proxy for contact.
</p>
</div>
<div class="sourceCode" id="cb1161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1161-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the distance matrix</span></span>
<span id="cb1161-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rethinking)</span>
<span id="cb1161-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(islandsDistMatrix)</span>
<span id="cb1161-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-5" aria-hidden="true" tabindex="-1"></a><span class="co"># display (measured in thousands of km)</span></span>
<span id="cb1161-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-6" aria-hidden="true" tabindex="-1"></a>d_mat <span class="ot">&lt;-</span> islandsDistMatrix</span>
<span id="cb1161-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-7" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(d_mat) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ml&quot;</span>, <span class="st">&quot;Ti&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;Ya&quot;</span>, <span class="st">&quot;Fi&quot;</span>, <span class="st">&quot;Tr&quot;</span>, <span class="st">&quot;Ch&quot;</span>, <span class="st">&quot;Mn&quot;</span>, <span class="st">&quot;To&quot;</span>, <span class="st">&quot;Ha&quot;</span>)</span>
<span id="cb1161-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1161-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1161-9" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(d_mat, <span class="dv">1</span>)</span></code></pre></div>
<pre><code>##             Ml  Ti  SC  Ya  Fi  Tr  Ch  Mn  To  Ha
## Malekula   0.0 0.5 0.6 4.4 1.2 2.0 3.2 2.8 1.9 5.7
## Tikopia    0.5 0.0 0.3 4.2 1.2 2.0 2.9 2.7 2.0 5.3
## Santa Cruz 0.6 0.3 0.0 3.9 1.6 1.7 2.6 2.4 2.3 5.4
## Yap        4.4 4.2 3.9 0.0 5.4 2.5 1.6 1.6 6.1 7.2
## Lau Fiji   1.2 1.2 1.6 5.4 0.0 3.2 4.0 3.9 0.8 4.9
## Trobriand  2.0 2.0 1.7 2.5 3.2 0.0 1.8 0.8 3.9 6.7
## Chuuk      3.2 2.9 2.6 1.6 4.0 1.8 0.0 1.2 4.8 5.8
## Manus      2.8 2.7 2.4 1.6 3.9 0.8 1.2 0.0 4.6 6.7
## Tonga      1.9 2.0 2.3 6.1 0.8 3.9 4.8 4.6 0.0 5.0
## Hawaii     5.7 5.3 5.4 7.2 4.9 6.7 5.8 6.7 5.0 0.0</code></pre>
<div class="figure">
<img src="slides/L19/06.png" alt="Here's the idea. You construct a distance matrix. Could probably do better than this based on sailing routes, but this will suffice here. This is like our map of confoud threats. What could make the tools counts similar is correlation between islands that are closer together. " width="80%" />
<p class="caption marginnote shownote">
Here’s the idea. You construct a distance matrix. Could probably do better than this based on sailing routes, but this will suffice here. This is like our map of confoud threats. What could make the tools counts similar is correlation between islands that are closer together.
</p>
</div>
<div class="sourceCode" id="cb1163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1163-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-1" aria-hidden="true" tabindex="-1"></a>d_mat <span class="sc">%&gt;%</span></span>
<span id="cb1163-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1163-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(column, distance, <span class="sc">-</span>row) <span class="sc">%&gt;%</span> </span>
<span id="cb1163-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column =</span> <span class="fu">factor</span>(column, <span class="at">levels =</span> <span class="fu">colnames</span>(d_mat)),</span>
<span id="cb1163-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">row    =</span> <span class="fu">factor</span>(row,    <span class="at">levels =</span> <span class="fu">rownames</span>(d_mat)) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(),</span>
<span id="cb1163-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="fu">formatC</span>(distance, <span class="at">format =</span> <span class="st">&#39;f&#39;</span>, <span class="at">digits =</span> <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1163-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1163-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> column, <span class="at">y =</span> row)) <span class="sc">+</span> </span>
<span id="cb1163-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> distance)) <span class="sc">+</span> </span>
<span id="cb1163-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb1163-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">3</span>, <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#100F14&quot;</span>) <span class="sc">+</span></span>
<span id="cb1163-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#A65141&quot;</span>) <span class="sc">+</span></span>
<span id="cb1163-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1163-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1163-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pearl_earring</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1163-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1163-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-130-1.png" width="672" /></p>
<div class="figure">
<img src="slides/L19/07.png" alt="Let's build the matrix into the model. We've got expected tools $\lambda$. $\alpha$ is the propoertinaly constant, i..e number of tools per member, then $\beta$ is elasticity, then $\gamma$ is the loss rate." width="80%" />
<p class="caption marginnote shownote">
Let’s build the matrix into the model. We’ve got expected tools <span class="math inline">\(\lambda\)</span>. <span class="math inline">\(\alpha\)</span> is the propoertinaly constant, i..e number of tools per member, then <span class="math inline">\(\beta\)</span> is elasticity, then <span class="math inline">\(\gamma\)</span> is the loss rate.
</p>
</div>
<div class="figure">
<img src="slides/L19/08.png" alt="We can add the Guassian process by adding a factor on the front of it. Added this exponent to the $k_{SOCIETY}. It's like a varying intercept. It's a parameter that is estimated for each society, with a normal prior, but exponentitated to make it positive. This makes it a facotr." width="80%" />
<p class="caption marginnote shownote">
We can add the Guassian process by adding a factor on the front of it. Added this exponent to the $k_{SOCIETY}. It’s like a varying intercept. It’s a parameter that is estimated for each society, with a normal prior, but exponentitated to make it positive. This makes it a facotr.
</p>
</div>
<div class="figure">
<img src="slides/L19/09.png" alt="$k$ = 0 is just the model prediction. Not inated or deflated at all. This factor is increasing or decreasing the expectation from other factors. Some will get inflated because the're near other islands with tools. If you ahd a linear model, you owulnd't do the exponnetiation, you'd just stik the $k$ on there." width="80%" />
<p class="caption marginnote shownote">
<span class="math inline">\(k\)</span> = 0 is just the model prediction. Not inated or deflated at all. This factor is increasing or decreasing the expectation from other factors. Some will get inflated because the’re near other islands with tools. If you ahd a linear model, you owulnd’t do the exponnetiation, you’d just stik the <span class="math inline">\(k\)</span> on there.
</p>
</div>
<div class="figure">
<img src="slides/L19/10.png" alt="WHere to get the $k$s from? This matrix. Big prior with all these varying effects. Big vecotr for a ll the $k$,s  10 becuase 1 for each island. Come form teh same multi-variate normal prior. How do you build this thing? Going to generate the whole matrix from that distance matrix, and use it to parameterise how the correlation falls off at distance. Going to show you the most common way to do with with so calle dL2Noral at the bottom, where each cell int he matrix $K$ is given by that expression. Note it only has three parameters in it. 300x300 matrix, which we could have by the end of the day. " width="80%" />
<p class="caption marginnote shownote">
WHere to get the <span class="math inline">\(k\)</span>s from? This matrix. Big prior with all these varying effects. Big vecotr for a ll the <span class="math inline">\(k\)</span>,s 10 becuase 1 for each island. Come form teh same multi-variate normal prior. How do you build this thing? Going to generate the whole matrix from that distance matrix, and use it to parameterise how the correlation falls off at distance. Going to show you the most common way to do with with so calle dL2Noral at the bottom, where each cell int he matrix <span class="math inline">\(K\)</span> is given by that expression. Note it only has three parameters in it. 300x300 matrix, which we could have by the end of the day.
</p>
</div>
<div class="figure">
<img src="slides/L19/11.png" alt="This is what the L2Normal matrix means. eta squared is the maximum covaiance between any two isaldn,s fit from the data. Then multplied by the thing in the middle. Rho squared i st he rateo fo decline with distance, and Distance ist he squared distance from the distance matrix. THis is the Guassian part, buecause this is a bell curve. the e(-something^2) is what gives you something gaussian. Deltaij turns sigma squared on and off. So if you have multiple observations from each island, you neex thtis factor there so they're not all predicted to be the same.  " width="80%" />
<p class="caption marginnote shownote">
This is what the L2Normal matrix means. eta squared is the maximum covaiance between any two isaldn,s fit from the data. Then multplied by the thing in the middle. Rho squared i st he rateo fo decline with distance, and Distance ist he squared distance from the distance matrix. THis is the Guassian part, buecause this is a bell curve. the e(-something^2) is what gives you something gaussian. Deltaij turns sigma squared on and off. So if you have multiple observations from each island, you neex thtis factor there so they’re not all predicted to be the same.
</p>
</div>
<div class="figure">
<img src="slides/L19/12.png" alt="Gaussian decline, or squared distance. Horitzontal is diwstance between two islands, and vertical is the correlation, standardised. And I'v e made up some values for Rho. Squared idstance function gets the solid curve. Starts with a slow decline, gthen accelerates liek a Gaussain curve. End up with this accelerating rate to get to the flat part of the tail really fast. If you choose a linear distance instead, you take the square off the D, then you get the dahssed linear curve. Nothign wrong with that, but it has a different set of assumpotions: that the rate of loss is the fastests at the start. The amount gyou lose is fastests at the start. Probably not the case." width="80%" />
<p class="caption marginnote shownote">
Gaussian decline, or squared distance. Horitzontal is diwstance between two islands, and vertical is the correlation, standardised. And I’v e made up some values for Rho. Squared idstance function gets the solid curve. Starts with a slow decline, gthen accelerates liek a Gaussain curve. End up with this accelerating rate to get to the flat part of the tail really fast. If you choose a linear distance instead, you take the square off the D, then you get the dahssed linear curve. Nothign wrong with that, but it has a different set of assumpotions: that the rate of loss is the fastests at the start. The amount gyou lose is fastests at the start. Probably not the case.
</p>
</div>
<div class="sourceCode" id="cb1164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1164-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x       =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">4</span>, <span class="at">by =</span> .<span class="dv">01</span>),</span>
<span id="cb1164-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">linear  =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> x),</span>
<span id="cb1164-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">squared =</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1164-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1164-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb1164-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> linear),</span>
<span id="cb1164-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#B1934A&quot;</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1164-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> squared),</span>
<span id="cb1164-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#DCA258&quot;</span>) <span class="sc">+</span></span>
<span id="cb1164-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;distance&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1164-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">&quot;correlation&quot;</span>, </span>
<span id="cb1164-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-12" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="dv">1</span>),</span>
<span id="cb1164-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1164-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="st">&quot;.5&quot;</span>, <span class="dv">1</span>))</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/14.38%20b-1.png" width="672" /></p>
<div class="figure">
<img src="slides/L19/13.png" alt="All we're doing is all in the prior. Varying effects drawn from one giant Gaussian. Rest of the model is what we've done before. You could have all the pariwise differece between ages, and all the particular effects.  Vector of $k$s. Priors from eta nd rho, both squared. Don't have to be squared, by why? Convention. Want to simulate from these priors and see what they imply. " width="80%" />
<p class="caption marginnote shownote">
All we’re doing is all in the prior. Varying effects drawn from one giant Gaussian. Rest of the model is what we’ve done before. You could have all the pariwise differece between ages, and all the particular effects. Vector of <span class="math inline">\(k\)</span>s. Priors from eta nd rho, both squared. Don’t have to be squared, by why? Convention. Want to simulate from these priors and see what they imply.
</p>
</div>
<div class="figure">
<img src="slides/L19/14.png" alt="If almbda is 2, the mean is 0.5. The rate is the inverse of the mean in an exponential. So sample randomly, and draw a curve. 50 samples from the prior distribution. In this prior, most fall off pretty rapidly, so the prior assumes that it could be anything from moderatley strong to aboslutely incredibly weak, but all of them drop off really fast. POsterior will look really different." width="80%" />
<p class="caption marginnote shownote">
If almbda is 2, the mean is 0.5. The rate is the inverse of the mean in an exponential. So sample randomly, and draw a curve. 50 samples from the prior distribution. In this prior, most fall off pretty rapidly, so the prior assumes that it could be anything from moderatley strong to aboslutely incredibly weak, but all of them drop off really fast. POsterior will look really different.
</p>
</div>
<div class="figure">
<img src="slides/L19/15.png" alt="As you might expect, only thing that changes is this Guassian process. Helper function in `ulam`" width="80%" />
<p class="caption marginnote shownote">
As you might expect, only thing that changes is this Guassian process. Helper function in <code>ulam</code>
</p>
</div>
<div class="figure">
<img src="slides/L19/16.png" alt="`k`s for each society, a vector of lenght 10. Just like a varying intercept vector. Come from this MVnOrmal distirbution. " width="80%" />
<p class="caption marginnote shownote">
<code>k</code>s for each society, a vector of lenght 10. Just like a varying intercept vector. Come from this MVnOrmal distirbution.
</p>
</div>
<div class="figure">
<img src="slides/L19/17.png" alt="Sigma is a 10x10 matrix. GPL2 is Gaussian process L2Norm. Do some loops to do what's on the previous slide. If you look at the Stan code, there's just a loop that calculates every trajectory. " width="80%" />
<p class="caption marginnote shownote">
Sigma is a 10x10 matrix. GPL2 is Gaussian process L2Norm. Do some loops to do what’s on the previous slide. If you look at the Stan code, there’s just a loop that calculates every trajectory.
</p>
</div>
<div class="figure">
<img src="slides/L19/18.png" alt="Action inside this is Dmat, the distance matrix, then the parameters etasq and rhosq. Then the final term, which needs to be aboe 0, But we don't fit it here because we don't have multipole observations per island." width="80%" />
<p class="caption marginnote shownote">
Action inside this is Dmat, the distance matrix, then the parameters etasq and rhosq. Then the final term, which needs to be aboe 0, But we don’t fit it here because we don’t have multipole observations per island.
</p>
</div>
<div class="sourceCode" id="cb1165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1165-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Kline2) <span class="co"># load the ordinary data, now with coordinates</span></span>
<span id="cb1165-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1165-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-3" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> </span>
<span id="cb1165-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-4" aria-hidden="true" tabindex="-1"></a>  Kline2 <span class="sc">%&gt;%</span></span>
<span id="cb1165-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">society =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1165-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1165-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(Kline2)</span>
<span id="cb1165-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1165-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1165-9" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 10
## Columns: 10
## $ culture     &lt;fct&gt; Malekula, Tikopia, Santa Cruz, Yap, Lau Fiji, Trobriand, C…
## $ population  &lt;int&gt; 1100, 1500, 3600, 4791, 7400, 8000, 9200, 13000, 17500, 27…
## $ contact     &lt;fct&gt; low, low, low, high, high, high, high, low, high, low
## $ total_tools &lt;int&gt; 13, 22, 24, 43, 33, 19, 40, 28, 55, 71
## $ mean_TU     &lt;dbl&gt; 3.2, 4.7, 4.0, 5.0, 5.0, 4.0, 3.8, 6.6, 5.4, 6.6
## $ lat         &lt;dbl&gt; -16.3, -12.3, -10.7, 9.5, -17.7, -8.7, 7.4, -2.1, -21.2, 1…
## $ lon         &lt;dbl&gt; 167.5, 168.8, 166.0, 138.1, 178.1, 150.9, 151.6, 146.9, -1…
## $ lon2        &lt;dbl&gt; -12.5, -11.2, -14.0, -41.9, -1.9, -29.1, -28.4, -33.1, 4.8…
## $ logpop      &lt;dbl&gt; 7.003065, 7.313220, 8.188689, 8.474494, 8.909235, 8.987197…
## $ society     &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</code></pre>
<p>Transform <code>lat</code> and <code>lon2</code> into 1000 km units by multiplying each by 0.11132.</p>
<div class="sourceCode" id="cb1167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1167-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1167-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb1167-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lat_adj  =</span> lat  <span class="sc">*</span> <span class="fl">0.11132</span>,</span>
<span id="cb1167-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">lon2_adj =</span> lon2 <span class="sc">*</span> <span class="fl">0.11132</span>)</span>
<span id="cb1167-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1167-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-6" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb1167-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1167-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(culture, lat, lon2, lat_adj<span class="sc">:</span>lon2_adj)</span></code></pre></div>
<pre><code>##       culture   lat  lon2   lat_adj  lon2_adj
## 1    Malekula -16.3 -12.5 -1.814516 -1.391500
## 2     Tikopia -12.3 -11.2 -1.369236 -1.246784
## 3  Santa Cruz -10.7 -14.0 -1.191124 -1.558480
## 4         Yap   9.5 -41.9  1.057540 -4.664308
## 5    Lau Fiji -17.7  -1.9 -1.970364 -0.211508
## 6   Trobriand  -8.7 -29.1 -0.968484 -3.239412
## 7       Chuuk   7.4 -28.4  0.823768 -3.161488
## 8       Manus  -2.1 -33.1 -0.233772 -3.684692
## 9       Tonga -21.2   4.8 -2.359984  0.534336
## 10     Hawaii  19.9  24.4  2.215268  2.716208</code></pre>
<div class="sourceCode" id="cb1169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1169-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-1" aria-hidden="true" tabindex="-1"></a>b14<span class="fl">.8</span> <span class="ot">&lt;-</span></span>
<span id="cb1169-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d, </span>
<span id="cb1169-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1169-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(a) <span class="sc">*</span> population<span class="sc">^</span>b <span class="sc">/</span> g,</span>
<span id="cb1169-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-5" aria-hidden="true" tabindex="-1"></a>         a <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">gp</span>(lat_adj, lon2_adj, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1169-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-6" aria-hidden="true" tabindex="-1"></a>         b <span class="sc">+</span> g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1169-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">nl =</span> <span class="cn">TRUE</span>),</span>
<span id="cb1169-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">nlpar =</span> a),</span>
<span id="cb1169-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> b, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1169-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">nlpar =</span> g, <span class="at">lb =</span> <span class="dv">0</span>),</span>
<span id="cb1169-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">inv_gamma</span>(<span class="fl">2.874624</span>, <span class="fl">2.941204</span>), <span class="at">class =</span> lscale, <span class="at">coef =</span> gplat_adjlon2_adj, <span class="at">nlpar =</span> a),</span>
<span id="cb1169-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sdgp, <span class="at">coef =</span> gplat_adjlon2_adj, <span class="at">nlpar =</span> a)),</span>
<span id="cb1169-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1169-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">14</span>,</span>
<span id="cb1169-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">sample_prior =</span> T,</span>
<span id="cb1169-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1169-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b14.08&quot;</span>)</span></code></pre></div>
<div class="figure">
<img src="slides/L19/19.png" alt="What happens? This is wholly uninterpretable. Tide prediction enginge agian. So we want to plot thigns. PUsh the posterior back trhough is and get retrodictions. `k` values are exponentitated. Any island with a 0 is exactly as the model expected. If negative, drageged down by some negibouir. If higher, dragged up by some neighbour beyond the expectation of the model. `zetasq` and `rhosq` are uniterpretable for a reason to be explained." width="80%" />
<p class="caption marginnote shownote">
What happens? This is wholly uninterpretable. Tide prediction enginge agian. So we want to plot thigns. PUsh the posterior back trhough is and get retrodictions. <code>k</code> values are exponentitated. Any island with a 0 is exactly as the model expected. If negative, drageged down by some negibouir. If higher, dragged up by some neighbour beyond the expectation of the model. <code>zetasq</code> and <code>rhosq</code> are uniterpretable for a reason to be explained.
</p>
</div>
<div class="sourceCode" id="cb1170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1170-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b14<span class="fl">.8</span>)</span></code></pre></div>
<pre><code>##  Family: poisson 
##   Links: mu = identity 
## Formula: total_tools ~ exp(a) * population^b/g 
##          a ~ 1 + gp(lat_adj, lon2_adj, scale = FALSE)
##          b ~ 1
##          g ~ 1
##    Data: d (Number of observations: 10) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Gaussian Process Terms: 
##                             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS
## sdgp(a_gplat_adjlon2_adj)       0.47      0.30     0.15     1.27 1.00     1038
## lscale(a_gplat_adjlon2_adj)     1.64      0.91     0.51     4.00 1.00     1180
##                             Tail_ESS
## sdgp(a_gplat_adjlon2_adj)       1565
## lscale(a_gplat_adjlon2_adj)     2207
## 
## Population-Level Effects: 
##             Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## a_Intercept     0.34      0.86    -1.41     1.95 1.00     2842     2573
## b_Intercept     0.26      0.08     0.09     0.42 1.00     1526     1376
## g_Intercept     0.67      0.65     0.05     2.44 1.00     2185     2118
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb1172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1172-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_summary</span>(b14<span class="fl">.8</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">15</span>, ] <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>##                             Estimate Est.Error  Q2.5 Q97.5
## b_a_Intercept                   0.34      0.86 -1.41  1.95
## b_b_Intercept                   0.26      0.08  0.09  0.42
## b_g_Intercept                   0.67      0.65  0.05  2.44
## sdgp_a_gplat_adjlon2_adj        0.47      0.30  0.15  1.27
## lscale_a_gplat_adjlon2_adj      1.64      0.91  0.51  4.00
## zgp_a_gplat_adjlon2_adj[1]     -0.46      0.73 -1.91  0.95
## zgp_a_gplat_adjlon2_adj[2]      0.44      0.85 -1.23  2.07
## zgp_a_gplat_adjlon2_adj[3]     -0.62      0.72 -1.99  0.90
## zgp_a_gplat_adjlon2_adj[4]      1.00      0.68 -0.26  2.41
## zgp_a_gplat_adjlon2_adj[5]      0.25      0.74 -1.18  1.75
## zgp_a_gplat_adjlon2_adj[6]     -1.04      0.77 -2.59  0.48
## zgp_a_gplat_adjlon2_adj[7]      0.16      0.73 -1.40  1.59
## zgp_a_gplat_adjlon2_adj[8]     -0.22      0.85 -1.86  1.51
## zgp_a_gplat_adjlon2_adj[9]      0.42      0.91 -1.46  2.12
## zgp_a_gplat_adjlon2_adj[10]    -0.38      0.80 -2.01  1.16</code></pre>
<p>Let’s focus on our three non-linear parameters, first. Happily, both our b_b_Intercept and b_g_Intercept summaries look a lot like those for McElreath’s <code>b</code> and <code>g</code>, respectively. Our <code>b_a_Intercept</code> might look distressingly small, but that’s just because of how we parameterized our model. It’s actually very close to McElreath’s a after you exponentiate.</p>
<div class="sourceCode" id="cb1174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1174-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fixef</span>(b14<span class="fl">.8</span>, <span class="at">probs =</span> <span class="fu">c</span>(.<span class="dv">055</span>, .<span class="dv">945</span>))[<span class="st">&quot;a_Intercept&quot;</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>)] <span class="sc">%&gt;%</span> </span>
<span id="cb1174-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1174-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Estimate     Q5.5    Q94.5 
##     1.41     0.35     5.26</code></pre>
<div class="sourceCode" id="cb1176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1176-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb1176-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">posterior_samples</span>(b14<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1176-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">etasq =</span> sdgp_a_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1176-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1176-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-5" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1176-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(etasq, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1176-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1176-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   etasq .lower .upper .width .point .interval
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 0.313  0.001   0.62   0.89 mean   hdi</code></pre>
<div class="sourceCode" id="cb1178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1178-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1178-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="st">`</span><span class="at">rho^2</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">11</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1178-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lscale =</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="st">`</span><span class="at">rho^2</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb1178-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1178-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">rho^2</span><span class="st">`</span>, <span class="at">y =</span> lscale)) <span class="sc">+</span></span>
<span id="cb1178-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1178-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1178-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#A65141&quot;</span>) <span class="sc">+</span></span>
<span id="cb1178-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="fu">expression</span>(rho<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1178-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1178-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb1178-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1178-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1178-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">lscale =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">11</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1178-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">rho^2</span><span class="st">`</span> <span class="ot">=</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1178-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1178-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lscale, <span class="at">y =</span> <span class="st">`</span><span class="at">rho^2</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb1178-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1178-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1178-20"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">&quot;#80A0C7&quot;</span>) <span class="sc">+</span></span>
<span id="cb1178-21"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="fu">expression</span>(rho<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1178-22"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1178-23"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>))</span>
<span id="cb1178-24"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1178-25"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1178-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-149-1.png" width="672" /></p>
<p>Let’s see how our posterior for <span class="math inline">\(lscale\)</span> looks when we convert it to the scale of McElreath’s <span class="math inline">\(\rho^2\)</span>.</p>
<div class="sourceCode" id="cb1179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1179-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span></span>
<span id="cb1179-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-2" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1179-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rhosq =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale_a_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb1179-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1179-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-5" aria-hidden="true" tabindex="-1"></a>post <span class="sc">%&gt;%</span> </span>
<span id="cb1179-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(rhosq, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1179-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1179-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">3</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   rhosq .lower .upper .width .point .interval
##   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 0.422  0.009  0.908   0.89 mean   hdi</code></pre>
<p>The plot deepends. We used a very different prior for <code>lscale</code>. Use <code>get_prior()</code> to discover where that came from.</p>
<div class="sourceCode" id="cb1181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1181-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_prior</span>(<span class="at">data =</span> d, </span>
<span id="cb1181-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1181-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;identity&quot;</span>),</span>
<span id="cb1181-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1181-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">bf</span>(total_tools <span class="sc">~</span> <span class="fu">exp</span>(a) <span class="sc">*</span> population<span class="sc">^</span>b <span class="sc">/</span> g,</span>
<span id="cb1181-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1181-4" aria-hidden="true" tabindex="-1"></a>             a  <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">gp</span>(lat_adj, lon2_adj, <span class="at">scale =</span> <span class="cn">FALSE</span>),</span>
<span id="cb1181-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1181-5" aria-hidden="true" tabindex="-1"></a>             b <span class="sc">+</span> g <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb1181-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1181-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">nl =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>##                          prior  class              coef group resp dpar nlpar
##                         (flat)      b                                       a
##                         (flat)      b         Intercept                     a
##                         (flat) lscale                                       a
##  inv_gamma(2.874624, 2.941204) lscale gplat_adjlon2_adj                     a
##          student_t(3, 0, 15.6)   sdgp                                       a
##          student_t(3, 0, 15.6)   sdgp gplat_adjlon2_adj                     a
##                         (flat)      b                                       b
##                         (flat)      b         Intercept                     b
##                         (flat)      b                                       g
##                         (flat)      b         Intercept                     g
##  bound       source
##             default
##        (vectorized)
##             default
##             default
##             default
##        (vectorized)
##             default
##        (vectorized)
##             default
##        (vectorized)</code></pre>
<div class="sourceCode" id="cb1183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1183-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">lscale =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="fl">0.01</span>, <span class="at">to =</span> <span class="dv">9</span>, <span class="at">by =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1183-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> invgamma<span class="sc">::</span><span class="fu">dinvgamma</span>(lscale, <span class="fl">2.874624</span>, <span class="fl">2.941204</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1183-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1183-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lscale, <span class="at">y =</span> density)) <span class="sc">+</span></span>
<span id="cb1183-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;#80A0C7&quot;</span>) <span class="sc">+</span></span>
<span id="cb1183-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb1183-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fl">4.75</span>, <span class="at">y =</span> <span class="fl">0.75</span>,</span>
<span id="cb1183-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;inverse gamma(2.874624, 2.941204)&quot;</span>,</span>
<span id="cb1183-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">&quot;#8B9DAF&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>) <span class="sc">+</span></span>
<span id="cb1183-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1183-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1183-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>))</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-152-1.png" width="672" /></p>
<p>Figure 14.11</p>
<div class="sourceCode" id="cb1184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1184-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for `slice_sample()`</span></span>
<span id="cb1184-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb1184-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-4" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb1184-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-5" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1184-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prior_samples</span>(b14<span class="fl">.8</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">iter  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1184-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">etasq =</span> sdgp_a_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1184-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">rhosq =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale_a_1_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1184-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-11" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, etasq, rhosq),</span>
<span id="cb1184-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">covariance =</span> etasq <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rhosq <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1184-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb1184-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1184-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb1184-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;#EEDA9D&quot;</span>) <span class="sc">+</span></span>
<span id="cb1184-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;distance (thousand km)&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1184-20"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1184-21"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1184-22"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1184-23"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Gaussian process prior&quot;</span>)</span>
<span id="cb1184-24"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-25"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-25" aria-hidden="true" tabindex="-1"></a><span class="co"># for `slice_sample()`</span></span>
<span id="cb1184-26"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-26" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb1184-27"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-28"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-28" aria-hidden="true" tabindex="-1"></a><span class="co"># wrangle</span></span>
<span id="cb1184-29"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-29" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1184-30"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-30" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1184-31"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">iter  =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>(),</span>
<span id="cb1184-32"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">etasq =</span> sdgp_a_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb1184-33"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">rhosq =</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> lscale_a_gplat_adjlon2_adj<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-34"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">50</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-35"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-35" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, etasq, rhosq),</span>
<span id="cb1184-36"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">10</span>, <span class="at">by =</span> .<span class="dv">05</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-37"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">covariance =</span> etasq <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rhosq <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1184-38"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1184-39"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb1184-40"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1184-41"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> iter),</span>
<span id="cb1184-42"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;#EEDA9D&quot;</span>) <span class="sc">+</span></span>
<span id="cb1184-43"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> <span class="cf">function</span>(x) <span class="fu">mean</span>(post<span class="sc">$</span>sdgp_a_gplat_adjlon2_adj)<span class="sc">^</span><span class="dv">2</span> <span class="sc">*</span></span>
<span id="cb1184-44"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-44" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">exp</span>(<span class="sc">-</span>(<span class="dv">1</span> <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> <span class="fu">mean</span>(post<span class="sc">$</span>lscale_a_gplat_adjlon2_adj)<span class="sc">^</span><span class="dv">2</span>)) <span class="sc">*</span> x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1184-45"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-45" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">&quot;#DCA258&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1184-46"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="st">&quot;distance (thousand km)&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>),</span>
<span id="cb1184-47"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-47" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1184-48"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>),</span>
<span id="cb1184-49"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-49" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>)) <span class="sc">+</span></span>
<span id="cb1184-50"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Gaussian process posterior&quot;</span>)</span>
<span id="cb1184-51"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1184-52"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1184-52" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/14.41%20b-1.png" width="672" /></p>
<div class="figure">
<img src="slides/L19/20.png" alt="On the left we're repeating the piror. Ont her right, 50 samples form the posterior. Relatively small, but declines more slowly. SO there's some long-distance effects driving the tools around. Can't figure out the shpaes from etasq and rhosq because they're correlated. " width="80%" />
<p class="caption marginnote shownote">
On the left we’re repeating the piror. Ont her right, 50 samples form the posterior. Relatively small, but declines more slowly. SO there’s some long-distance effects driving the tools around. Can’t figure out the shpaes from etasq and rhosq because they’re correlated.
</p>
</div>
<div class="figure">
<img src="slides/L19/21.png" alt="For example, just plotting them on the left. Samples for the Markov chain. Non-indenpdence. If you make one smaller, the other gets bigger. Negaitve correlation. So can't interpret them indepedently." width="80%" />
<p class="caption marginnote shownote">
For example, just plotting them on the left. Samples for the Markov chain. Non-indenpdence. If you make one smaller, the other gets bigger. Negaitve correlation. So can’t interpret them indepedently.
</p>
</div>
<div class="figure">
<img src="slides/L19/22.png" alt="We want to understand this model now. We can think of this on the outcome scale by taking the posterior distribution of the covariance matrixes, then compute for each pari of ilsands the posterior mean correlation. How? We know their distance on the horizontal axis, then we cna compute form the posterior mean theyir epxected covariance, then standardise for a correlation. The diagonal is all 1s, then the off diagonals are the expected correlations and tool counts. The bottom row is Hawaii. You've got no correlation because it's really far away. " width="80%" />
<p class="caption marginnote shownote">
We want to understand this model now. We can think of this on the outcome scale by taking the posterior distribution of the covariance matrixes, then compute for each pari of ilsands the posterior mean correlation. How? We know their distance on the horizontal axis, then we cna compute form the posterior mean theyir epxected covariance, then standardise for a correlation. The diagonal is all 1s, then the off diagonals are the expected correlations and tool counts. The bottom row is Hawaii. You’ve got no correlation because it’s really far away.
</p>
</div>
<p>Push the parameters back through the function for <span class="math inline">\(\mathbf{K}\)</span>, the covariance matrix.</p>
<div class="sourceCode" id="cb1185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1185-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute posterior median covariance among societies</span></span>
<span id="cb1185-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="dv">10</span>, <span class="at">ncol =</span> <span class="dv">10</span>)</span>
<span id="cb1185-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1185-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span>
<span id="cb1185-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-5" aria-hidden="true" tabindex="-1"></a>        k[i, j] <span class="ot">&lt;-</span> <span class="fu">median</span>(post<span class="sc">$</span>etasq) <span class="sc">*</span> </span>
<span id="cb1185-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exp</span>(<span class="sc">-</span><span class="fu">median</span>(post<span class="sc">$</span>rhosq) <span class="sc">*</span> islandsDistMatrix[i, j]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb1185-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-8" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(k) <span class="ot">&lt;-</span> <span class="fu">median</span>(post<span class="sc">$</span>etasq) <span class="sc">+</span> <span class="fl">0.01</span></span>
<span id="cb1185-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1185-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1185-10" aria-hidden="true" tabindex="-1"></a>k <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,] 0.17 0.15 0.14 0.00 0.11 0.06 0.01 0.02 0.07  0.00
##  [2,] 0.15 0.17 0.16 0.00 0.11 0.06 0.02 0.03 0.06  0.00
##  [3,] 0.14 0.16 0.17 0.00 0.09 0.08 0.03 0.04 0.05  0.00
##  [4,] 0.00 0.00 0.00 0.17 0.00 0.04 0.09 0.08 0.00  0.00
##  [5,] 0.11 0.11 0.09 0.00 0.17 0.01 0.00 0.00 0.14  0.00
##  [6,] 0.06 0.06 0.08 0.04 0.01 0.17 0.07 0.13 0.00  0.00
##  [7,] 0.01 0.02 0.03 0.09 0.00 0.07 0.17 0.11 0.00  0.00
##  [8,] 0.02 0.03 0.04 0.08 0.00 0.13 0.11 0.17 0.00  0.00
##  [9,] 0.07 0.06 0.05 0.00 0.14 0.00 0.00 0.00 0.17  0.00
## [10,] 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00  0.17</code></pre>
<p>Change these to a correlation matrix:</p>
<div class="sourceCode" id="cb1187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1187-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># convert to correlation matrix</span></span>
<span id="cb1187-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-2" aria-hidden="true" tabindex="-1"></a>rho <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">cov2cor</span>(k), <span class="dv">2</span>)</span>
<span id="cb1187-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1187-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add row/col names for convenience</span></span>
<span id="cb1187-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(rho) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ml&quot;</span>, <span class="st">&quot;Ti&quot;</span>, <span class="st">&quot;SC&quot;</span>, <span class="st">&quot;Ya&quot;</span>, <span class="st">&quot;Fi&quot;</span>, <span class="st">&quot;Tr&quot;</span>, <span class="st">&quot;Ch&quot;</span>, <span class="st">&quot;Mn&quot;</span>, <span class="st">&quot;To&quot;</span>, <span class="st">&quot;Ha&quot;</span>)</span>
<span id="cb1187-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-6" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(rho) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(rho)</span>
<span id="cb1187-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1187-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1187-8" aria-hidden="true" tabindex="-1"></a>rho <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="dv">2</span>)</span></code></pre></div>
<pre><code>##      Ml   Ti   SC   Ya   Fi   Tr   Ch   Mn   To Ha
## Ml 1.00 0.89 0.85 0.01 0.65 0.35 0.08 0.14 0.41  0
## Ti 0.89 1.00 0.92 0.01 0.65 0.36 0.13 0.17 0.37  0
## SC 0.85 0.92 1.00 0.03 0.53 0.47 0.19 0.25 0.27  0
## Ya 0.01 0.01 0.03 1.00 0.00 0.22 0.53 0.50 0.00  0
## Fi 0.65 0.65 0.53 0.00 1.00 0.08 0.02 0.02 0.82  0
## Tr 0.35 0.36 0.47 0.22 0.08 1.00 0.43 0.79 0.02  0
## Ch 0.08 0.13 0.19 0.53 0.02 0.43 1.00 0.66 0.00  0
## Mn 0.14 0.17 0.25 0.50 0.02 0.79 0.66 1.00 0.01  0
## To 0.41 0.37 0.27 0.00 0.82 0.02 0.00 0.01 1.00  0
## Ha 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00  1</code></pre>
<p>Plot the correlations:</p>
<div class="sourceCode" id="cb1189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1189-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-1" aria-hidden="true" tabindex="-1"></a>rho <span class="sc">%&gt;%</span></span>
<span id="cb1189-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1189-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row =</span> d<span class="sc">$</span>culture) <span class="sc">%&gt;%</span> </span>
<span id="cb1189-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row, <span class="at">values_to =</span> <span class="st">&quot;distance&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1189-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">column =</span> <span class="fu">factor</span>(name, <span class="at">levels =</span> <span class="fu">colnames</span>(d_mat)),</span>
<span id="cb1189-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">row    =</span> <span class="fu">factor</span>(row, <span class="at">levels =</span> <span class="fu">rownames</span>(d_mat)) <span class="sc">%&gt;%</span> <span class="fu">fct_rev</span>(),</span>
<span id="cb1189-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">label  =</span> <span class="fu">formatC</span>(distance, <span class="at">format =</span> <span class="st">&#39;f&#39;</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">str_replace</span>(., <span class="st">&quot;0.&quot;</span>, <span class="st">&quot;.&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1189-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># omit this line to keep the diagonal of 1&#39;s</span></span>
<span id="cb1189-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(distance <span class="sc">!=</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1189-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1189-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> column, <span class="at">y =</span> row)) <span class="sc">+</span> </span>
<span id="cb1189-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">fill =</span> distance)) <span class="sc">+</span> </span>
<span id="cb1189-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> label),</span>
<span id="cb1189-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="fl">2.75</span>, <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#100F14&quot;</span>) <span class="sc">+</span></span>
<span id="cb1189-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="fu">expression</span>(rho), <span class="at">low =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#A65141&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1189-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1189-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1189-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_pearl_earring</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb1189-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1189-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-156-1.png" width="672" /></p>
<p>Get <code>rho</code> into a tidy data frame:</p>
<div class="sourceCode" id="cb1190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1190-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-1" aria-hidden="true" tabindex="-1"></a>tidy_rho <span class="ot">&lt;-</span></span>
<span id="cb1190-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-2" aria-hidden="true" tabindex="-1"></a>  rho <span class="sc">%&gt;%</span></span>
<span id="cb1190-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1190-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1190-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(d <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(culture, logpop, total_tools, lon2, lat)) <span class="sc">%&gt;%</span> </span>
<span id="cb1190-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Ml<span class="sc">:</span>Ha,</span>
<span id="cb1190-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;colname&quot;</span>, </span>
<span id="cb1190-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;correlation&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1190-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">str_c</span>(<span class="fu">pmin</span>(rowname, colname), <span class="fu">pmax</span>(rowname, colname))) <span class="sc">%&gt;%</span></span>
<span id="cb1190-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(rowname, colname, group, culture, <span class="fu">everything</span>())  </span>
<span id="cb1190-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1190-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1190-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tidy_rho)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 9
##   rowname colname group culture  logpop total_tools  lon2   lat correlation
##   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;fct&gt;     &lt;dbl&gt;       &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;
## 1 Ml      Ml      MlMl  Malekula   7.00          13 -12.5 -16.3        1   
## 2 Ml      Ti      MlTi  Malekula   7.00          13 -12.5 -16.3        0.89
## 3 Ml      SC      MlSC  Malekula   7.00          13 -12.5 -16.3        0.85
## 4 Ml      Ya      MlYa  Malekula   7.00          13 -12.5 -16.3        0.01
## 5 Ml      Fi      FiMl  Malekula   7.00          13 -12.5 -16.3        0.65
## 6 Ml      Tr      MlTr  Malekula   7.00          13 -12.5 -16.3        0.35</code></pre>
<p>Figure 14.12a</p>
<div class="sourceCode" id="cb1192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1192-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb1192-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1192-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1192-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-4" aria-hidden="true" tabindex="-1"></a>  tidy_rho <span class="sc">%&gt;%</span>       </span>
<span id="cb1192-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> lon2, <span class="at">y =</span> lat)) <span class="sc">+</span></span>
<span id="cb1192-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, </span>
<span id="cb1192-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-7" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">size =</span> logpop), <span class="at">color =</span> <span class="st">&quot;#DCA258&quot;</span>) <span class="sc">+</span></span>
<span id="cb1192-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> group, <span class="at">alpha =</span> correlation<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1192-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#EEDA9D&quot;</span>) <span class="sc">+</span></span>
<span id="cb1192-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> d, <span class="fu">aes</span>(<span class="at">label =</span> culture), </span>
<span id="cb1192-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-11" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">14</span>, <span class="at">point.padding =</span> .<span class="dv">2</span>, <span class="at">size =</span> <span class="fl">2.75</span>, <span class="at">color =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>) <span class="sc">+</span></span>
<span id="cb1192-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1192-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Among societies in geographic space</span><span class="sc">\n</span><span class="st">&quot;</span>,</span>
<span id="cb1192-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb1192-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;latitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb1192-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>lon2),</span>
<span id="cb1192-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>lat)) <span class="sc">+</span></span>
<span id="cb1192-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1192-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>Figure 14.12b</p>
<div class="sourceCode" id="cb1193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1193-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># compute the average posterior predictive relationship between </span></span>
<span id="cb1193-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-2" aria-hidden="true" tabindex="-1"></a><span class="co"># log population and total tools, summarized by the median and 80% interval</span></span>
<span id="cb1193-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-3" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span></span>
<span id="cb1193-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-4" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1193-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-5" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="at">logpop =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">6</span>, <span class="at">to =</span> <span class="dv">14</span>, <span class="at">length.out =</span> <span class="dv">30</span>),</span>
<span id="cb1193-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">nesting</span>(b_a_Intercept, b_b_Intercept, b_g_Intercept)) <span class="sc">%&gt;%</span></span>
<span id="cb1193-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">population =</span> <span class="fu">exp</span>(logpop)) <span class="sc">%&gt;%</span> </span>
<span id="cb1193-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lambda =</span> <span class="fu">exp</span>(b_a_Intercept) <span class="sc">*</span> population<span class="sc">^</span>b_b_Intercept <span class="sc">/</span> b_g_Intercept) <span class="sc">%&gt;%</span></span>
<span id="cb1193-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(logpop) <span class="sc">%&gt;%</span> </span>
<span id="cb1193-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median_qi</span>(lambda, <span class="at">.width =</span> .<span class="dv">8</span>)</span>
<span id="cb1193-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1193-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-12" aria-hidden="true" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb1193-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1193-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-14" aria-hidden="true" tabindex="-1"></a>  tidy_rho <span class="sc">%&gt;%</span> </span>
<span id="cb1193-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> logpop)) <span class="sc">+</span></span>
<span id="cb1193-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">data =</span> f,</span>
<span id="cb1193-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-17" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">y =</span> lambda, <span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb1193-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-18" aria-hidden="true" tabindex="-1"></a>              <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>,</span>
<span id="cb1193-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;#394165&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#100F14&quot;</span>, <span class="at">alpha =</span> .<span class="dv">5</span>, <span class="at">size =</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb1193-20"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> d, </span>
<span id="cb1193-21"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-21" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">size =</span> logpop), </span>
<span id="cb1193-22"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-22" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;#DCA258&quot;</span>) <span class="sc">+</span></span>
<span id="cb1193-23"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">group =</span> group, <span class="at">alpha =</span> correlation<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb1193-24"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#EEDA9D&quot;</span>) <span class="sc">+</span></span>
<span id="cb1193-25"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(<span class="at">data =</span> d, </span>
<span id="cb1193-26"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-26" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">aes</span>(<span class="at">y =</span> total_tools, <span class="at">label =</span> culture), </span>
<span id="cb1193-27"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">seed =</span> <span class="dv">14</span>, <span class="at">point.padding =</span> .<span class="dv">2</span>, <span class="at">size =</span> <span class="fl">2.75</span>, <span class="at">color =</span> <span class="st">&quot;#FCF9F0&quot;</span>, <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>) <span class="sc">+</span></span>
<span id="cb1193-28"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb1193-29"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;Shown against the relation between</span><span class="sc">\n</span><span class="st">total tools and log pop&quot;</span>,</span>
<span id="cb1193-30"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;log population&quot;</span>,</span>
<span id="cb1193-31"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;total tools&quot;</span>) <span class="sc">+</span></span>
<span id="cb1193-32"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">range</span>(d<span class="sc">$</span>logpop),</span>
<span id="cb1193-33"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ylim =</span> <span class="fu">range</span>(d<span class="sc">$</span>total_tools)) <span class="sc">+</span></span>
<span id="cb1193-34"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1193-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p>Then combine</p>
<div class="sourceCode" id="cb1194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1194-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1194-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> </span>
<span id="cb1194-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1194-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(<span class="at">title =</span> <span class="st">&quot;Posterior median correlations&quot;</span>)</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-158-1.png" width="672" /></p>
<div class="figure">
<img src="slides/L19/23.png" alt="On a map, this is what it looks like. LIke the world's least high-tech map of the pacific ocean. Size of each point is the population size. Line setgments are the correlations. Triad of Santa Cruz, Tikopia and Malekula. Tool counts are more similar, and deviate more because of their popualtions sizes. Tonga correlated with Fiji. " width="80%" />
<p class="caption marginnote shownote">
On a map, this is what it looks like. LIke the world’s least high-tech map of the pacific ocean. Size of each point is the population size. Line setgments are the correlations. Triad of Santa Cruz, Tikopia and Malekula. Tool counts are more similar, and deviate more because of their popualtions sizes. Tonga correlated with Fiji.
</p>
</div>
<div class="figure">
<img src="slides/L19/24.png" alt="Can also plot this based ont he original hypothesis. Again, ilsand society points are proportional to their poulations. Trend is avergae prediction based on pouplation size. Can see things getting dragged around. Model thinks Fiji was dragged upwards from its population expectation." width="80%" />
<p class="caption marginnote shownote">
Can also plot this based ont he original hypothesis. Again, ilsand society points are proportional to their poulations. Trend is avergae prediction based on pouplation size. Can see things getting dragged around. Model thinks Fiji was dragged upwards from its population expectation.
</p>
</div>
<div class="figure">
<img src="slides/L19/25.png" alt="Sometimes called Bayesian non-parametric regression. Non-parametric meaning infinte number of functions being considerd. They consider an infinite number of splines that pass along continuos categories than select among them with regularisation. Very popular with machine learning. Lots of really diverse applications. There are lots of periodic datasets, like seasonality datasets in ecology or social science, where the covariance function has cosines in it to measure the periodicity in it. e.g. human births - cool analysis by Gelman et al using Gaussian process regression. Phylogenetic distances are like this as well. All are special cases, with particular stratgeies for building the covariance matrix. Then don't need to make assumptions about the regression shape, you can do that with regularisation. Finally there's automatic relevance determination -- terrible machine learning term -- estimating the importance of each kind of distance in the covariance between the items." width="80%" />
<p class="caption marginnote shownote">
Sometimes called Bayesian non-parametric regression. Non-parametric meaning infinte number of functions being considerd. They consider an infinite number of splines that pass along continuos categories than select among them with regularisation. Very popular with machine learning. Lots of really diverse applications. There are lots of periodic datasets, like seasonality datasets in ecology or social science, where the covariance function has cosines in it to measure the periodicity in it. e.g. human births - cool analysis by Gelman et al using Gaussian process regression. Phylogenetic distances are like this as well. All are special cases, with particular stratgeies for building the covariance matrix. Then don’t need to make assumptions about the regression shape, you can do that with regularisation. Finally there’s automatic relevance determination – terrible machine learning term – estimating the importance of each kind of distance in the covariance between the items.
</p>
</div>
<p><strong><em>14.5.2. Example: Phylogenetic distance</em></strong></p>
<div class="figure">
<img src="slides/L19/26.png" alt="In evo bio, you worry about how long ago this pair of species diverged. Concerned about shared common history. This introduces a lot of back doors. Like a proxy of shared exposures. e.g. comon genes, kinds of ecologies, etc. YOu may not have measured all of those things. Then time since divergence is a proxy for those common exposures. We're going to use this to see how flexible it is. Lots of way st o smuggle it in. One way is Brownian motion model Simplest but also goofiest evolutionary model because no trait evolves this way. Other processes like the OU, like Brownian but variance constrained. Some attractor that pulls back traits. Any particular phylogency implies a covariance structure.  " width="80%" />
<p class="caption marginnote shownote">
In evo bio, you worry about how long ago this pair of species diverged. Concerned about shared common history. This introduces a lot of back doors. Like a proxy of shared exposures. e.g. comon genes, kinds of ecologies, etc. YOu may not have measured all of those things. Then time since divergence is a proxy for those common exposures. We’re going to use this to see how flexible it is. Lots of way st o smuggle it in. One way is Brownian motion model Simplest but also goofiest evolutionary model because no trait evolves this way. Other processes like the OU, like Brownian but variance constrained. Some attractor that pulls back traits. Any particular phylogency implies a covariance structure.
</p>
</div>
<div class="figure">
<img src="slides/L19/27.png" alt="Let's use this primates dataset. " width="80%" />
<p class="caption marginnote shownote">
Let’s use this primates dataset.
</p>
</div>
<div class="sourceCode" id="cb1195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1195-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Primates301, <span class="at">package =</span> <span class="st">&quot;rethinking&quot;</span>) </span>
<span id="cb1195-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Primates301_nex)</span>
<span id="cb1195-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-4" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;GuangchuangYu/ggtree&quot;)</span></span>
<span id="cb1195-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-5" aria-hidden="true" tabindex="-1"></a><span class="co">#library(ggtree)</span></span>
<span id="cb1195-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1195-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Primates301_nex %&gt;%</span></span>
<span id="cb1195-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-8" aria-hidden="true" tabindex="-1"></a><span class="co">#  ggtree(layout = &quot;circular&quot;, color = &quot;#394165&quot;, size = 1/4) + </span></span>
<span id="cb1195-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1195-9" aria-hidden="true" tabindex="-1"></a><span class="co">#  geom_tiplab(size = 5/3, color = &quot;#100F14&quot;)</span></span></code></pre></div>
<div class="figure">
<img src="slides/L19/28.png" alt="Apes are the losers of the pirmates. Old World are the winners - recent diversification. Galagos and Lorises adre small and recently diverged. Tarisers tiny andvery differnt from each other. New World are Americas. A lot of them as well. " width="80%" />
<p class="caption marginnote shownote">
Apes are the losers of the pirmates. Old World are the winners - recent diversification. Galagos and Lorises adre small and recently diverged. Tarisers tiny andvery differnt from each other. New World are Americas. A lot of them as well.
</p>
</div>
<div class="figure">
<img src="slides/L19/29.png" alt="There we are." width="80%" />
<p class="caption marginnote shownote">
There we are.
</p>
</div>
<div class="figure">
<img src="slides/L19/30.png" alt="A large brain makes it possible to live in big groups. There's this back door through body size, which might also causally affect group size, by changing the ecology you're in. " width="80%" />
<p class="caption marginnote shownote">
A large brain makes it possible to live in big groups. There’s this back door through body size, which might also causally affect group size, by changing the ecology you’re in.
</p>
</div>
<div class="figure">
<img src="slides/L19/31.png" alt="Have to trim the tree. You end up with 150. Purely treating phylogeny as some squishy common exposure measure. Definitely not super sicence. Really geocentric." width="80%" />
<p class="caption marginnote shownote">
Have to trim the tree. You end up with 150. Purely treating phylogeny as some squishy common exposure measure. Definitely not super sicence. Really geocentric.
</p>
</div>
<p>First format the data:</p>
<div class="sourceCode" id="cb1196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1196-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-1" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb1196-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-2" aria-hidden="true" tabindex="-1"></a>  Primates301 <span class="sc">%&gt;%</span> </span>
<span id="cb1196-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name =</span> <span class="fu">as.character</span>(name)) <span class="sc">%&gt;%</span> </span>
<span id="cb1196-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(group_size, body, brain) <span class="sc">%&gt;%</span> </span>
<span id="cb1196-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">m =</span> <span class="fu">log</span>(body) <span class="sc">%&gt;%</span> <span class="fu">standardize</span>(),</span>
<span id="cb1196-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">b =</span> <span class="fu">log</span>(brain) <span class="sc">%&gt;%</span> <span class="fu">standardize</span>(),</span>
<span id="cb1196-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">g =</span> <span class="fu">log</span>(group_size) <span class="sc">%&gt;%</span> <span class="fu">standardize</span>())</span>
<span id="cb1196-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1196-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1196-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d)</span></code></pre></div>
<pre><code>## Rows: 151
## Columns: 19
## $ name                &lt;chr&gt; &quot;Allenopithecus_nigroviridis&quot;, &quot;Alouatta_belzebul&quot;…
## $ genus               &lt;fct&gt; Allenopithecus, Alouatta, Alouatta, Alouatta, Alou…
## $ species             &lt;fct&gt; nigroviridis, belzebul, caraya, guariba, palliata,…
## $ subspecies          &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ spp_id              &lt;int&gt; 1, 3, 4, 5, 6, 7, 9, 10, 18, 22, 23, 25, 26, 28, 2…
## $ genus_id            &lt;int&gt; 1, 3, 3, 3, 3, 3, 3, 4, 4, 6, 7, 7, 7, 8, 8, 10, 1…
## $ social_learning     &lt;int&gt; 0, 0, 0, 0, 3, 0, 0, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0,…
## $ research_effort     &lt;int&gt; 6, 15, 45, 37, 79, 25, 82, 22, 58, 1, 12, 58, 30, …
## $ brain               &lt;dbl&gt; 58.02, 52.84, 52.63, 51.70, 49.88, 51.13, 55.22, 2…
## $ body                &lt;dbl&gt; 4655, 6395, 5383, 5175, 6250, 8915, 5950, 1205, 98…
## $ group_size          &lt;dbl&gt; 40.00, 7.40, 8.90, 7.40, 13.10, 5.50, 7.90, 4.10, …
## $ gestation           &lt;dbl&gt; NA, NA, 185.92, NA, 185.42, 185.92, 189.90, NA, 13…
## $ weaning             &lt;dbl&gt; 106.15, NA, 323.16, NA, 495.60, NA, 370.04, 229.69…
## $ longevity           &lt;dbl&gt; 276.0, NA, 243.6, NA, 300.0, 240.0, 300.0, NA, 303…
## $ sex_maturity        &lt;dbl&gt; NA, NA, 1276.72, NA, 1578.42, NA, 1690.22, NA, 736…
## $ maternal_investment &lt;dbl&gt; NA, NA, 509.08, NA, 681.02, NA, 559.94, NA, 209.68…
## $ m                   &lt;dbl&gt; 0.36958768, 0.57601585, 0.46403740, 0.43842259, 0.…
## $ b                   &lt;dbl&gt; 0.4039485, 0.3285765, 0.3253670, 0.3109981, 0.2821…
## $ g                   &lt;dbl&gt; 1.397272713, 0.003132082, 0.155626096, 0.003132082…</code></pre>
<div class="figure">
<img src="slides/L19/32.png" alt="To get here, this is an ordinary regression but weirded. All of the outcomes for all species is one outcome, a single big vector of group sizes, a log groupsize as a function of log body size and log brian size. Think of sampling all tips of the tree simultaneously at the smae time. Bold G is all the group sizes. Some vector mu. Then this covariance matrix S. In standard linear regression it las sigma squared along the diagonal and 0 everywhere else. So toconstrust S is by multiplying sigma squared by I. If you mutpily the scalar sigma 2 with this, there's no correaltions, and you're back to a linear regression. Why do this? We'll get back to a linear regression by replacing S. " width="80%" />
<p class="caption marginnote shownote">
To get here, this is an ordinary regression but weirded. All of the outcomes for all species is one outcome, a single big vector of group sizes, a log groupsize as a function of log body size and log brian size. Think of sampling all tips of the tree simultaneously at the smae time. Bold G is all the group sizes. Some vector mu. Then this covariance matrix S. In standard linear regression it las sigma squared along the diagonal and 0 everywhere else. So toconstrust S is by multiplying sigma squared by I. If you mutpily the scalar sigma 2 with this, there’s no correaltions, and you’re back to a linear regression. Why do this? We’ll get back to a linear regression by replacing S.
</p>
</div>
<div class="figure">
<img src="slides/L19/33.png" alt="Matrix with number of rows equal to numbe ro fspecies, and number o fcolumsn the same. Covariance matrix. Diagonal is sigma squared. Imat is the identity matrix. Just a linear regression, and we find a strong association between brain size and group size, and a slightly negative relationship with boyd mass. These are only direct effects. Bigger species live in bigger groups. But if you take brain size out, you'll see the coeffcient for body mass is positive. This is the direct effect of body size is negative, but not the total effect." width="80%" />
<p class="caption marginnote shownote">
Matrix with number of rows equal to numbe ro fspecies, and number o fcolumsn the same. Covariance matrix. Diagonal is sigma squared. Imat is the identity matrix. Just a linear regression, and we find a strong association between brain size and group size, and a slightly negative relationship with boyd mass. These are only direct effects. Bigger species live in bigger groups. But if you take brain size out, you’ll see the coeffcient for body mass is positive. This is the direct effect of body size is negative, but not the total effect.
</p>
</div>
<p>Make the naïve model, exploring the conditional relations of log(body mass) and log(group size) on log(brain size) without accounting for phylogenetic relationships.</p>
<div class="sourceCode" id="cb1198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1198-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-1" aria-hidden="true" tabindex="-1"></a>b14<span class="fl">.9</span> <span class="ot">&lt;-</span></span>
<span id="cb1198-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb1198-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-3" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1198-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-4" aria-hidden="true" tabindex="-1"></a>      b <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m <span class="sc">+</span> g,</span>
<span id="cb1198-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1198-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-6" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1198-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-7" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1198-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1198-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">14</span>,</span>
<span id="cb1198-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1198-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b14.09&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1199-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b14<span class="fl">.9</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: b ~ 1 + m + g 
##    Data: d (Number of observations: 151) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     0.00      0.02    -0.03     0.03 1.00     3357     2947
## m             0.89      0.02     0.85     0.94 1.00     3155     3114
## g             0.12      0.02     0.08     0.17 1.00     3384     2709
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.22      0.01     0.19     0.24 1.00     3724     3029
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>If you want <span class="math inline">\(\sigma\)</span> in the <span class="math inline">\(\sigma^2\)</span> metric, you can square that by hand:</p>
<div class="sourceCode" id="cb1201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1201-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b14<span class="fl">.9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1201-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1201-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sigma_sq =</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1201-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_qi</span>(sigma_sq) <span class="sc">%&gt;%</span> </span>
<span id="cb1201-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1201-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="at">digits =</span> <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   sigma_sq .lower .upper .width .point .interval
##      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1     0.05   0.04   0.06   0.95 mean   qi</code></pre>
<div class="figure">
<img src="slides/L19/34.png" alt="The inferentail threat is this haunting phylogeny. It gives us a tool, and instrument if you will, to measure these things. To get increased covariance for recently separated species. " width="80%" />
<p class="caption marginnote shownote">
The inferentail threat is this haunting phylogeny. It gives us a tool, and instrument if you will, to measure these things. To get increased covariance for recently separated species.
</p>
</div>
<div class="figure">
<img src="slides/L19/35.png" alt="The traits just wander randomly. When this happens, the covariance is expected to decline in a linear function since the time they diverged. We compute the implied covariance matrix then plot that against phylogenetic distance. How to get phylogenetic distance? Total branch length. No one really likes this model, but it's easy to use. " width="80%" />
<p class="caption marginnote shownote">
The traits just wander randomly. When this happens, the covariance is expected to decline in a linear function since the time they diverged. We compute the implied covariance matrix then plot that against phylogenetic distance. How to get phylogenetic distance? Total branch length. No one really likes this model, but it’s easy to use.
</p>
</div>
<p>Make the covariance matrix (<code>V</code>) and the distance matrix (<code>Dmat</code>).</p>
<div class="sourceCode" id="cb1203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1203-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb1203-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-3" aria-hidden="true" tabindex="-1"></a>spp_obs <span class="ot">&lt;-</span> d<span class="sc">$</span>name</span>
<span id="cb1203-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-5" aria-hidden="true" tabindex="-1"></a>tree_trimmed <span class="ot">&lt;-</span> <span class="fu">keep.tip</span>(Primates301_nex, spp_obs)</span>
<span id="cb1203-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-6" aria-hidden="true" tabindex="-1"></a>Rbm <span class="ot">&lt;-</span> <span class="fu">corBrownian</span>(<span class="at">phy =</span> tree_trimmed)</span>
<span id="cb1203-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1203-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1203-8" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">vcv</span>(Rbm)</span></code></pre></div>
<pre><code>## Warning in Initialize.corPhyl(phy, dummy.df): No covariate specified, species
## will be taken as ordered in the data frame. To avoid this message, specify a
## covariate containing the species names with the &#39;form&#39; argument.</code></pre>
<div class="sourceCode" id="cb1205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1205-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1205-1" aria-hidden="true" tabindex="-1"></a>Dmat <span class="ot">&lt;-</span> <span class="fu">cophenetic</span>( tree_trimmed )</span></code></pre></div>
<p>Distance by covariance scatter plot</p>
<div class="sourceCode" id="cb1206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1206-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">full_join</span>(</span>
<span id="cb1206-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-2" aria-hidden="true" tabindex="-1"></a>  Dmat <span class="sc">%&gt;%</span> </span>
<span id="cb1206-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1206-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>row,</span>
<span id="cb1206-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb1206-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;distance&quot;</span>),</span>
<span id="cb1206-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-7" aria-hidden="true" tabindex="-1"></a>  V <span class="sc">%&gt;%</span> </span>
<span id="cb1206-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1206-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="sc">-</span>row,</span>
<span id="cb1206-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-10" aria-hidden="true" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb1206-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-11" aria-hidden="true" tabindex="-1"></a>                 <span class="at">values_to =</span> <span class="st">&quot;covariance&quot;</span>),</span>
<span id="cb1206-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;row&quot;</span>, <span class="st">&quot;col&quot;</span>)</span>
<span id="cb1206-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb1206-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1206-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> distance, <span class="at">y =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1206-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#80A0C7&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb1206-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;These variables are the</span><span class="sc">\n</span><span class="st">inverse of one another.&quot;</span>,</span>
<span id="cb1206-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;phylogenetic distance&quot;</span>, </span>
<span id="cb1206-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1206-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;covariance&quot;</span>)</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-175-1.png" width="672" /></p>
<p>Plot heatmaps of each matrix:</p>
<div class="sourceCode" id="cb1207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1207-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># headmap of Dmat</span></span>
<span id="cb1207-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb1207-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-3" aria-hidden="true" tabindex="-1"></a>  Dmat <span class="sc">%&gt;%</span> </span>
<span id="cb1207-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1207-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row,</span>
<span id="cb1207-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb1207-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;distance&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1207-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1207-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> col, <span class="at">y =</span> row, <span class="at">fill =</span> distance)) <span class="sc">+</span></span>
<span id="cb1207-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb1207-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#100F14&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#EEDA9D&quot;</span>) <span class="sc">+</span></span>
<span id="cb1207-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1207-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1207-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb1207-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1207-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-16" aria-hidden="true" tabindex="-1"></a><span class="co"># headmap of V</span></span>
<span id="cb1207-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb1207-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-18" aria-hidden="true" tabindex="-1"></a>  V <span class="sc">%&gt;%</span> </span>
<span id="cb1207-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">&quot;row&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1207-20"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>row,</span>
<span id="cb1207-21"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">&quot;col&quot;</span>,</span>
<span id="cb1207-22"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to =</span> <span class="st">&quot;covariance&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1207-23"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1207-24"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> col, <span class="at">y =</span> row, <span class="at">fill =</span> covariance)) <span class="sc">+</span></span>
<span id="cb1207-25"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb1207-26"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">low =</span> <span class="st">&quot;#100F14&quot;</span>, <span class="at">high =</span> <span class="st">&quot;#EEDA9D&quot;</span>) <span class="sc">+</span></span>
<span id="cb1207-27"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1207-28"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_discrete</span>(<span class="cn">NULL</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1207-29"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span>
<span id="cb1207-30"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1207-31"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-31" aria-hidden="true" tabindex="-1"></a><span class="co"># combine</span></span>
<span id="cb1207-32"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1207-32" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">|</span> p2) <span class="sc">+</span> <span class="fu">plot_annotation</span>(<span class="at">subtitle =</span> <span class="st">&quot;Again, distance is the inverse of covariance.&quot;</span>)</span></code></pre></div>
<p><img src="14_adventures_in_covariance_files/figure-html/unnamed-chunk-176-1.png" width="672" /></p>
<div class="figure">
<img src="slides/L19/36.png" alt="So you can get the covariance matrix by inverting the phylogenetic distance matrix. Then once you have that, make it into a correlation matrix so we can fit the residual variance. Then just pass it in = replace the identity matrix with this correlation matrix. That's the Brownian motion model. Run this model. Things change a lot. Brain size is nothing now. Body size is now positive, because all that baackdoor throug brain is knocked out. This says the correlation etween brian size and and group size si that closely related species have similar brains and body sizes. " width="80%" />
<p class="caption marginnote shownote">
So you can get the covariance matrix by inverting the phylogenetic distance matrix. Then once you have that, make it into a correlation matrix so we can fit the residual variance. Then just pass it in = replace the identity matrix with this correlation matrix. That’s the Brownian motion model. Run this model. Things change a lot. Brain size is nothing now. Body size is now positive, because all that baackdoor throug brain is knocked out. This says the correlation etween brian size and and group size si that closely related species have similar brains and body sizes.
</p>
</div>
<div class="sourceCode" id="cb1208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1208-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-1" aria-hidden="true" tabindex="-1"></a>R <span class="ot">&lt;-</span> V[spp_obs, spp_obs] <span class="sc">/</span> <span class="fu">max</span>(V)</span>
<span id="cb1208-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1208-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-3" aria-hidden="true" tabindex="-1"></a>b14<span class="fl">.10</span> <span class="ot">&lt;-</span></span>
<span id="cb1208-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">brm</span>(<span class="at">data =</span> d,</span>
<span id="cb1208-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">data2 =</span> <span class="fu">list</span>(<span class="at">R =</span> R),</span>
<span id="cb1208-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">family =</span> gaussian,</span>
<span id="cb1208-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-7" aria-hidden="true" tabindex="-1"></a>      b <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> m <span class="sc">+</span> g <span class="sc">+</span> <span class="fu">fcor</span>(R),</span>
<span id="cb1208-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb1208-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-9" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>), <span class="at">class =</span> b),</span>
<span id="cb1208-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sigma)),</span>
<span id="cb1208-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb1208-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">14</span>,</span>
<span id="cb1208-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1208-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b14.10&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb1209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1209-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b14<span class="fl">.10</span>)</span></code></pre></div>
<pre><code>##  Family: gaussian 
##   Links: mu = identity; sigma = identity 
## Formula: b ~ 1 + m + g + fcor(R) 
##    Data: d (Number of observations: 151) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept    -0.19      0.17    -0.52     0.14 1.00     4104     3302
## m             0.70      0.04     0.63     0.77 1.00     4074     2779
## g            -0.01      0.02    -0.05     0.03 1.00     4314     3222
## 
## Family Specific Parameters: 
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sigma     0.40      0.02     0.36     0.45 1.00     4129     2922
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Since our residual variance is still in the <span class="math inline">\(\sigma\)</span> metric, it will be easier to compare it to McElreath’s <code>sigma_sq</code> parameter after transforming the posterior samples.</p>
<div class="sourceCode" id="cb1211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1211-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">posterior_samples</span>(b14<span class="fl">.10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1211-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1211-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">sigma_sq =</span> sigma<span class="sc">^</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1211-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1211-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean_hdi</span>(sigma_sq, <span class="at">.width =</span> .<span class="dv">89</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1211-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.double, round, <span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 6
##   sigma_sq .lower .upper .width .point .interval
##      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1     0.16   0.13   0.19   0.89 mean   hdi</code></pre>
<div class="figure">
<img src="slides/L19/37.png" alt="Swap the tip labels for group sizes. At the bottom we have prosimians. Gibbons in the upper left. " width="80%" />
<p class="caption marginnote shownote">
Swap the tip labels for group sizes. At the bottom we have prosimians. Gibbons in the upper left.
</p>
</div>
<div class="figure">
<img src="slides/L19/38.png" alt="Let's do the Guassian process version of this. The only way to get linear decline with distance is thorugh no selection. Anything else, you'd get an acceleration of decline with distance. Closely-related species can be very simliar, but after som ephylogenetic sdsistance you don't expect any of thsoe confounds to be shared anynommre. You can fit a bunch of functions that way.   " width="80%" />
<p class="caption marginnote shownote">
Let’s do the Guassian process version of this. The only way to get linear decline with distance is thorugh no selection. Anything else, you’d get an acceleration of decline with distance. Closely-related species can be very simliar, but after som ephylogenetic sdsistance you don’t expect any of thsoe confounds to be shared anynommre. You can fit a bunch of functions that way.
</p>
</div>
<div class="figure">
<img src="slides/L19/39.png" alt="We just have to change one line. Change the covariance matrix and make the right hand size the cov-GPL2. Now it's about divergence. We're going to estiamte the covariance in group sizes with genetic distance. Brain size is still basically nothing. Now group size is even stronger before. If there's any relationship with brain size, it's negative. But there are a lot of other confounds. So much other reciprocal causation. Important to see the impact that a measure of confounds cna have. " width="80%" />
<p class="caption marginnote shownote">
We just have to change one line. Change the covariance matrix and make the right hand size the cov-GPL2. Now it’s about divergence. We’re going to estiamte the covariance in group sizes with genetic distance. Brain size is still basically nothing. Now group size is even stronger before. If there’s any relationship with brain size, it’s negative. But there are a lot of other confounds. So much other reciprocal causation. Important to see the impact that a measure of confounds cna have.
</p>
</div>
<p>Need to use <code>rethinking</code> for the next model:</p>
<div class="sourceCode" id="cb1213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1213-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-1" aria-hidden="true" tabindex="-1"></a>dat_list <span class="ot">&lt;-</span> </span>
<span id="cb1213-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb1213-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_spp =</span> <span class="fu">nrow</span>(d),</span>
<span id="cb1213-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">M     =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(d<span class="sc">$</span>body)),</span>
<span id="cb1213-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">B     =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(d<span class="sc">$</span>brain)),</span>
<span id="cb1213-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">G     =</span> <span class="fu">standardize</span>(<span class="fu">log</span>(d<span class="sc">$</span>group_size)), <span class="at">Imat =</span> <span class="fu">diag</span>(<span class="fu">nrow</span>(d)),</span>
<span id="cb1213-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">V     =</span> V[spp_obs, spp_obs],</span>
<span id="cb1213-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">R     =</span> V[spp_obs, spp_obs] <span class="sc">/</span> <span class="fu">max</span>(V[spp_obs, spp_obs]),</span>
<span id="cb1213-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Dmat  =</span> Dmat[spp_obs, spp_obs] <span class="sc">/</span> <span class="fu">max</span>(Dmat)</span>
<span id="cb1213-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1213-10" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb1214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1214-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-1" aria-hidden="true" tabindex="-1"></a>m14<span class="fl">.11</span> <span class="ot">&lt;-</span> </span>
<span id="cb1214-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ulam</span>( </span>
<span id="cb1214-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">alist</span>(</span>
<span id="cb1214-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-4" aria-hidden="true" tabindex="-1"></a>      B <span class="sc">~</span> <span class="fu">multi_normal</span>(mu, SIGMA),</span>
<span id="cb1214-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-5" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> a <span class="sc">+</span> bM <span class="sc">*</span> M <span class="sc">+</span> bG <span class="sc">*</span> G,</span>
<span id="cb1214-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-6" aria-hidden="true" tabindex="-1"></a>      matrix[N_spp,N_spp]<span class="sc">:</span> SIGMA <span class="ot">&lt;-</span> <span class="fu">cov_GPL1</span>(Dmat, etasq, rhosq, <span class="fl">0.01</span>), </span>
<span id="cb1214-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-7" aria-hidden="true" tabindex="-1"></a>      a <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb1214-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(bM,bG) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">0.5</span>),</span>
<span id="cb1214-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-9" aria-hidden="true" tabindex="-1"></a>      etasq <span class="sc">~</span> <span class="fu">half_normal</span>(<span class="dv">1</span>, <span class="fl">0.25</span>),</span>
<span id="cb1214-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-10" aria-hidden="true" tabindex="-1"></a>      rhosq <span class="sc">~</span> <span class="fu">half_normal</span>(<span class="dv">3</span>, <span class="fl">0.25</span>)</span>
<span id="cb1214-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-11" aria-hidden="true" tabindex="-1"></a>    ), </span>
<span id="cb1214-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat_list, </span>
<span id="cb1214-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1214-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## Running MCMC with 4 parallel chains, with 1 thread(s) per chain...
## 
## Chain 1 Iteration:   1 / 1000 [  0%]  (Warmup) 
## Chain 2 Iteration:   1 / 1000 [  0%]  (Warmup) 
## Chain 3 Iteration:   1 / 1000 [  0%]  (Warmup) 
## Chain 4 Iteration:   1 / 1000 [  0%]  (Warmup) 
## Chain 3 Iteration: 100 / 1000 [ 10%]  (Warmup) 
## Chain 4 Iteration: 100 / 1000 [ 10%]  (Warmup) 
## Chain 2 Iteration: 100 / 1000 [ 10%]  (Warmup) 
## Chain 1 Iteration: 100 / 1000 [ 10%]  (Warmup) 
## Chain 4 Iteration: 200 / 1000 [ 20%]  (Warmup) 
## Chain 3 Iteration: 200 / 1000 [ 20%]  (Warmup) 
## Chain 1 Iteration: 200 / 1000 [ 20%]  (Warmup) 
## Chain 2 Iteration: 200 / 1000 [ 20%]  (Warmup) 
## Chain 4 Iteration: 300 / 1000 [ 30%]  (Warmup) 
## Chain 3 Iteration: 300 / 1000 [ 30%]  (Warmup) 
## Chain 2 Iteration: 300 / 1000 [ 30%]  (Warmup) 
## Chain 4 Iteration: 400 / 1000 [ 40%]  (Warmup) 
## Chain 1 Iteration: 300 / 1000 [ 30%]  (Warmup) 
## Chain 3 Iteration: 400 / 1000 [ 40%]  (Warmup) 
## Chain 2 Iteration: 400 / 1000 [ 40%]  (Warmup) 
## Chain 1 Iteration: 400 / 1000 [ 40%]  (Warmup) 
## Chain 4 Iteration: 500 / 1000 [ 50%]  (Warmup) 
## Chain 4 Iteration: 501 / 1000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 500 / 1000 [ 50%]  (Warmup) 
## Chain 3 Iteration: 501 / 1000 [ 50%]  (Sampling) 
## Chain 1 Iteration: 500 / 1000 [ 50%]  (Warmup) 
## Chain 1 Iteration: 501 / 1000 [ 50%]  (Sampling) 
## Chain 4 Iteration: 600 / 1000 [ 60%]  (Sampling) 
## Chain 2 Iteration: 500 / 1000 [ 50%]  (Warmup) 
## Chain 2 Iteration: 501 / 1000 [ 50%]  (Sampling) 
## Chain 3 Iteration: 600 / 1000 [ 60%]  (Sampling) 
## Chain 1 Iteration: 600 / 1000 [ 60%]  (Sampling) 
## Chain 4 Iteration: 700 / 1000 [ 70%]  (Sampling) 
## Chain 2 Iteration: 600 / 1000 [ 60%]  (Sampling) 
## Chain 3 Iteration: 700 / 1000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 700 / 1000 [ 70%]  (Sampling) 
## Chain 4 Iteration: 800 / 1000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 800 / 1000 [ 80%]  (Sampling) 
## Chain 2 Iteration: 700 / 1000 [ 70%]  (Sampling) 
## Chain 1 Iteration: 800 / 1000 [ 80%]  (Sampling) 
## Chain 3 Iteration: 900 / 1000 [ 90%]  (Sampling) 
## Chain 2 Iteration: 800 / 1000 [ 80%]  (Sampling) 
## Chain 4 Iteration: 900 / 1000 [ 90%]  (Sampling) 
## Chain 3 Iteration: 1000 / 1000 [100%]  (Sampling) 
## Chain 3 finished in 20.7 seconds.
## Chain 2 Iteration: 900 / 1000 [ 90%]  (Sampling) 
## Chain 1 Iteration: 900 / 1000 [ 90%]  (Sampling) 
## Chain 4 Iteration: 1000 / 1000 [100%]  (Sampling) 
## Chain 4 finished in 21.2 seconds.
## Chain 2 Iteration: 1000 / 1000 [100%]  (Sampling) 
## Chain 2 finished in 22.6 seconds.
## Chain 1 Iteration: 1000 / 1000 [100%]  (Sampling) 
## Chain 1 finished in 23.2 seconds.
## 
## All 4 chains finished successfully.
## Mean chain execution time: 21.9 seconds.
## Total execution time: 23.4 seconds.</code></pre>
<div class="sourceCode" id="cb1216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1216-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m14<span class="fl">.11</span>)</span></code></pre></div>
<pre><code>##              mean          sd        5.5%      94.5%    n_eff     Rhat4
## a     -0.06550078 0.077430584 -0.18536769 0.05613062 1741.169 1.0012324
## bG     0.04976230 0.023616285  0.01173776 0.08717199 1456.941 1.0025405
## bM     0.83343481 0.029390706  0.78587935 0.88122616 1950.892 1.0007627
## etasq  0.03482748 0.006861162  0.02537451 0.04696830 1723.880 0.9996196
## rhosq  2.80164376 0.240698307  2.42028175 3.18507195 1704.993 0.9997263</code></pre>
<div class="figure">
<img src="slides/L19/40.png" alt="We plot the covariance matrix here. Definitely faster than linear. 1 is the maximum phylogenetic distance. The evidence is for closely related species, there's a lot pf correlation of group size. But it declines very fast as you move away. " width="80%" />
<p class="caption marginnote shownote">
We plot the covariance matrix here. Definitely faster than linear. 1 is the maximum phylogenetic distance. The evidence is for closely related species, there’s a lot pf correlation of group size. But it declines very fast as you move away.
</p>
</div>
<div class="sourceCode" id="cb1218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1218-1"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>(m14<span class="fl">.11</span>)</span>
<span id="cb1218-2"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1218-3"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">14</span>)</span>
<span id="cb1218-4"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1218-5"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-5" aria-hidden="true" tabindex="-1"></a><span class="fu">left_join</span>(</span>
<span id="cb1218-6"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># posterior</span></span>
<span id="cb1218-7"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-7" aria-hidden="true" tabindex="-1"></a>  post <span class="sc">%&gt;%</span> </span>
<span id="cb1218-8"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb1218-9"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">30</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-10"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">iter =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-11"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-11" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(iter, etasq, rhosq),</span>
<span id="cb1218-12"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-12" aria-hidden="true" tabindex="-1"></a>                  <span class="at">d_seq =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)),</span>
<span id="cb1218-13"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># prior</span></span>
<span id="cb1218-14"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">eta =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="fl">1e5</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> <span class="fl">0.25</span>)),</span>
<span id="cb1218-15"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">rho =</span> <span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="fl">1e5</span>, <span class="at">mean =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="fl">0.25</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-16"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-16" aria-hidden="true" tabindex="-1"></a>    tidyr<span class="sc">::</span><span class="fu">expand</span>(<span class="fu">nesting</span>(eta, rho), </span>
<span id="cb1218-17"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">d_seq =</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">0</span>, <span class="at">to =</span> <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">50</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-18"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">k =</span> eta <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rho <span class="sc">*</span> d_seq)) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-19"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(d_seq) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-20"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mean_hdi</span>(k, <span class="at">.width =</span> .<span class="dv">89</span>),</span>
<span id="cb1218-21"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># join them</span></span>
<span id="cb1218-22"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="st">&quot;d_seq&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1218-23"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1218-24"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot!</span></span>
<span id="cb1218-25"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> d_seq)) <span class="sc">+</span></span>
<span id="cb1218-26"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> etasq <span class="sc">*</span> <span class="fu">exp</span>(<span class="sc">-</span>rhosq <span class="sc">*</span> d_seq), <span class="at">group =</span> iter),</span>
<span id="cb1218-27"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#80A0C7&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb1218-28"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lineribbon</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(iter <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb1218-29"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-29" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">y =</span> k, <span class="at">ymin =</span> .lower, <span class="at">ymax =</span> .upper),</span>
<span id="cb1218-30"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">&quot;#A65141&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#E7CDC2&quot;</span>) <span class="sc">+</span></span>
<span id="cb1218-31"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb1218-32"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-32" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="at">y =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>),</span>
<span id="cb1218-33"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;posterior&quot;</span>, <span class="st">&quot;prior&quot;</span>),</span>
<span id="cb1218-34"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="fu">c</span>(<span class="st">&quot;#80A0C7&quot;</span>, <span class="st">&quot;#E7CDC2&quot;</span>),</span>
<span id="cb1218-35"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">family =</span> <span class="st">&quot;Courier&quot;</span>) <span class="sc">+</span></span>
<span id="cb1218-36"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;phylogenetic distance&quot;</span>, </span>
<span id="cb1218-37"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;covariance&quot;</span>) <span class="sc">+</span></span>
<span id="cb1218-38"><a href="13.5-continuous-categories-and-the-gaussian-process.html#cb1218-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="fl">1.5</span>)</span></code></pre></div>
<div class="figure">
<img src="14_adventures_in_covariance_files/figure-html/14.53%20b-1.png" alt="Figure 14.14" width="672" />
<p class="caption marginnote shownote">
Figure 14.14
</p>
</div>
<div class="figure">
<img src="slides/L19/41.png" alt="One of the interesting thing is variables rates in branches. Think about apes. Some have envolved faster (like us). Other pseices are weird too, but other linearages are more conservative. Gorillas are more diverged from one another than bonobos and chimps. Hemiplasy is incomplete lineage sorting. Where no trait fits the tree because species don't splitin an instance. There's this long period where they're not bifrucating. So at different loci you can be more closely related to one species (.ike chimps) and for other loci more closely related to antoher (gorillas). Big thing to try to jreconstruct nodes. Many equilibria as well. How do all of these things trade off? Want to see group size as an emergent outcome of all these different strategies. There's no unique null in evolutionary biology. " width="80%" />
<p class="caption marginnote shownote">
One of the interesting thing is variables rates in branches. Think about apes. Some have envolved faster (like us). Other pseices are weird too, but other linearages are more conservative. Gorillas are more diverged from one another than bonobos and chimps. Hemiplasy is incomplete lineage sorting. Where no trait fits the tree because species don’t splitin an instance. There’s this long period where they’re not bifrucating. So at different loci you can be more closely related to one species (.ike chimps) and for other loci more closely related to antoher (gorillas). Big thing to try to jreconstruct nodes. Many equilibria as well. How do all of these things trade off? Want to see group size as an emergent outcome of all these different strategies. There’s no unique null in evolutionary biology.
</p>
</div>
</div>
<p style="text-align: center;">
<a href="13.4-social-relations-as-correlated-varying-effects.html"><button class="btn btn-default">Previous</button></a>
<a href="13.6-bonus-multilevel-growth-models-and-the-melsm.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>

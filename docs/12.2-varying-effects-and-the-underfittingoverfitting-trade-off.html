<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="12.2 Varying effects and the underfitting/overfitting trade-off | Notes for Statistical Rethinking 2nd ed. by Richard McElreath" />
<meta property="og:type" content="book" />






<meta name="date" content="2021-12-04" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="12.2 Varying effects and the underfitting/overfitting trade-off | Notes for Statistical Rethinking 2nd ed. by Richard McElreath">

<title>12.2 Varying effects and the underfitting/overfitting trade-off | Notes for Statistical Rethinking 2nd ed. by Richard McElreath</title>

<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#index">Index</a></li>
<li><a href="1-the-golem-of-prague.html#the-golem-of-prague"><span class="toc-section-number">1</span> The Golem of Prague</a></li>
<li class="has-sub"><a href="2-small-worlds-and-large-worlds.html#small-worlds-and-large-worlds"><span class="toc-section-number">2</span> Small Worlds and Large Worlds</a>
<ul>
<li><a href="2.1-the-garden-of-forking-data.html#the-garden-of-forking-data"><span class="toc-section-number">2.1</span> The garden of forking data</a></li>
<li><a href="2.2-building-a-model.html#building-a-model"><span class="toc-section-number">2.2</span> Building a model</a></li>
<li><a href="2.3-components-of-the-model.html#components-of-the-model"><span class="toc-section-number">2.3</span> Components of the model</a></li>
<li class="has-sub"><a href="2.4-making-the-model-go.html#making-the-model-go"><span class="toc-section-number">2.4</span> Making the model go</a>
<ul>
<li><a href="2.4-making-the-model-go.html#markov-chain-monte-carlo"><span class="toc-section-number">2.4.1</span> Markov chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="3-sampling-from-the-imaginary.html#sampling-from-the-imaginary"><span class="toc-section-number">3</span> Sampling from the Imaginary</a>
<ul>
<li><a href="3.1-sampling-from-a-grid-approximate-posterior.html#sampling-from-a-grid-approximate-posterior"><span class="toc-section-number">3.1</span> Sampling from a grid-approximate posterior</a></li>
<li><a href="3.2-sampling-to-summarize.html#sampling-to-summarize"><span class="toc-section-number">3.2</span> Sampling to summarize</a></li>
<li><a href="3.3-sampling-to-simulate-prediction.html#sampling-to-simulate-prediction"><span class="toc-section-number">3.3</span> Sampling to simulate prediction</a></li>
<li><a href="3.4-lets-practice-with-brms.html#lets-practice-with-brms"><span class="toc-section-number">3.4</span> Let’s practice with brms</a></li>
<li><a href="practice.html#practice">Practice</a></li>
<li><a href="homework-week-1.html#homework-week-1">Homework: week 1</a></li>
</ul></li>
<li class="has-sub"><a href="4-geocentric-models.html#geocentric-models"><span class="toc-section-number">4</span> Geocentric Models</a>
<ul>
<li><a href="4.1-why-normal-distributions-are-normal.html#why-normal-distributions-are-normal"><span class="toc-section-number">4.1</span> Why normal distributions are normal</a></li>
<li><a href="4.2-a-language-for-describing-models.html#a-language-for-describing-models"><span class="toc-section-number">4.2</span> A language for describing models</a></li>
<li><a href="4.3-gaussian-model-of-height.html#gaussian-model-of-height"><span class="toc-section-number">4.3</span> Gaussian model of height</a></li>
<li><a href="4.4-linear-prediction.html#linear-prediction"><span class="toc-section-number">4.4</span> Linear prediction</a></li>
<li><a href="4.5-curves-from-lines.html#curves-from-lines"><span class="toc-section-number">4.5</span> Curves from lines</a></li>
<li><a href="4.6-practice-1.html#practice-1"><span class="toc-section-number">4.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="5-the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles"><span class="toc-section-number">5</span> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li><a href="5.1-spurious-association.html#spurious-association"><span class="toc-section-number">5.1</span> Spurious association</a></li>
<li><a href="5.2-masked-relationship.html#masked-relationship"><span class="toc-section-number">5.2</span> Masked relationship</a></li>
<li><a href="5.3-categorical-variables.html#categorical-variables"><span class="toc-section-number">5.3</span> Categorical variables</a></li>
<li><a href="5.4-practice-2.html#practice-2"><span class="toc-section-number">5.4</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="6-the-haunted-dag-the-causal-terror.html#the-haunted-dag-the-causal-terror"><span class="toc-section-number">6</span> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li><a href="6.1-multicollinearity.html#multicollinearity"><span class="toc-section-number">6.1</span> Multicollinearity</a></li>
<li><a href="6.2-post-treatment-bias.html#post-treatment-bias"><span class="toc-section-number">6.2</span> Post-treatment bias</a></li>
<li><a href="6.3-collider-bias.html#collider-bias"><span class="toc-section-number">6.3</span> Collider bias</a></li>
<li><a href="6.4-confronting-confounding.html#confronting-confounding"><span class="toc-section-number">6.4</span> Confronting confounding</a></li>
<li><a href="6.5-summary.html#summary"><span class="toc-section-number">6.5</span> Summary</a></li>
<li><a href="6.6-practice-3.html#practice-3"><span class="toc-section-number">6.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="7-ulysses-compass.html#ulysses-compass"><span class="toc-section-number">7</span> Ulysses’ Compass</a>
<ul>
<li><a href="7.1-the-problem-with-parameters.html#the-problem-with-parameters"><span class="toc-section-number">7.1</span> The problem with parameters</a></li>
<li><a href="7.2-entropy-and-accuracy.html#entropy-and-accuracy"><span class="toc-section-number">7.2</span> Entropy and accuracy</a></li>
<li><a href="7.3-golem-taming-regularization.html#golem-taming-regularization"><span class="toc-section-number">7.3</span> Golem taming: regularization</a></li>
<li><a href="7.4-predicting-predictive-accuracy.html#predicting-predictive-accuracy"><span class="toc-section-number">7.4</span> Predicting predictive accuracy</a></li>
<li><a href="7.5-model-comparison.html#model-comparison"><span class="toc-section-number">7.5</span> Model comparison</a></li>
<li><a href="7.6-practice-4.html#practice-4"><span class="toc-section-number">7.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="8-conditional-manatees.html#conditional-manatees"><span class="toc-section-number">8</span> Conditional Manatees</a>
<ul>
<li><a href="8.1-building-an-interaction.html#building-an-interaction"><span class="toc-section-number">8.1</span> Building an interaction</a></li>
<li><a href="8.2-symmetry-of-interactions.html#symmetry-of-interactions"><span class="toc-section-number">8.2</span> Symmetry of interactions</a></li>
<li><a href="8.3-continuous-interactions.html#continuous-interactions"><span class="toc-section-number">8.3</span> Continuous interactions</a></li>
</ul></li>
<li class="has-sub"><a href="9-markov-chain-monte-carlo-1.html#markov-chain-monte-carlo-1"><span class="toc-section-number">9</span> Markov Chain Monte Carlo</a>
<ul>
<li><a href="9.1-good-king-markov-and-his-island-kingdom.html#good-king-markov-and-his-island-kingdom"><span class="toc-section-number">9.1</span> Good King Markov and his island kingdom</a></li>
<li><a href="9.2-metropolis-algorithm.html#metropolis-algorithm"><span class="toc-section-number">9.2</span> Metropolis algorithm</a></li>
<li><a href="9.3-hamiltonian-monte-carlo.html#hamiltonian-monte-carlo"><span class="toc-section-number">9.3</span> Hamiltonian Monte Carlo</a></li>
<li><a href="9.4-easy-hmc-ulam.html#easy-hmc-ulam"><span class="toc-section-number">9.4</span> Easy HMC: <code>ulam</code></a></li>
<li><a href="9.5-care-and-feeding-of-your-markov-chain.html#care-and-feeding-of-your-markov-chain"><span class="toc-section-number">9.5</span> Care and feeding of your Markov chain</a></li>
</ul></li>
<li class="has-sub"><a href="10-big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model"><span class="toc-section-number">10</span> Big Entropy and the Generalized Linear Model</a>
<ul>
<li><a href="10.1-maximum-entropy.html#maximum-entropy"><span class="toc-section-number">10.1</span> Maximum entropy</a></li>
<li><a href="10.2-generalized-linear-models.html#generalized-linear-models"><span class="toc-section-number">10.2</span> Generalized linear models</a></li>
</ul></li>
<li class="has-sub"><a href="11-god-spiked-the-integers.html#god-spiked-the-integers"><span class="toc-section-number">11</span> God Spiked the Integers</a>
<ul>
<li><a href="11.1-binomial-regression.html#binomial-regression"><span class="toc-section-number">11.1</span> Binomial regression</a></li>
<li><a href="11.2-poisson-regression.html#poisson-regression"><span class="toc-section-number">11.2</span> Poisson regression</a></li>
<li><a href="11.3-multinomial-and-categorical-models.html#multinomial-and-categorical-models"><span class="toc-section-number">11.3</span> Multinomial and categorical models</a></li>
</ul></li>
<li class="has-sub"><a href="12-models-with-memory.html#models-with-memory"><span class="toc-section-number">12</span> Models With Memory</a>
<ul>
<li><a href="12.1-example-multilevel-tadpoles.html#example-multilevel-tadpoles"><span class="toc-section-number">12.1</span> Example: Multilevel tadpoles</a></li>
<li><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#varying-effects-and-the-underfittingoverfitting-trade-off"><span class="toc-section-number">12.2</span> Varying effects and the underfitting/overfitting trade-off</a></li>
<li><a href="12.3-more-than-one-type-of-cluster.html#more-than-one-type-of-cluster"><span class="toc-section-number">12.3</span> More than one type of cluster</a></li>
<li><a href="12.4-divergent-transitions-and-non-centered-priors.html#divergent-transitions-and-non-centered-priors"><span class="toc-section-number">12.4</span> Divergent transitions and non-centered priors</a></li>
<li><a href="12.5-multilevel-posterior-predictions.html#multilevel-posterior-predictions"><span class="toc-section-number">12.5</span> Multilevel posterior predictions</a></li>
</ul></li>
<li class="has-sub"><a href="13-adventures-in-covariance.html#adventures-in-covariance"><span class="toc-section-number">13</span> Adventures in Covariance</a>
<ul>
<li><a href="13.1-varying-slopes-by-construction.html#varying-slopes-by-construction"><span class="toc-section-number">13.1</span> Varying slopes by construction</a></li>
<li><a href="13.2-advanced-varying-slopes.html#advanced-varying-slopes"><span class="toc-section-number">13.2</span> Advanced varying slopes</a></li>
<li><a href="13.3-instruments-and-causal-designs.html#instruments-and-causal-designs"><span class="toc-section-number">13.3</span> Instruments and causal designs</a></li>
<li><a href="13.4-social-relations-as-correlated-varying-effects.html#social-relations-as-correlated-varying-effects"><span class="toc-section-number">13.4</span> Social relations as correlated varying effects</a></li>
<li><a href="13.5-continuous-categories-and-the-gaussian-process.html#continuous-categories-and-the-gaussian-process"><span class="toc-section-number">13.5</span> Continuous categories and the Gaussian process</a></li>
<li><a href="13.6-bonus-multilevel-growth-models-and-the-melsm.html#bonus-multilevel-growth-models-and-the-melsm"><span class="toc-section-number">13.6</span> Bonus: Multilevel growth models and the MELSM</a></li>
</ul></li>
<li class="has-sub"><a href="14-missing-data-and-other-opportunities.html#missing-data-and-other-opportunities"><span class="toc-section-number">14</span> Missing Data and Other Opportunities</a>
<ul>
<li><a href="14.1-measurement-error.html#measurement-error"><span class="toc-section-number">14.1</span> Measurement error</a></li>
<li><a href="14.2-missing-data.html#missing-data"><span class="toc-section-number">14.2</span> Missing data</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="varying-effects-and-the-underfittingoverfitting-trade-off" class="section level2" number="12.2">
<h2><span class="header-section-number">12.2</span> Varying effects and the underfitting/overfitting trade-off</h2>
<div class="figure">
<img src="slides/L15/28.png" alt="All of this is really dealing with over/under-fitting. No pooling because there's no information being excahnged among clusters. How much pooling? Depends on variation among clusters. " width="80%" />
<p class="caption marginnote shownote">
All of this is really dealing with over/under-fitting. No pooling because there’s no information being excahnged among clusters. How much pooling? Depends on variation among clusters.
</p>
</div>
<p><strong><em>13.2.1. The model</em></strong></p>
<div class="figure">
<img src="slides/L15/29.png" alt="Try to back this up with a picture. MLM at the top. Focus on $\sigma$. If this was the cafes, it's the variation in wait times. " width="80%" />
<p class="caption marginnote shownote">
Try to back this up with a picture. MLM at the top. Focus on <span class="math inline">\(\sigma\)</span>. If this was the cafes, it’s the variation in wait times.
</p>
</div>
<div class="figure">
<img src="slides/L15/30.png" alt="On the left it has a minimum of 0. If we fix it at 0 or put a really strong prior on it, it converges to the pooling model. All clusters are the same, and it will converge to the grand mean. Exactly one alpha. They're all there, but all the same." width="80%" />
<p class="caption marginnote shownote">
On the left it has a minimum of 0. If we fix it at 0 or put a really strong prior on it, it converges to the pooling model. All clusters are the same, and it will converge to the grand mean. Exactly one alpha. They’re all there, but all the same.
</p>
</div>
<div class="figure">
<img src="slides/L15/31.png" alt="On the other extreme, it's infinity. If sigma goes there, you get no pooling. Statistically assuming all tanks are infinteily different from each other. As a vertebrate, as you go from cafe to cafe, you do the pooling. YOur brain won't let you ignore the variation. But a statistical model won't do that unless you tell it to. If you want to program a robot to borrow information across clusters, you can't let $\sigma$ be infinity. The estimate for any particular alpha will be a mix of the data in that tank and all of the other tanks. The mix depends on the variation on the tanks. If there's no variation across tanks, then the whole population is used. If sigma goes to infitnty , you ignore the population." width="80%" />
<p class="caption marginnote shownote">
On the other extreme, it’s infinity. If sigma goes there, you get no pooling. Statistically assuming all tanks are infinteily different from each other. As a vertebrate, as you go from cafe to cafe, you do the pooling. YOur brain won’t let you ignore the variation. But a statistical model won’t do that unless you tell it to. If you want to program a robot to borrow information across clusters, you can’t let <span class="math inline">\(\sigma\)</span> be infinity. The estimate for any particular alpha will be a mix of the data in that tank and all of the other tanks. The mix depends on the variation on the tanks. If there’s no variation across tanks, then the whole population is used. If sigma goes to infitnty , you ignore the population.
</p>
</div>
<div class="figure">
<img src="slides/L15/32.png" alt="In this particular model, you estimate sigma for the data, and it turns out to be this posterior here. Can get an almost Gaussian posterior. And that's the extreme amount of variation. What does this population look like? Not a real population, but a statistical one." width="80%" />
<p class="caption marginnote shownote">
In this particular model, you estimate sigma for the data, and it turns out to be this posterior here. Can get an almost Gaussian posterior. And that’s the extreme amount of variation. What does this population look like? Not a real population, but a statistical one.
</p>
</div>
<div class="figure">
<img src="slides/L15/33.png" alt="The population-generating process is called an ecologist. Those processes generate popualations with real mortality effects. We can draw this statistical population. Combinations of alphas and betes produce lines. Alphas and betas are correlated, which is why you need to draw correlated smaples from the posterior. Now the lines are a distribution of distributions. We don't know the distribution. Let's draw it. We could just draw correlated pairs as densities. On the left is a gaussian distribution of log-odds probability. Why Gaussian? Because we said it was. Most tadpoles survive. But there's a lot of heterogeneity. You can see that in the distribution. Ont he right I've transofrmed to the outcome probability scale. About half of the tanks we get a high survival rate. " width="80%" />
<p class="caption marginnote shownote">
The population-generating process is called an ecologist. Those processes generate popualations with real mortality effects. We can draw this statistical population. Combinations of alphas and betes produce lines. Alphas and betas are correlated, which is why you need to draw correlated smaples from the posterior. Now the lines are a distribution of distributions. We don’t know the distribution. Let’s draw it. We could just draw correlated pairs as densities. On the left is a gaussian distribution of log-odds probability. Why Gaussian? Because we said it was. Most tadpoles survive. But there’s a lot of heterogeneity. You can see that in the distribution. Ont he right I’ve transofrmed to the outcome probability scale. About half of the tanks we get a high survival rate.
</p>
</div>
<div class="figure">
<img src="slides/L15/34.png" alt="So I keep asserting that the shrinkage estiamtes are better. Let's demonstrate it. We do better in prediction. WAIC works in theory, predicting the out-of-sample accuracy. Regularisation is good. Simulate a bunch of ponds, 60 of them, with different densities of tadpoles in each of 15 ponds. `true.a` is the true log-oddds survival rate. True because we' ve simulated it. THen simulated surivval events. `s`. Therea re some wipeouts, like pond 5. Then the next two are statsitcal estiamtes. `p.nopool` is the raw fixed effects estiamte. The MLM estimate is `p.partpool`. Then `p.true` is the inverse logit of `true.a`. Now we can assess because we can compare it to the truth." width="80%" />
<p class="caption marginnote shownote">
So I keep asserting that the shrinkage estiamtes are better. Let’s demonstrate it. We do better in prediction. WAIC works in theory, predicting the out-of-sample accuracy. Regularisation is good. Simulate a bunch of ponds, 60 of them, with different densities of tadpoles in each of 15 ponds. <code>true.a</code> is the true log-oddds survival rate. True because we’ ve simulated it. THen simulated surivval events. <code>s</code>. Therea re some wipeouts, like pond 5. Then the next two are statsitcal estiamtes. <code>p.nopool</code> is the raw fixed effects estiamte. The MLM estimate is <code>p.partpool</code>. Then <code>p.true</code> is the inverse logit of <code>true.a</code>. Now we can assess because we can compare it to the truth.
</p>
</div>
<p><strong><em>13.2.2. Assign values to the parameters</em></strong></p>
<p>I’ve chosen 60 ponds, with 15 each of initial tadpole density 5, 10, 25, and 35.</p>
<p>Go ahead and inspect the contents of dsim, the simulated data. The first column is the pond index, 1 through 60. The second column is the initial tadpole count in each pond. The third column is the true log-odds survival for each pond.</p>
<div class="sourceCode" id="cb894"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb894-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-1" aria-hidden="true" tabindex="-1"></a>a_bar   <span class="ot">&lt;-</span>  <span class="fl">1.5</span></span>
<span id="cb894-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-2" aria-hidden="true" tabindex="-1"></a>sigma   <span class="ot">&lt;-</span>  <span class="fl">1.5</span></span>
<span id="cb894-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-3" aria-hidden="true" tabindex="-1"></a>n_ponds <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb894-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb894-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5005</span>)</span>
<span id="cb894-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb894-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-7" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span> </span>
<span id="cb894-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">pond   =</span> <span class="dv">1</span><span class="sc">:</span>n_ponds,</span>
<span id="cb894-9"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">ni     =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">35</span>), <span class="at">each =</span> n_ponds <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb894-10"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">true_a =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_ponds, <span class="at">mean =</span> a_bar, <span class="at">sd =</span> sigma))</span>
<span id="cb894-11"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb894-12"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb894-12" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dsim)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##    pond    ni true_a
##   &lt;int&gt; &lt;int&gt;  &lt;dbl&gt;
## 1     1     5  0.567
## 2     2     5  1.99 
## 3     3     5 -0.138
## 4     4     5  1.86 
## 5     5     5  3.91 
## 6     6     5  1.95</code></pre>
<div class="sourceCode" id="cb896"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb896-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb896-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-2" aria-hidden="true" tabindex="-1"></a>dsim <span class="sc">%&gt;%</span> </span>
<span id="cb896-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ni =</span> <span class="fu">factor</span>(ni)) <span class="sc">%&gt;%</span> </span>
<span id="cb896-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb896-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> true_a, <span class="at">y =</span> ni)) <span class="sc">+</span></span>
<span id="cb896-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_dotsinterval</span>(<span class="at">fill =</span> <span class="st">&quot;orange2&quot;</span>, <span class="at">slab_size =</span> <span class="dv">0</span>, <span class="at">.width =</span> .<span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb896-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Log-odds varying by # tadpoles per pond&quot;</span>) <span class="sc">+</span></span>
<span id="cb896-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb896-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>))</span></code></pre></div>
<p><img src="13_models_with_memory_files/figure-html/13.7b-1.png" width="672" /></p>
<p><strong><em>13.2.3. Simulate survivors</em></strong></p>
<p>Now we’re ready to simulate the binomial survival process. Each pond i has ni potential survivors, and nature flips each tadpole’s coin, so to speak, with probability of survival <span class="math inline">\(p_i\)</span>.</p>
<div class="sourceCode" id="cb897"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb897-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">5005</span>)</span>
<span id="cb897-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-3" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span></span>
<span id="cb897-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-4" aria-hidden="true" tabindex="-1"></a>  dsim <span class="sc">%&gt;%</span></span>
<span id="cb897-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">si =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">prob =</span> <span class="fu">inv_logit_scaled</span>(true_a), <span class="at">size =</span> ni))</span>
<span id="cb897-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb897-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-7" aria-hidden="true" tabindex="-1"></a>dsim <span class="sc">%&gt;%</span> </span>
<span id="cb897-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb897-8" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(.)</span></code></pre></div>
<div id="htmlwidget-8dc1d8ecbfa319212a14" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-8dc1d8ecbfa319212a14">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35],[0.566731225916697,1.99002317494446,-0.13775687859197,1.85676650932582,3.91208799855199,1.95414869415232,1.48963804597738,2.52407196100137,2.17828009954472,2.04776577882686,2.74564558621871,-0.637223203961387,3.03948315175108,1.90733693898711,3.54119393742577,0.651656738900955,-1.16943953836601,0.595689725807092,0.385301767109194,1.02961242371106,0.0703400618011099,1.34936970907651,2.45730258119582,-0.0525132598186513,2.20677385792733,1.82918746009262,1.33997119534591,1.57233138408692,1.25467352836639,0.826633085870414,2.65834263895908,2.08241190508737,1.50758907130418,0.862659461420211,0.227217140392512,4.61568929184979,-1.75144379972601,-1.03306026177205,0.23817746617815,5.35841158281757,3.84572461284594,1.81628754938383,-0.342675840819622,0.761115816546673,-1.55979665570298,-0.0845607258183123,4.37882073787451,2.32597648607795,1.78144088540966,1.86990933052614,1.58196519369221,0.155606415030638,1.50345863738438,4.49654574616594,0.565182214792317,2.55806131929059,0.567426780951378,2.74606407790988,1.50422252636709,2.49737954219206],[4,4,3,5,5,4,4,4,3,4,5,2,5,4,5,6,3,5,5,7,4,9,10,6,8,9,8,7,6,7,24,22,24,18,15,25,2,8,15,25,25,22,10,17,5,17,35,35,29,29,29,17,29,35,22,34,23,33,30,33]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>pond<\/th>\n      <th>ni<\/th>\n      <th>true_a<\/th>\n      <th>si<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><strong><em>13.2.4. Compute the no-pooling estimates</em></strong></p>
<div class="sourceCode" id="cb898"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb898-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb898-1" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span></span>
<span id="cb898-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb898-2" aria-hidden="true" tabindex="-1"></a>  dsim <span class="sc">%&gt;%</span></span>
<span id="cb898-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb898-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_nopool =</span> si <span class="sc">/</span> ni)</span>
<span id="cb898-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb898-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb898-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb898-5" aria-hidden="true" tabindex="-1"></a>dsim <span class="sc">%&gt;%</span> </span>
<span id="cb898-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb898-6" aria-hidden="true" tabindex="-1"></a>  DT<span class="sc">::</span><span class="fu">datatable</span>(.)</span></code></pre></div>
<div id="htmlwidget-6802470dedcd3a0169d8" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-6802470dedcd3a0169d8">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60],[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35],[0.566731225916697,1.99002317494446,-0.13775687859197,1.85676650932582,3.91208799855199,1.95414869415232,1.48963804597738,2.52407196100137,2.17828009954472,2.04776577882686,2.74564558621871,-0.637223203961387,3.03948315175108,1.90733693898711,3.54119393742577,0.651656738900955,-1.16943953836601,0.595689725807092,0.385301767109194,1.02961242371106,0.0703400618011099,1.34936970907651,2.45730258119582,-0.0525132598186513,2.20677385792733,1.82918746009262,1.33997119534591,1.57233138408692,1.25467352836639,0.826633085870414,2.65834263895908,2.08241190508737,1.50758907130418,0.862659461420211,0.227217140392512,4.61568929184979,-1.75144379972601,-1.03306026177205,0.23817746617815,5.35841158281757,3.84572461284594,1.81628754938383,-0.342675840819622,0.761115816546673,-1.55979665570298,-0.0845607258183123,4.37882073787451,2.32597648607795,1.78144088540966,1.86990933052614,1.58196519369221,0.155606415030638,1.50345863738438,4.49654574616594,0.565182214792317,2.55806131929059,0.567426780951378,2.74606407790988,1.50422252636709,2.49737954219206],[4,4,3,5,5,4,4,4,3,4,5,2,5,4,5,6,3,5,5,7,4,9,10,6,8,9,8,7,6,7,24,22,24,18,15,25,2,8,15,25,25,22,10,17,5,17,35,35,29,29,29,17,29,35,22,34,23,33,30,33],[0.8,0.8,0.6,1,1,0.8,0.8,0.8,0.6,0.8,1,0.4,1,0.8,1,0.6,0.3,0.5,0.5,0.7,0.4,0.9,1,0.6,0.8,0.9,0.8,0.7,0.6,0.7,0.96,0.88,0.96,0.72,0.6,1,0.08,0.32,0.6,1,1,0.88,0.4,0.68,0.2,0.485714285714286,1,1,0.828571428571429,0.828571428571429,0.828571428571429,0.485714285714286,0.828571428571429,1,0.628571428571429,0.971428571428571,0.657142857142857,0.942857142857143,0.857142857142857,0.942857142857143]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>pond<\/th>\n      <th>ni<\/th>\n      <th>true_a<\/th>\n      <th>si<\/th>\n      <th>p_nopool<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
<p><strong><em>13.2.5. Compute the partial-pooling estimates</em></strong></p>
<div class="sourceCode" id="cb899"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb899-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.3</span> <span class="ot">&lt;-</span> </span>
<span id="cb899-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-2" aria-hidden="true" tabindex="-1"></a>  brms<span class="sc">::</span><span class="fu">brm</span>(<span class="at">data =</span> dsim, </span>
<span id="cb899-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">family =</span> binomial,</span>
<span id="cb899-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-4" aria-hidden="true" tabindex="-1"></a>            si <span class="sc">|</span> <span class="fu">trials</span>(ni) <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> pond),</span>
<span id="cb899-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">prior =</span> <span class="fu">c</span>(<span class="fu">prior</span>(<span class="fu">normal</span>(<span class="dv">0</span>, <span class="fl">1.5</span>), <span class="at">class =</span> Intercept),</span>
<span id="cb899-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-6" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">prior</span>(<span class="fu">exponential</span>(<span class="dv">1</span>), <span class="at">class =</span> sd)),</span>
<span id="cb899-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">iter =</span> <span class="dv">2000</span>, <span class="at">warmup =</span> <span class="dv">1000</span>, <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">4</span>,</span>
<span id="cb899-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb899-9"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">file =</span> <span class="st">&quot;fits/b13.03&quot;</span>)</span>
<span id="cb899-10"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb899-11"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb899-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b13<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##  Family: binomial 
##   Links: mu = logit 
## Formula: si | trials(ni) ~ 1 + (1 | pond) 
##    Data: dsim_tb (Number of observations: 60) 
## Samples: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;
##          total post-warmup samples = 4000
## 
## Group-Level Effects: 
## ~pond (Number of levels: 60) 
##               Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## sd(Intercept)     1.49      0.20     1.14     1.92 1.00     1506     2368
## 
## Population-Level Effects: 
##           Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## Intercept     1.46      0.23     1.03     1.94 1.00      961     1663
## 
## Samples were drawn using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<p>Take a look at the estimates for <span class="math inline">\(\bar{\alpha}\)</span> and <span class="math inline">\(\sigma\)</span>.</p>
<div class="sourceCode" id="cb901"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb901-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb901-1" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.3</span><span class="sc">$</span>fit</span></code></pre></div>
<pre><code>## Inference for Stan model: 50bbea81c6f51c3bd01edfc7641dfc55.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                         mean se_mean   sd    2.5%     25%     50%     75%
## b_Intercept             1.46    0.01 0.23    1.03    1.31    1.46    1.62
## sd_pond__Intercept      1.49    0.01 0.20    1.14    1.35    1.48    1.62
## r_pond[1,Intercept]     0.09    0.01 0.97   -1.71   -0.57    0.05    0.69
## r_pond[2,Intercept]     0.10    0.01 0.96   -1.66   -0.56    0.04    0.71
## r_pond[3,Intercept]    -0.68    0.01 0.84   -2.24   -1.27   -0.70   -0.13
## r_pond[4,Intercept]     1.14    0.01 1.12   -0.86    0.36    1.06    1.86
## r_pond[5,Intercept]     1.14    0.01 1.14   -0.85    0.33    1.06    1.84
## r_pond[6,Intercept]     0.09    0.01 0.96   -1.65   -0.57    0.04    0.71
## r_pond[7,Intercept]     0.09    0.01 0.98   -1.74   -0.59    0.04    0.72
## r_pond[8,Intercept]     0.10    0.01 0.95   -1.62   -0.54    0.06    0.68
## r_pond[9,Intercept]    -0.70    0.01 0.85   -2.35   -1.26   -0.71   -0.13
## r_pond[10,Intercept]    0.10    0.01 0.94   -1.65   -0.53    0.04    0.70
## r_pond[11,Intercept]    1.13    0.01 1.12   -0.89    0.35    1.06    1.81
## r_pond[12,Intercept]   -1.36    0.01 0.83   -2.97   -1.93   -1.36   -0.81
## r_pond[13,Intercept]    1.14    0.01 1.13   -0.86    0.34    1.08    1.86
## r_pond[14,Intercept]    0.08    0.01 0.95   -1.65   -0.57    0.05    0.70
## r_pond[15,Intercept]    1.12    0.01 1.12   -0.86    0.36    1.04    1.83
## r_pond[16,Intercept]   -0.85    0.01 0.63   -2.06   -1.28   -0.85   -0.42
## r_pond[17,Intercept]   -1.95    0.01 0.65   -3.26   -2.38   -1.93   -1.52
## r_pond[18,Intercept]   -1.21    0.01 0.64   -2.46   -1.65   -1.21   -0.80
## r_pond[19,Intercept]   -1.22    0.01 0.65   -2.46   -1.65   -1.22   -0.80
## r_pond[20,Intercept]   -0.43    0.01 0.70   -1.74   -0.91   -0.46    0.02
## r_pond[21,Intercept]   -1.57    0.01 0.65   -2.85   -1.99   -1.56   -1.12
## r_pond[22,Intercept]    0.66    0.01 0.86   -0.86    0.05    0.60    1.20
## r_pond[23,Intercept]    1.55    0.02 1.00   -0.19    0.83    1.48    2.16
## r_pond[24,Intercept]   -0.84    0.01 0.68   -2.13   -1.31   -0.85   -0.40
## r_pond[25,Intercept]    0.06    0.01 0.75   -1.32   -0.47    0.02    0.55
## r_pond[26,Intercept]    0.68    0.01 0.87   -0.86    0.06    0.61    1.22
## r_pond[27,Intercept]    0.06    0.01 0.74   -1.29   -0.46    0.03    0.56
## r_pond[28,Intercept]   -0.44    0.01 0.69   -1.77   -0.90   -0.46    0.01
## r_pond[29,Intercept]   -0.85    0.01 0.65   -2.07   -1.28   -0.86   -0.43
## r_pond[30,Intercept]   -0.45    0.01 0.69   -1.74   -0.93   -0.47    0.00
## r_pond[31,Intercept]    1.41    0.01 0.78    0.03    0.87    1.34    1.90
## r_pond[32,Intercept]    0.55    0.01 0.63   -0.61    0.11    0.53    0.95
## r_pond[33,Intercept]    1.41    0.01 0.78    0.03    0.86    1.37    1.90
## r_pond[34,Intercept]   -0.43    0.01 0.49   -1.37   -0.77   -0.43   -0.11
## r_pond[35,Intercept]   -0.96    0.01 0.46   -1.83   -1.27   -0.97   -0.65
## r_pond[36,Intercept]    2.10    0.01 0.95    0.46    1.44    2.00    2.66
## r_pond[37,Intercept]   -3.37    0.01 0.61   -4.65   -3.76   -3.33   -2.95
## r_pond[38,Intercept]   -2.06    0.01 0.46   -2.99   -2.36   -2.05   -1.75
## r_pond[39,Intercept]   -0.97    0.01 0.47   -1.90   -1.27   -0.97   -0.65
## r_pond[40,Intercept]    2.10    0.01 0.95    0.47    1.43    2.02    2.66
## r_pond[41,Intercept]    2.11    0.01 0.94    0.55    1.44    2.02    2.67
## r_pond[42,Intercept]    0.55    0.01 0.60   -0.52    0.13    0.52    0.92
## r_pond[43,Intercept]   -1.74    0.01 0.46   -2.66   -2.04   -1.73   -1.43
## r_pond[44,Intercept]   -0.63    0.01 0.47   -1.49   -0.94   -0.65   -0.32
## r_pond[45,Intercept]   -2.63    0.01 0.50   -3.63   -2.95   -2.62   -2.29
## r_pond[46,Intercept]   -1.44    0.01 0.40   -2.22   -1.71   -1.44   -1.18
## r_pond[47,Intercept]    2.34    0.01 0.92    0.74    1.69    2.26    2.90
## r_pond[48,Intercept]    2.33    0.01 0.93    0.78    1.67    2.25    2.88
## r_pond[49,Intercept]    0.16    0.01 0.48   -0.75   -0.16    0.14    0.47
## r_pond[50,Intercept]    0.16    0.01 0.49   -0.78   -0.17    0.15    0.48
## r_pond[51,Intercept]    0.15    0.01 0.48   -0.77   -0.17    0.15    0.47
## r_pond[52,Intercept]   -1.44    0.01 0.39   -2.24   -1.71   -1.44   -1.17
## r_pond[53,Intercept]    0.16    0.01 0.48   -0.73   -0.17    0.15    0.49
## r_pond[54,Intercept]    2.32    0.01 0.91    0.77    1.67    2.25    2.89
## r_pond[55,Intercept]   -0.88    0.01 0.42   -1.70   -1.15   -0.87   -0.60
## r_pond[56,Intercept]    1.70    0.01 0.76    0.36    1.17    1.64    2.16
## r_pond[57,Intercept]   -0.76    0.01 0.41   -1.53   -1.03   -0.76   -0.49
## r_pond[58,Intercept]    1.23    0.01 0.66    0.02    0.78    1.17    1.65
## r_pond[59,Intercept]    0.37    0.01 0.52   -0.58    0.01    0.34    0.71
## r_pond[60,Intercept]    1.23    0.01 0.65    0.10    0.77    1.19    1.64
## lp__                 -185.86    0.25 7.57 -201.09 -190.96 -185.44 -180.61
##                        97.5% n_eff Rhat
## b_Intercept             1.94   948    1
## sd_pond__Intercept      1.92  1480    1
## r_pond[1,Intercept]     2.17  7322    1
## r_pond[2,Intercept]     2.12  6248    1
## r_pond[3,Intercept]     1.00  5687    1
## r_pond[4,Intercept]     3.53  6376    1
## r_pond[5,Intercept]     3.62  6681    1
## r_pond[6,Intercept]     2.09  5908    1
## r_pond[7,Intercept]     2.11  6581    1
## r_pond[8,Intercept]     2.12  6627    1
## r_pond[9,Intercept]     1.01  6139    1
## r_pond[10,Intercept]    2.11  6207    1
## r_pond[11,Intercept]    3.54  6635    1
## r_pond[12,Intercept]    0.22  6388    1
## r_pond[13,Intercept]    3.51  6325    1
## r_pond[14,Intercept]    2.08  6733    1
## r_pond[15,Intercept]    3.54  6781    1
## r_pond[16,Intercept]    0.41  5022    1
## r_pond[17,Intercept]   -0.77  4933    1
## r_pond[18,Intercept]    0.06  5232    1
## r_pond[19,Intercept]    0.13  4799    1
## r_pond[20,Intercept]    0.99  5399    1
## r_pond[21,Intercept]   -0.34  4858    1
## r_pond[22,Intercept]    2.51  5055    1
## r_pond[23,Intercept]    3.75  4406    1
## r_pond[24,Intercept]    0.53  4207    1
## r_pond[25,Intercept]    1.58  4978    1
## r_pond[26,Intercept]    2.56  5753    1
## r_pond[27,Intercept]    1.63  5016    1
## r_pond[28,Intercept]    0.97  5209    1
## r_pond[29,Intercept]    0.43  4208    1
## r_pond[30,Intercept]    0.97  5670    1
## r_pond[31,Intercept]    3.11  5320    1
## r_pond[32,Intercept]    1.86  3754    1
## r_pond[33,Intercept]    3.06  5328    1
## r_pond[34,Intercept]    0.57  3148    1
## r_pond[35,Intercept]   -0.04  2441    1
## r_pond[36,Intercept]    4.25  4792    1
## r_pond[37,Intercept]   -2.24  3989    1
## r_pond[38,Intercept]   -1.18  3079    1
## r_pond[39,Intercept]   -0.05  3260    1
## r_pond[40,Intercept]    4.19  4059    1
## r_pond[41,Intercept]    4.22  4566    1
## r_pond[42,Intercept]    1.83  3807    1
## r_pond[43,Intercept]   -0.85  2776    1
## r_pond[44,Intercept]    0.34  2879    1
## r_pond[45,Intercept]   -1.71  3504    1
## r_pond[46,Intercept]   -0.66  2260    1
## r_pond[47,Intercept]    4.35  5553    1
## r_pond[48,Intercept]    4.38  4558    1
## r_pond[49,Intercept]    1.13  3172    1
## r_pond[50,Intercept]    1.15  2688    1
## r_pond[51,Intercept]    1.14  3165    1
## r_pond[52,Intercept]   -0.68  2353    1
## r_pond[53,Intercept]    1.12  2764    1
## r_pond[54,Intercept]    4.38  4731    1
## r_pond[55,Intercept]   -0.03  2715    1
## r_pond[56,Intercept]    3.41  5144    1
## r_pond[57,Intercept]    0.06  2612    1
## r_pond[58,Intercept]    2.64  4193    1
## r_pond[59,Intercept]    1.40  3089    1
## r_pond[60,Intercept]    2.60  3791    1
## lp__                 -171.64   889    1
## 
## Samples were drawn using NUTS(diag_e) at Fri Aug 13 15:58:51 2021.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
<p>Compute the survival proportions and add them to our growing simulation data frame.</p>
<div class="sourceCode" id="cb903"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb903-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we could have included this step in the block of code below, if we wanted to</span></span>
<span id="cb903-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-2" aria-hidden="true" tabindex="-1"></a>p_partpool <span class="ot">&lt;-</span> </span>
<span id="cb903-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(b13<span class="fl">.3</span>)<span class="sc">$</span>pond[, , ] <span class="sc">%&gt;%</span> </span>
<span id="cb903-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb903-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">p_partpool =</span> <span class="fu">inv_logit_scaled</span>(Estimate))</span>
<span id="cb903-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-7" aria-hidden="true" tabindex="-1"></a>dsim <span class="ot">&lt;-</span> </span>
<span id="cb903-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-8" aria-hidden="true" tabindex="-1"></a>  dsim <span class="sc">%&gt;%</span></span>
<span id="cb903-9"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(p_partpool) <span class="sc">%&gt;%</span> </span>
<span id="cb903-10"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_true =</span> <span class="fu">inv_logit_scaled</span>(true_a)) <span class="sc">%&gt;%</span></span>
<span id="cb903-11"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nopool_error   =</span> <span class="fu">abs</span>(p_nopool   <span class="sc">-</span> p_true),</span>
<span id="cb903-12"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">partpool_error =</span> <span class="fu">abs</span>(p_partpool <span class="sc">-</span> p_true))</span>
<span id="cb903-13"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb903-14"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-14" aria-hidden="true" tabindex="-1"></a>dsim <span class="sc">%&gt;%</span> </span>
<span id="cb903-15"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb903-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 60
## Columns: 9
## $ pond           &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, …
## $ ni             &lt;int&gt; 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 10, 10, 10…
## $ true_a         &lt;dbl&gt; 0.56673123, 1.99002317, -0.13775688, 1.85676651, 3.9120…
## $ si             &lt;int&gt; 4, 4, 3, 5, 5, 4, 4, 4, 3, 4, 5, 2, 5, 4, 5, 6, 3, 5, 5…
## $ p_nopool       &lt;dbl&gt; 0.8, 0.8, 0.6, 1.0, 1.0, 0.8, 0.8, 0.8, 0.6, 0.8, 1.0, …
## $ p_partpool     &lt;dbl&gt; 0.8256632, 0.8267518, 0.6859881, 0.9313513, 0.9308751, …
## $ p_true         &lt;dbl&gt; 0.6380086, 0.8797456, 0.4656151, 0.8649196, 0.9803934, …
## $ nopool_error   &lt;dbl&gt; 0.16199142, 0.07974559, 0.13438486, 0.13508039, 0.01960…
## $ partpool_error &lt;dbl&gt; 0.1876546251, 0.0529937565, 0.2203729151, 0.0664317322,…</code></pre>
<p>Compare to the true per-pond survival probabilities.</p>
<p>Now plot</p>
<div class="sourceCode" id="cb905"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb905-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-1" aria-hidden="true" tabindex="-1"></a>dfline <span class="ot">&lt;-</span> </span>
<span id="cb905-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-2" aria-hidden="true" tabindex="-1"></a>  dsim <span class="sc">%&gt;%</span></span>
<span id="cb905-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ni, nopool_error<span class="sc">:</span>partpool_error) <span class="sc">%&gt;%</span></span>
<span id="cb905-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-4" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>ni) <span class="sc">%&gt;%</span></span>
<span id="cb905-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(name, ni) <span class="sc">%&gt;%</span></span>
<span id="cb905-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_error =</span> <span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb905-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x    =</span> <span class="fu">c</span>( <span class="dv">1</span>, <span class="dv">16</span>, <span class="dv">31</span>, <span class="dv">46</span>),</span>
<span id="cb905-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb905-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">xend =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">30</span>, <span class="dv">45</span>, <span class="dv">60</span>))</span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;name&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb907"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb907-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-1" aria-hidden="true" tabindex="-1"></a>dsim <span class="sc">%&gt;%</span> </span>
<span id="cb907-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> pond)) <span class="sc">+</span></span>
<span id="cb907-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">15.5</span>, <span class="fl">30.5</span>, <span class="fl">45.4</span>), </span>
<span id="cb907-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb907-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> nopool_error), <span class="at">color =</span> <span class="st">&quot;orange2&quot;</span>) <span class="sc">+</span></span>
<span id="cb907-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> partpool_error), <span class="at">shape =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb907-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> dfline, </span>
<span id="cb907-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-8" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> xend, </span>
<span id="cb907-9"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> mean_error, <span class="at">yend =</span> mean_error),</span>
<span id="cb907-10"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;orange2&quot;</span>, <span class="st">&quot;black&quot;</span>), <span class="at">each =</span> <span class="dv">4</span>),</span>
<span id="cb907-11"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">each =</span> <span class="dv">4</span>)) <span class="sc">+</span></span>
<span id="cb907-12"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>, </span>
<span id="cb907-13"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">15</span> <span class="sc">-</span> <span class="fl">7.5</span>, <span class="dv">30</span> <span class="sc">-</span> <span class="fl">7.5</span>, <span class="dv">45</span> <span class="sc">-</span> <span class="fl">7.5</span>, <span class="dv">60</span> <span class="sc">-</span> <span class="fl">7.5</span>), <span class="at">y =</span> .<span class="dv">45</span>, </span>
<span id="cb907-14"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;tiny (5)&quot;</span>, <span class="st">&quot;small (10)&quot;</span>, <span class="st">&quot;medium (25)&quot;</span>, <span class="st">&quot;large (35)&quot;</span>)) <span class="sc">+</span></span>
<span id="cb907-15"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">40</span>, <span class="dv">50</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb907-16"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimate error by model type&quot;</span>,</span>
<span id="cb907-17"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;The horizontal axis displays pond number. The vertical axis measures</span><span class="sc">\n</span><span class="st">the absolute error in the predicted proportion of survivors, compared to</span><span class="sc">\n</span><span class="st">the true value used in the simulation. The higher the point, the worse</span><span class="sc">\n</span><span class="st">the estimate. No-pooling shown in orange. Partial pooling shown in black.</span><span class="sc">\n</span><span class="st">The orange and dashed black lines show the average error for each kind</span><span class="sc">\n</span><span class="st">of estimate, across each initial density of tadpoles (pond size).&quot;</span>,</span>
<span id="cb907-18"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;absolute error&quot;</span>) <span class="sc">+</span></span>
<span id="cb907-19"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb907-20"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb907-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="13_models_with_memory_files/figure-html/13.18%20b-1.png" width="672" /></p>
<p>Or quantify the difference in simple summaries:</p>
<div class="sourceCode" id="cb908"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb908-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb908-1" aria-hidden="true" tabindex="-1"></a>dsim <span class="sc">%&gt;%</span></span>
<span id="cb908-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb908-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ni, nopool_error<span class="sc">:</span>partpool_error) <span class="sc">%&gt;%</span></span>
<span id="cb908-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb908-3" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="sc">-</span>ni) <span class="sc">%&gt;%</span></span>
<span id="cb908-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb908-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(name) <span class="sc">%&gt;%</span></span>
<span id="cb908-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb908-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">mean_error   =</span> <span class="fu">mean</span>(value) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>),</span>
<span id="cb908-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb908-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_error =</span> <span class="fu">median</span>(value) <span class="sc">%&gt;%</span> <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">3</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   name           mean_error median_error
##   &lt;chr&gt;               &lt;dbl&gt;        &lt;dbl&gt;
## 1 nopool_error        0.059        0.042
## 2 partpool_error      0.054        0.034</code></pre>
<p>Once you’ve compiled <code>m13.3</code> once, you can use this code to re-simulate ponds and sample from the new posterior, without waiting for the model to compile again:</p>
<div class="figure">
<img src="slides/L15/35.png" alt="On the left we have tiny ponds. The blue points are the raw proportions survived. The open points are the partial pooling estimates. The error is the absolute error from the true value. 0 is totally correct. A lot of error here because you've only got 5 tadpoles. Hard to estimate the probability of heads if you only flip the coin 5 times. THe blue horizontal bar is the average of the raw estimates, the dashed is for the MLM. They're not perfect, but they're better. THis is all shrinkage. " width="80%" />
<p class="caption marginnote shownote">
On the left we have tiny ponds. The blue points are the raw proportions survived. The open points are the partial pooling estimates. The error is the absolute error from the true value. 0 is totally correct. A lot of error here because you’ve only got 5 tadpoles. Hard to estimate the probability of heads if you only flip the coin 5 times. THe blue horizontal bar is the average of the raw estimates, the dashed is for the MLM. They’re not perfect, but they’re better. THis is all shrinkage.
</p>
</div>
<p><img src="slides/L15/36.png" width="80%" /></p>
<div class="figure">
<img src="slides/L15/37.png" alt="The other tanks. The pattern holds as you go across. The amount of error declines, because we have more data. The difference, the advantage of MLMs, shrinks. But still estimates the popualtion, which is important for prediction. So even when it doesn't give you bettre predictions, it allows you to make them in the right way because it takes account of populations. " width="80%" />
<p class="caption marginnote shownote">
The other tanks. The pattern holds as you go across. The amount of error declines, because we have more data. The difference, the advantage of MLMs, shrinks. But still estimates the popualtion, which is important for prediction. So even when it doesn’t give you bettre predictions, it allows you to make them in the right way because it takes account of populations.
</p>
</div>
<p><strong>Overthinking::repeating the pond simulation</strong></p>
<div class="sourceCode" id="cb910"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb910-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Error in unserialize(socklist[[n]]) : error reading from connection</span></span>
<span id="cb910-2"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-3"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate new data</span></span>
<span id="cb910-4"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-4" aria-hidden="true" tabindex="-1"></a>a_bar   <span class="ot">&lt;-</span>  <span class="fl">1.5</span></span>
<span id="cb910-5"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-5" aria-hidden="true" tabindex="-1"></a>sigma   <span class="ot">&lt;-</span>  <span class="fl">1.5</span></span>
<span id="cb910-6"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-6" aria-hidden="true" tabindex="-1"></a>n_ponds <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb910-7"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-8"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1999</span>)  <span class="co"># for new data, set a new seed</span></span>
<span id="cb910-9"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-10"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-10" aria-hidden="true" tabindex="-1"></a>new_dsim <span class="ot">&lt;-</span> </span>
<span id="cb910-11"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">pond   =</span> <span class="dv">1</span><span class="sc">:</span>n_ponds,</span>
<span id="cb910-12"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">ni     =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">25</span>, <span class="dv">35</span>), <span class="at">each =</span> n_ponds <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> <span class="fu">as.integer</span>(),</span>
<span id="cb910-13"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">true_a =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> n_ponds, <span class="at">mean =</span> a_bar, <span class="at">sd =</span> sigma)) <span class="sc">%&gt;%</span> </span>
<span id="cb910-14"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">si =</span> <span class="fu">rbinom</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">prob =</span> <span class="fu">inv_logit_scaled</span>(true_a), <span class="at">size =</span> ni)) <span class="sc">%&gt;%</span> </span>
<span id="cb910-15"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p_nopool =</span> si <span class="sc">/</span> ni)</span>
<span id="cb910-16"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-17"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-17" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(new_dsim)</span>
<span id="cb910-18"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-19"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the new model</span></span>
<span id="cb910-20"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-20" aria-hidden="true" tabindex="-1"></a>b13<span class="fl">.3</span>_new <span class="ot">&lt;-</span> </span>
<span id="cb910-21"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">update</span>(b13<span class="fl">.3</span>,</span>
<span id="cb910-22"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">newdata =</span> new_dsim,</span>
<span id="cb910-23"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">chains =</span> <span class="dv">4</span>, <span class="at">cores =</span> <span class="dv">1</span>,</span>
<span id="cb910-24"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">seed =</span> <span class="dv">13</span>,</span>
<span id="cb910-25"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;fits/b13.03_new&quot;</span>)</span>
<span id="cb910-26"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb910-27"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb910-27" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(b13<span class="fl">.3</span>_new)</span></code></pre></div>
<hr />
<div class="sourceCode" id="cb911"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb911-1"><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#cb911-1" aria-hidden="true" tabindex="-1"></a>slides_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;docs/slides/L16&quot;</span>)</span></code></pre></div>
<p><img src="slides/L16/01.png" width="80%" /></p>
</div>
<p style="text-align: center;">
<a href="12.1-example-multilevel-tadpoles.html"><button class="btn btn-default">Previous</button></a>
<a href="12.3-more-than-one-type-of-cluster.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>

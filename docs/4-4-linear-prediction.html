<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="4.4 Linear prediction | Notes for Statistical Rethinking 2nd ed. by Richard McElreath" />
<meta property="og:type" content="book" />






<meta name="date" content="2021-05-31" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="4.4 Linear prediction | Notes for Statistical Rethinking 2nd ed. by Richard McElreath">

<title>4.4 Linear prediction | Notes for Statistical Rethinking 2nd ed. by Richard McElreath</title>

<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#index">Index</a></li>
<li><a href="1-the-golem-of-prague.html#the-golem-of-prague"><span class="toc-section-number">1</span> The Golem of Prague</a></li>
<li><a href="2-small-worlds-and-large-worlds.html#small-worlds-and-large-worlds"><span class="toc-section-number">2</span> Small Worlds and Large Worlds</a>
<ul>
<li><a href="2-1-the-garden-of-forking-data.html#the-garden-of-forking-data"><span class="toc-section-number">2.1</span> The garden of forking data</a></li>
<li><a href="2-2-building-a-model.html#building-a-model"><span class="toc-section-number">2.2</span> Building a model</a></li>
<li><a href="2-3-components-of-the-model.html#components-of-the-model"><span class="toc-section-number">2.3</span> Components of the model</a></li>
<li><a href="2-4-making-the-model-go.html#making-the-model-go"><span class="toc-section-number">2.4</span> Making the model go</a></li>
</ul></li>
<li><a href="3-sampling-from-the-imaginary.html#sampling-from-the-imaginary"><span class="toc-section-number">3</span> Sampling from the Imaginary</a>
<ul>
<li><a href="3-1-sampling-from-a-grid-approximate-posterior.html#sampling-from-a-grid-approximate-posterior"><span class="toc-section-number">3.1</span> Sampling from a grid-approximate posterior</a></li>
<li><a href="3-2-sampling-to-summarize.html#sampling-to-summarize"><span class="toc-section-number">3.2</span> Sampling to summarize</a></li>
<li><a href="3-3-sampling-to-simulate-prediction.html#sampling-to-simulate-prediction"><span class="toc-section-number">3.3</span> Sampling to simulate prediction</a></li>
<li><a href="practice.html#practice">Practice</a></li>
<li><a href="homework-week-1.html#homework-week-1">Homework: week 1</a></li>
</ul></li>
<li><a href="4-geocentric-models.html#geocentric-models"><span class="toc-section-number">4</span> Geocentric Models</a>
<ul>
<li><a href="4-1-why-normal-distributions-are-normal.html#why-normal-distributions-are-normal"><span class="toc-section-number">4.1</span> Why normal distributions are normal</a></li>
<li><a href="4-2-a-language-for-describing-models.html#a-language-for-describing-models"><span class="toc-section-number">4.2</span> A language for describing models</a></li>
<li><a href="4-3-gaussian-model-of-height.html#gaussian-model-of-height"><span class="toc-section-number">4.3</span> Gaussian model of height</a></li>
<li><a href="4-4-linear-prediction.html#linear-prediction"><span class="toc-section-number">4.4</span> Linear prediction</a></li>
<li><a href="4-5-curves-from-lines.html#curves-from-lines"><span class="toc-section-number">4.5</span> Curves from lines</a></li>
<li><a href="4-6-practice-1.html#practice-1"><span class="toc-section-number">4.6</span> Practice</a></li>
</ul></li>
<li><a href="5-the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles"><span class="toc-section-number">5</span> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li><a href="5-1-spurious-association.html#spurious-association"><span class="toc-section-number">5.1</span> Spurious association</a></li>
</ul></li>
<li><a href="6-the-haunted-dag-the-causal-terror.html#the-haunted-dag-the-causal-terror"><span class="toc-section-number">6</span> The Haunted DAG &amp; The Causal Terror</a></li>
<li><a href="7-ulysses-compass.html#ulysses-compass"><span class="toc-section-number">7</span> Ulysses’ Compass</a></li>
<li><a href="8-conditional-manatees.html#conditional-manatees"><span class="toc-section-number">8</span> Conditional Manatees</a></li>
<li><a href="9-markov-chain-monte-carlo.html#markov-chain-monte-carlo"><span class="toc-section-number">9</span> Markov Chain Monte Carlo</a></li>
<li><a href="10-big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model"><span class="toc-section-number">10</span> Big Entropy and the Generalized Linear Model</a></li>
<li><a href="11-god-spiked-the-integers.html#god-spiked-the-integers"><span class="toc-section-number">11</span> God Spiked the Integers</a></li>
<li><a href="12-monsters-and-mixtures.html#monsters-and-mixtures"><span class="toc-section-number">12</span> Monsters and Mixtures</a></li>
<li><a href="13-models-with-memory.html#models-with-memory"><span class="toc-section-number">13</span> Models With Memory</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="linear-prediction" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Linear prediction</h2>
<p>Let’s look at how height in these Kalahari foragers covaries with weight.</p>
<p><img src="slides/L03/38.png" width="80%" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="4-4-linear-prediction.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1); d <span class="ot">&lt;-</span> Howell1; d2 <span class="ot">&lt;-</span> d[ d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span> , ]</span>
<span id="cb144-2"><a href="4-4-linear-prediction.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( d2<span class="sc">$</span>height <span class="sc">~</span> d2<span class="sc">$</span>weight )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.37-1.svg" width="672" /></p>
<p>So now let’s add a line. When we learn the predictions, we can learn the statistical association between weight and height. The question is how would you statistically describe this relationship?</p>
<p><strong><em>4.4.1 The linear model strategy</em></strong></p>
<div class="figure">
<img src="slides/L03/39.png" alt="So what do we do? We add another variable to the model, and now we have a linear regression. This model has all the standard features. Now there's an $i$ on $\mu$. That means it's different for each person. $\alpha$ is out population mean. $\beta$ describes the relationship between $x$ and $y$." width="80%" />
<p class="caption marginnote shownote">
So what do we do? We add another variable to the model, and now we have a linear regression. This model has all the standard features. Now there’s an <span class="math inline">\(i\)</span> on <span class="math inline">\(\mu\)</span>. That means it’s different for each person. <span class="math inline">\(\alpha\)</span> is out population mean. <span class="math inline">\(\beta\)</span> describes the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span>.
</p>
</div>
<div class="figure">
<img src="slides/L03/40.png" alt="The equals sign mean that it's deterministically defined. $\beta$ is what you'd call a slope, or the rate of change in $mu$ for a unit change in $x$. Why do we subtract x bar? This is called centering the predictor. Should be your default behaviour." width="80%" />
<p class="caption marginnote shownote">
The equals sign mean that it’s deterministically defined. <span class="math inline">\(\beta\)</span> is what you’d call a slope, or the rate of change in <span class="math inline">\(mu\)</span> for a unit change in <span class="math inline">\(x\)</span>. Why do we subtract x bar? This is called centering the predictor. Should be your default behaviour.
</p>
</div>
<div class="figure">
<img src="slides/L03/41.png" alt="It's now predicting lines. So what does the prior predictive distribution look like? A whole lot of lines." width="80%" />
<p class="caption marginnote shownote">
It’s now predicting lines. So what does the prior predictive distribution look like? A whole lot of lines.
</p>
</div>
<p><img src="slides/L03/42.png" width="80%" /></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="4-4-linear-prediction.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb145-2"><a href="4-4-linear-prediction.html#cb145-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">=</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb145-3"><a href="4-4-linear-prediction.html#cb145-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="fu">rnorm</span>(N, <span class="dv">178</span>, <span class="dv">20</span>)</span>
<span id="cb145-4"><a href="4-4-linear-prediction.html#cb145-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">rnorm</span>(N, <span class="dv">0</span>, <span class="dv">10</span>)</span></code></pre></div>
<p>Now we have 100 paris of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(\beta\)</span> values.</p>
<p>Simulate 100 lines as before.</p>
<p><img src="slides/L03/43.png" width="80%" /></p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="4-4-linear-prediction.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NULL</span> , <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>), <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;height&quot;</span> )</span>
<span id="cb146-2"><a href="4-4-linear-prediction.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">h=</span><span class="dv">0</span> , <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb146-3"><a href="4-4-linear-prediction.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">h=</span><span class="dv">272</span> , <span class="at">lty=</span><span class="dv">1</span> , <span class="at">lwd=</span><span class="fl">0.5</span> )</span>
<span id="cb146-4"><a href="4-4-linear-prediction.html#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>( <span class="st">&quot;b ~ dnorm(0,10)&quot;</span> )</span>
<span id="cb146-5"><a href="4-4-linear-prediction.html#cb146-5" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb146-6"><a href="4-4-linear-prediction.html#cb146-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ) <span class="fu">curve</span>( a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x <span class="sc">-</span> xbar),</span>
<span id="cb146-7"><a href="4-4-linear-prediction.html#cb146-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight) ,</span>
<span id="cb146-8"><a href="4-4-linear-prediction.html#cb146-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight) , <span class="at">add=</span><span class="cn">TRUE</span> ,</span>
<span id="cb146-9"><a href="4-4-linear-prediction.html#cb146-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>) )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.39-1.svg" width="672" /></p>
<p>Getting the scatter right is important, because you can see these impossibly steep lines. Some of them take you from impossibly short individuals to twice the tallest. Want to dampen these expectations. Practise on these safe examples.</p>
<div class="figure">
<img src="slides/L03/44.png" alt="We know that $\beta$ is positive, so let's make it positive. A log normal distribution is a normal distribution logged. What's nice is that they're all positive. We want to assume the relationship between weight and height is positive." width="80%" />
<p class="caption marginnote shownote">
We know that <span class="math inline">\(\beta\)</span> is positive, so let’s make it positive. A log normal distribution is a normal distribution logged. What’s nice is that they’re all positive. We want to assume the relationship between weight and height is positive.
</p>
</div>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="4-4-linear-prediction.html#cb147-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">=</span> <span class="fu">rlnorm</span>(<span class="fl">1e4</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb147-2"><a href="4-4-linear-prediction.html#cb147-2" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">dens</span>(b, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">5</span>), <span class="at">adj =</span> <span class="fl">0.1</span>)</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.40-1.svg" width="672" /></p>
<p><img src="slides/L03/45.png" width="80%" /></p>
<p>Still a lot of scatter, but still one crazy line. Now at least we’re in the possible range.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="4-4-linear-prediction.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2971</span>)</span>
<span id="cb148-2"><a href="4-4-linear-prediction.html#cb148-2" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 100 lines</span></span>
<span id="cb148-3"><a href="4-4-linear-prediction.html#cb148-3" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">rnorm</span>( N , <span class="dv">178</span> , <span class="dv">20</span> )</span>
<span id="cb148-4"><a href="4-4-linear-prediction.html#cb148-4" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">rlnorm</span>( N , <span class="dv">0</span> , <span class="dv">1</span> )</span>
<span id="cb148-5"><a href="4-4-linear-prediction.html#cb148-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb148-6"><a href="4-4-linear-prediction.html#cb148-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NULL</span> , <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>,<span class="dv">400</span>), <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;height&quot;</span> )</span>
<span id="cb148-7"><a href="4-4-linear-prediction.html#cb148-7" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">h=</span><span class="dv">0</span> , <span class="at">lty=</span><span class="dv">2</span> )</span>
<span id="cb148-8"><a href="4-4-linear-prediction.html#cb148-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>( <span class="at">h=</span><span class="dv">272</span> , <span class="at">lty=</span><span class="dv">1</span> , <span class="at">lwd=</span><span class="fl">0.5</span> )</span>
<span id="cb148-9"><a href="4-4-linear-prediction.html#cb148-9" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>( <span class="st">&quot;b ~ dnorm(0,10)&quot;</span> )</span>
<span id="cb148-10"><a href="4-4-linear-prediction.html#cb148-10" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb148-11"><a href="4-4-linear-prediction.html#cb148-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ) <span class="fu">curve</span>( a[i] <span class="sc">+</span> b[i]<span class="sc">*</span>(x <span class="sc">-</span> xbar),</span>
<span id="cb148-12"><a href="4-4-linear-prediction.html#cb148-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">from=</span><span class="fu">min</span>(d2<span class="sc">$</span>weight) ,</span>
<span id="cb148-13"><a href="4-4-linear-prediction.html#cb148-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">to=</span><span class="fu">max</span>(d2<span class="sc">$</span>weight) , <span class="at">add=</span><span class="cn">TRUE</span> ,</span>
<span id="cb148-14"><a href="4-4-linear-prediction.html#cb148-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.2</span>) )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.41-1.svg" width="672" /></p>
<blockquote>
<p>How to choose a prior? The procedure we’ve performed in this chapter is to choose priors conditional on pre-data knowledge of the variables - their constraints, ranges, and theoretical relationships.</p>
</blockquote>
<p><strong><em>4.4.2 Finding the posterior distribution</em></strong></p>
<div class="figure">
<img src="slides/L03/46.png" alt="Measure $\bar{x}$ Then define the `quap` model. Focus on the $\mu$ line. " width="80%" />
<p class="caption marginnote shownote">
Measure <span class="math inline">\(\bar{x}\)</span> Then define the <code>quap</code> model. Focus on the <span class="math inline">\(\mu\)</span> line.
</p>
</div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="4-4-linear-prediction.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load data again, since it&#39;s a long way back</span></span>
<span id="cb149-2"><a href="4-4-linear-prediction.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Howell1); d <span class="ot">&lt;-</span> Howell1; d2 <span class="ot">&lt;-</span> d[ d<span class="sc">$</span>age <span class="sc">&gt;=</span> <span class="dv">18</span> , ]</span>
<span id="cb149-3"><a href="4-4-linear-prediction.html#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="co"># define the average weight, x-bar</span></span>
<span id="cb149-4"><a href="4-4-linear-prediction.html#cb149-4" aria-hidden="true" tabindex="-1"></a>xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(d2<span class="sc">$</span>weight)</span>
<span id="cb149-5"><a href="4-4-linear-prediction.html#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co"># fit model</span></span>
<span id="cb149-6"><a href="4-4-linear-prediction.html#cb149-6" aria-hidden="true" tabindex="-1"></a>m4<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb149-7"><a href="4-4-linear-prediction.html#cb149-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb149-8"><a href="4-4-linear-prediction.html#cb149-8" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb149-9"><a href="4-4-linear-prediction.html#cb149-9" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">*</span>( weight <span class="sc">-</span> xbar ) ,</span>
<span id="cb149-10"><a href="4-4-linear-prediction.html#cb149-10" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ) ,</span>
<span id="cb149-11"><a href="4-4-linear-prediction.html#cb149-11" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ) ,</span>
<span id="cb149-12"><a href="4-4-linear-prediction.html#cb149-12" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb149-13"><a href="4-4-linear-prediction.html#cb149-13" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>d2 )</span></code></pre></div>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="4-4-linear-prediction.html#cb150-1" aria-hidden="true" tabindex="-1"></a>m4<span class="fl">.3</span>b <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb150-2"><a href="4-4-linear-prediction.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb150-3"><a href="4-4-linear-prediction.html#cb150-3" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb150-4"><a href="4-4-linear-prediction.html#cb150-4" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> <span class="fu">exp</span>(log_b)<span class="sc">*</span>( weight <span class="sc">-</span> xbar ),</span>
<span id="cb150-5"><a href="4-4-linear-prediction.html#cb150-5" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ) ,</span>
<span id="cb150-6"><a href="4-4-linear-prediction.html#cb150-6" aria-hidden="true" tabindex="-1"></a>    log_b <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">0</span> , <span class="dv">1</span>),</span>
<span id="cb150-7"><a href="4-4-linear-prediction.html#cb150-7" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb150-8"><a href="4-4-linear-prediction.html#cb150-8" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>d2 )</span></code></pre></div>
<p><strong><em>4.4.3 Interpreting the posterior distribution</em></strong></p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="4-4-linear-prediction.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">precis</span>(m4<span class="fl">.3</span>)</span></code></pre></div>
<pre><code>##              mean         sd        5.5%       94.5%
## a     154.6013671 0.27030766 154.1693633 155.0333710
## b       0.9032807 0.04192363   0.8362787   0.9702828
## sigma   5.0718809 0.19115478   4.7663786   5.3773831</code></pre>
<p>See the covariances:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="4-4-linear-prediction.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(rethinking<span class="sc">::</span><span class="fu">vcov</span>(m4<span class="fl">.3</span>), <span class="dv">3</span>)</span></code></pre></div>
<pre><code>##           a     b sigma
## a     0.073 0.000 0.000
## b     0.000 0.002 0.000
## sigma 0.000 0.000 0.037</code></pre>
<p>Very little covariation among the parameters in this case.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="4-4-linear-prediction.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show both the marginal posteriors and the covariance</span></span>
<span id="cb155-2"><a href="4-4-linear-prediction.html#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(m4<span class="fl">.3</span>)</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/unnamed-chunk-48-1.svg" width="672" />
In the practice problems at the end of the chapter, you’ll see that the lack of covariance among the parameters results from <strong>Centering</strong>.</p>
<p>Plot the data with the posterior mean values for <code>a</code> and <code>b</code>:</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="4-4-linear-prediction.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( height <span class="sc">~</span> weight , <span class="at">data=</span>d2 , <span class="at">col=</span>rangi2 )</span>
<span id="cb156-2"><a href="4-4-linear-prediction.html#cb156-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>( m4<span class="fl">.3</span> )</span>
<span id="cb156-3"><a href="4-4-linear-prediction.html#cb156-3" aria-hidden="true" tabindex="-1"></a>a_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>a)</span>
<span id="cb156-4"><a href="4-4-linear-prediction.html#cb156-4" aria-hidden="true" tabindex="-1"></a>b_map <span class="ot">&lt;-</span> <span class="fu">mean</span>(post<span class="sc">$</span>b)</span>
<span id="cb156-5"><a href="4-4-linear-prediction.html#cb156-5" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>( a_map <span class="sc">+</span> b_map<span class="sc">*</span>(x <span class="sc">-</span> xbar) , <span class="at">add=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.46-1.svg" width="672" /></p>
<div class="figure">
<img src="slides/L03/47.png" alt="We managed to get this posterior distribution, and we can take from the precis values the `a` and `b`b values and draw a line with those, where `a` is the expected value of height (155) when weight is at its average value. And the expected change in height is nearly 1. But the posterior distribution is not a single line, it's an infinite number of lines each with a probability. So let's get more lines on the graph to show the uncertainty in inference. " width="80%" />
<p class="caption marginnote shownote">
We managed to get this posterior distribution, and we can take from the precis values the <code>a</code> and <code>b</code>b values and draw a line with those, where <code>a</code> is the expected value of height (155) when weight is at its average value. And the expected change in height is nearly 1. But the posterior distribution is not a single line, it’s an infinite number of lines each with a probability. So let’s get more lines on the graph to show the uncertainty in inference.
</p>
</div>
<div class="figure">
<img src="slides/L03/48.png" alt="Here's the basic idea. We're going to sample from the posterior distribution. But what's great is that you can use this process for any model you ever want to fit. You can sample from the posterior, then push the samples back through the model itself to plot the uncertainty." width="80%" />
<p class="caption marginnote shownote">
Here’s the basic idea. We’re going to sample from the posterior distribution. But what’s great is that you can use this process for any model you ever want to fit. You can sample from the posterior, then push the samples back through the model itself to plot the uncertainty.
</p>
</div>
<div class="figure">
<img src="slides/L03/49.png" alt="You're doing calculus here, but just doesn't feel like it. Each row is a line. Lines that are more plausible have more ways to happen, so they're overlap more in the areas that are more plausible." width="80%" />
<p class="caption marginnote shownote">
You’re doing calculus here, but just doesn’t feel like it. Each row is a line. Lines that are more plausible have more ways to happen, so they’re overlap more in the areas that are more plausible.
</p>
</div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="4-4-linear-prediction.html#cb157-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">=</span> rethinking<span class="sc">::</span><span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb157-2"><a href="4-4-linear-prediction.html#cb157-2" aria-hidden="true" tabindex="-1"></a>post[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, ]</span></code></pre></div>
<pre><code>##          a         b    sigma
## 1 154.4622 0.9150822 5.341227
## 2 154.2649 0.9236067 5.160423
## 3 155.1258 0.9495934 5.108891
## 4 154.5923 0.8458252 4.994873
## 5 154.2600 0.9065280 5.110351</code></pre>
<div class="figure">
<img src="slides/L03/50.png" alt="To see this work, and reinforce how Bayesian updating works, let's start with a reduced dataset of 10 randomly sampled adults. We fit our linear regression model, and get a quadratic approximation of the posterior distribution. You'll see they're very different from the prior. Now they're very concentrated around the data. You can see there's a lot of scatter because the model isn't sure where it should be." width="80%" />
<p class="caption marginnote shownote">
To see this work, and reinforce how Bayesian updating works, let’s start with a reduced dataset of 10 randomly sampled adults. We fit our linear regression model, and get a quadratic approximation of the posterior distribution. You’ll see they’re very different from the prior. Now they’re very concentrated around the data. You can see there’s a lot of scatter because the model isn’t sure where it should be.
</p>
</div>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="4-4-linear-prediction.html#cb159-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb159-2"><a href="4-4-linear-prediction.html#cb159-2" aria-hidden="true" tabindex="-1"></a>dN <span class="ot">&lt;-</span> d2[ <span class="dv">1</span><span class="sc">:</span>N , ]</span>
<span id="cb159-3"><a href="4-4-linear-prediction.html#cb159-3" aria-hidden="true" tabindex="-1"></a>mN <span class="ot">&lt;-</span> <span class="fu">quap</span>(</span>
<span id="cb159-4"><a href="4-4-linear-prediction.html#cb159-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">alist</span>(</span>
<span id="cb159-5"><a href="4-4-linear-prediction.html#cb159-5" aria-hidden="true" tabindex="-1"></a>    height <span class="sc">~</span> <span class="fu">dnorm</span>( mu , sigma ) ,</span>
<span id="cb159-6"><a href="4-4-linear-prediction.html#cb159-6" aria-hidden="true" tabindex="-1"></a>    mu <span class="ot">&lt;-</span> a <span class="sc">+</span> b<span class="sc">*</span>( weight <span class="sc">-</span> <span class="fu">mean</span>(weight) ) ,</span>
<span id="cb159-7"><a href="4-4-linear-prediction.html#cb159-7" aria-hidden="true" tabindex="-1"></a>    a <span class="sc">~</span> <span class="fu">dnorm</span>( <span class="dv">178</span> , <span class="dv">20</span> ) ,</span>
<span id="cb159-8"><a href="4-4-linear-prediction.html#cb159-8" aria-hidden="true" tabindex="-1"></a>    b <span class="sc">~</span> <span class="fu">dlnorm</span>( <span class="dv">0</span> , <span class="dv">1</span> ) ,</span>
<span id="cb159-9"><a href="4-4-linear-prediction.html#cb159-9" aria-hidden="true" tabindex="-1"></a>    sigma <span class="sc">~</span> <span class="fu">dunif</span>( <span class="dv">0</span> , <span class="dv">50</span> )</span>
<span id="cb159-10"><a href="4-4-linear-prediction.html#cb159-10" aria-hidden="true" tabindex="-1"></a>  ) , <span class="at">data=</span>dN )</span></code></pre></div>
<p>Now plot 20 of these lines:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="4-4-linear-prediction.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract 20 samples from the posterior</span></span>
<span id="cb160-2"><a href="4-4-linear-prediction.html#cb160-2" aria-hidden="true" tabindex="-1"></a>post <span class="ot">&lt;-</span> <span class="fu">extract.samples</span>( mN , <span class="at">n=</span><span class="dv">20</span> )</span>
<span id="cb160-3"><a href="4-4-linear-prediction.html#cb160-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-4"><a href="4-4-linear-prediction.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="co"># display raw data and sample size</span></span>
<span id="cb160-5"><a href="4-4-linear-prediction.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( dN<span class="sc">$</span>weight , dN<span class="sc">$</span>height ,</span>
<span id="cb160-6"><a href="4-4-linear-prediction.html#cb160-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlim=</span><span class="fu">range</span>(d2<span class="sc">$</span>weight) , <span class="at">ylim=</span><span class="fu">range</span>(d2<span class="sc">$</span>height) ,</span>
<span id="cb160-7"><a href="4-4-linear-prediction.html#cb160-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">col=</span>rangi2 , <span class="at">xlab=</span><span class="st">&quot;weight&quot;</span> , <span class="at">ylab=</span><span class="st">&quot;height&quot;</span> )</span>
<span id="cb160-8"><a href="4-4-linear-prediction.html#cb160-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mtext</span>(<span class="fu">concat</span>(<span class="st">&quot;N = &quot;</span>,N))</span>
<span id="cb160-9"><a href="4-4-linear-prediction.html#cb160-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-10"><a href="4-4-linear-prediction.html#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the lines, with transparency</span></span>
<span id="cb160-11"><a href="4-4-linear-prediction.html#cb160-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> )</span>
<span id="cb160-12"><a href="4-4-linear-prediction.html#cb160-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">curve</span>( post<span class="sc">$</span>a[i] <span class="sc">+</span> post<span class="sc">$</span>b[i]<span class="sc">*</span>(x<span class="sc">-</span><span class="fu">mean</span>(dN<span class="sc">$</span>weight)) ,</span>
<span id="cb160-13"><a href="4-4-linear-prediction.html#cb160-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">col=</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.3</span>) , <span class="at">add=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.49-1.svg" width="672" /></p>
<div class="figure">
<img src="slides/L03/51.png" alt="Now add 50, and you'll see they get more concentrated. Note the uncertainty at the ends are more uncertain. They pivot around the means in the centre." width="80%" />
<p class="caption marginnote shownote">
Now add 50, and you’ll see they get more concentrated. Note the uncertainty at the ends are more uncertain. They pivot around the means in the centre.
</p>
</div>
<p><img src="slides/L03/52.png" width="80%" /></p>
<div class="figure">
<img src="slides/L03/53.png" alt="With the whole dataset, it gets quite narrow. You constrained the model to pick a line, and these are the lines that it likes. Doesn't mean that it's right." width="80%" />
<p class="caption marginnote shownote">
With the whole dataset, it gets quite narrow. You constrained the model to pick a line, and these are the lines that it likes. Doesn’t mean that it’s right.
</p>
</div>
<hr />
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="4-4-linear-prediction.html#cb161-1" aria-hidden="true" tabindex="-1"></a>slides_dir <span class="ot">=</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;docs/slides/L04&quot;</span>)</span></code></pre></div>
<p><img src="slides/L04/01.png" width="80%" /></p>
<p><img src="slides/L04/09.png" width="80%" /></p>
<p>The basic idea that any particular value of the <span class="math inline">\(x\)</span> variables, <span class="math inline">\(\mu\)</span> has some density. It’s confident of the values on the inside, less of the values on the outside. As an example, what does the model expect the height of the individual is if weight is 50? <span class="math inline">\(\mu\)</span> at 50 is now going to create a distribution.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="4-4-linear-prediction.html#cb162-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">=</span> rethinking<span class="sc">::</span><span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb162-2"><a href="4-4-linear-prediction.html#cb162-2" aria-hidden="true" tabindex="-1"></a>mu_at_50 <span class="ot">=</span> post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b <span class="sc">*</span> (<span class="dv">50</span> <span class="sc">-</span> xbar)</span>
<span id="cb162-3"><a href="4-4-linear-prediction.html#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mu_at_50)</span></code></pre></div>
<pre><code>## [1] 159.0740 159.4226 158.9418 159.2489 159.2202 159.2177</code></pre>
<p><code>mu_at_50</code> is a vector of predicted means, one for each random sample from the posterior.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="4-4-linear-prediction.html#cb164-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">dens</span>(mu_at_50, <span class="at">col =</span> rangi2, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&quot;mu|weight = 50&quot;</span>)</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.51-1.svg" width="672" />
Find the 89% compatibility interval</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="4-4-linear-prediction.html#cb165-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">PI</span>(mu_at_50, <span class="at">prob =</span> .<span class="dv">89</span>)</span></code></pre></div>
<pre><code>##       5%      94% 
## 158.5785 159.6799</code></pre>
<p><img src="slides/L04/10.png" width="80%" /></p>
<p>It’s not sure how tall an individual is, but it thinks it’s in this region. But we want to do this for every x-axis value. This is what produces the smooth bowtie.</p>
<p><img src="slides/L04/11.png" width="80%" /></p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="4-4-linear-prediction.html#cb167-1" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> rethinking<span class="sc">::</span><span class="fu">link</span>(m4<span class="fl">.3</span>)</span>
<span id="cb167-2"><a href="4-4-linear-prediction.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:352] 157 157 157 157 157 ...</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="4-4-linear-prediction.html#cb169-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">dens</span>(mu)</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.53-1.svg" width="672" /></p>
<p>You need to make a sequence of x-axis values (<code>weight.seq</code>). You could make it extraplote further if you like. Then you send these in to the funciton via <code>link</code>. There’s a box in the chapter that shows you how link works. It just loops, but saves you time.</p>
<p>What you end up with in <span class="math inline">\(m\)</span> is 1000 rows, where each column is a value of weight. Then you can plot these up.</p>
<p>There are 352 rows in <code>d2</code>, corresponding to 352 individuals. What to do with this big matrix? <code>link</code> provides a posterior distribution of <span class="math inline">\(\mu\)</span> for each case we feed it. We actually want a distribution of <span class="math inline">\(\mu\)</span> for each unique weight value on the horizontal axis. Just pass it some new data:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="4-4-linear-prediction.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define sequence of weights to compute predictions for</span></span>
<span id="cb170-2"><a href="4-4-linear-prediction.html#cb170-2" aria-hidden="true" tabindex="-1"></a><span class="co"># these vaules will be on the horizontal axis</span></span>
<span id="cb170-3"><a href="4-4-linear-prediction.html#cb170-3" aria-hidden="true" tabindex="-1"></a>weight.seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">25</span>, <span class="at">to =</span> <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb170-4"><a href="4-4-linear-prediction.html#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="4-4-linear-prediction.html#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="co"># use link to compute mu</span></span>
<span id="cb170-6"><a href="4-4-linear-prediction.html#cb170-6" aria-hidden="true" tabindex="-1"></a><span class="co"># for each sample from posterior</span></span>
<span id="cb170-7"><a href="4-4-linear-prediction.html#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="co"># and for each weight in weight.seq</span></span>
<span id="cb170-8"><a href="4-4-linear-prediction.html#cb170-8" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> rethinking<span class="sc">::</span><span class="fu">link</span>(m4<span class="fl">.3</span>, <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">weight =</span> weight.seq))</span>
<span id="cb170-9"><a href="4-4-linear-prediction.html#cb170-9" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mu)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:46] 136 137 137 136 137 ...</code></pre>
<p>And now there are only 46 columns in <code>mu</code>, because we fed it 46 different values for <code>weight</code>. Let’s plot the distribution:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="4-4-linear-prediction.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># use type=&quot;n&quot; to hide raw data</span></span>
<span id="cb172-2"><a href="4-4-linear-prediction.html#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, d2, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb172-3"><a href="4-4-linear-prediction.html#cb172-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4"><a href="4-4-linear-prediction.html#cb172-4" aria-hidden="true" tabindex="-1"></a><span class="co"># loop over samples and plot each mu value</span></span>
<span id="cb172-5"><a href="4-4-linear-prediction.html#cb172-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)</span>
<span id="cb172-6"><a href="4-4-linear-prediction.html#cb172-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>(weight.seq, mu[i,] , <span class="at">pch =</span> <span class="dv">16</span>, <span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2, .<span class="dv">1</span>))</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.55-1.svg" width="672" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="4-4-linear-prediction.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize the distribution of mu</span></span>
<span id="cb173-2"><a href="4-4-linear-prediction.html#cb173-2" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">=</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb173-3"><a href="4-4-linear-prediction.html#cb173-3" aria-hidden="true" tabindex="-1"></a>mu.PI <span class="ot">=</span>  <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob =</span> .<span class="dv">89</span>)</span></code></pre></div>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="4-4-linear-prediction.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw data</span></span>
<span id="cb174-2"><a href="4-4-linear-prediction.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Fading out points to make line and interval more visible</span></span>
<span id="cb174-3"><a href="4-4-linear-prediction.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(height <span class="sc">~</span> weight, <span class="at">data =</span> d2, <span class="at">col =</span> <span class="fu">col.alpha</span>(rangi2, <span class="fl">0.5</span>))</span>
<span id="cb174-4"><a href="4-4-linear-prediction.html#cb174-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-5"><a href="4-4-linear-prediction.html#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot the MAP line, aka the mean mu for each weight</span></span>
<span id="cb174-6"><a href="4-4-linear-prediction.html#cb174-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(weight.seq, mu.mean)</span>
<span id="cb174-7"><a href="4-4-linear-prediction.html#cb174-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb174-8"><a href="4-4-linear-prediction.html#cb174-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Plot a shaded region for 89% PI</span></span>
<span id="cb174-9"><a href="4-4-linear-prediction.html#cb174-9" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>(mu.PI, weight.seq)</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.57-1.svg" width="672" /></p>
<p>Here’s the recipe for generating predictions and intervals from the posterior of a fit model:
1. Use <code>link</code> to generate distributions of posteriro values for <span class="math inline">\(\mu\)</span>. The default behaviour os <code>link</code> is to use the original data, so you have to pass it a list of new horizontal axis values you want to plot posterior predictions across.
1. Use summary functions like <code>mean</code> or <code>PI</code> to find averages and lower and upper bounds of <span class="math inline">\(\mu\)</span> for each value of the predictor variable.
1. Finally, use plotting functions like <code>lines</code> and <code>shade</code> to draw the lines and intervals. Or you might plot the distributions of the predictions, or do further numerical calculations with them. It’s really up to you.</p>
<div class="figure">
<img src="slides/L04/12.png" alt="This is like rolling your own `link` here." width="80%" />
<p class="caption marginnote shownote">
This is like rolling your own <code>link</code> here.
</p>
</div>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="4-4-linear-prediction.html#cb175-1" aria-hidden="true" tabindex="-1"></a>post <span class="ot">=</span> <span class="fu">extract.samples</span>(m4<span class="fl">.3</span>)</span>
<span id="cb175-2"><a href="4-4-linear-prediction.html#cb175-2" aria-hidden="true" tabindex="-1"></a>mu.link <span class="ot">=</span> <span class="cf">function</span>(weight) post<span class="sc">$</span>a <span class="sc">+</span> post<span class="sc">$</span>b<span class="sc">*</span>( weight <span class="sc">-</span> xbar )</span>
<span id="cb175-3"><a href="4-4-linear-prediction.html#cb175-3" aria-hidden="true" tabindex="-1"></a>weight.seq <span class="ot">=</span> <span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">25</span>, <span class="at">to =</span> <span class="dv">70</span>, <span class="at">by =</span> <span class="dv">1</span>)</span>
<span id="cb175-4"><a href="4-4-linear-prediction.html#cb175-4" aria-hidden="true" tabindex="-1"></a>mu <span class="ot">=</span> <span class="fu">sapply</span>(weight.seq, mu.link)</span>
<span id="cb175-5"><a href="4-4-linear-prediction.html#cb175-5" aria-hidden="true" tabindex="-1"></a>mu.mean <span class="ot">=</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, mean)</span>
<span id="cb175-6"><a href="4-4-linear-prediction.html#cb175-6" aria-hidden="true" tabindex="-1"></a>mu.CI <span class="ot">=</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, PI, <span class="at">prob =</span> <span class="fl">0.89</span>)</span>
<span id="cb175-7"><a href="4-4-linear-prediction.html#cb175-7" aria-hidden="true" tabindex="-1"></a>mu.HPDI <span class="ot">=</span> <span class="fu">apply</span>(mu, <span class="dv">2</span>, HPDI, <span class="at">prob =</span> <span class="fl">0.89</span>)</span></code></pre></div>
<p>Whatever model you find yourself with, this approach can be used to generate posterior predictions for any component of it.</p>
<div class="figure">
<img src="slides/L04/13.png" alt="Think what's going on with the distribution. Fuzzy bowtie. There's a grey bowtie on the right that follows the same distribution on the left. Just comes from plotting the compatibility interval of the bowtie." width="80%" />
<p class="caption marginnote shownote">
Think what’s going on with the distribution. Fuzzy bowtie. There’s a grey bowtie on the right that follows the same distribution on the left. Just comes from plotting the compatibility interval of the bowtie.
</p>
</div>
<div class="figure">
<img src="slides/L04/14.png" alt="Again, there's a correspondence between the spaghetti lines, and the bowtie form..." width="80%" />
<p class="caption marginnote shownote">
Again, there’s a correspondence between the spaghetti lines, and the bowtie form…
</p>
</div>
<div class="figure">
<img src="slides/L04/15.png" alt="Same information, just a different visual style." width="80%" />
<p class="caption marginnote shownote">
Same information, just a different visual style.
</p>
</div>
<div class="figure">
<img src="slides/L04/16.png" alt="One benefit of the spaghetti lines is it prevents you from thinking the boundary is some magical event. Nothing happens at that boundary. Probability is a continuous space. We can do the same thing for sigma. There's an envelope we expect heights to be in. Helper function called `sim` that shows conceptually what's happening. " width="80%" />
<p class="caption marginnote shownote">
One benefit of the spaghetti lines is it prevents you from thinking the boundary is some magical event. Nothing happens at that boundary. Probability is a continuous space. We can do the same thing for sigma. There’s an envelope we expect heights to be in. Helper function called <code>sim</code> that shows conceptually what’s happening.
</p>
</div>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="4-4-linear-prediction.html#cb176-1" aria-hidden="true" tabindex="-1"></a>sim.height <span class="ot">=</span> <span class="fu">sim</span>(m4<span class="fl">.3</span>, <span class="at">data =</span> <span class="fu">list</span>(<span class="at">weight =</span> weight.seq))</span>
<span id="cb176-2"><a href="4-4-linear-prediction.html#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(sim.height)</span></code></pre></div>
<pre><code>##  num [1:1000, 1:46] 133 140 132 139 136 ...</code></pre>
<p>This matrix is like the earlier one, <code>mu</code>, but contains simulated heights, not distributions of plausible average height, <span class="math inline">\(\mu\)</span>.</p>
<p>Summarise these simmulated heights in the same way:</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="4-4-linear-prediction.html#cb178-1" aria-hidden="true" tabindex="-1"></a>height.PI <span class="ot">=</span> <span class="fu">apply</span>(sim.height, <span class="dv">2</span>, PI, <span class="at">prob =</span> <span class="fl">0.89</span>)</span></code></pre></div>
<p>Now <code>height.PI</code> contains the 89% posterior prediction interval of observable (according to the model) heights, across the values of weight in <code>weight.seq</code>.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="4-4-linear-prediction.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw data</span></span>
<span id="cb179-2"><a href="4-4-linear-prediction.html#cb179-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( height <span class="sc">~</span> weight , d2 , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>) )</span>
<span id="cb179-3"><a href="4-4-linear-prediction.html#cb179-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-4"><a href="4-4-linear-prediction.html#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="co"># draw MAP line</span></span>
<span id="cb179-5"><a href="4-4-linear-prediction.html#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>( weight.seq , mu.mean )</span>
<span id="cb179-6"><a href="4-4-linear-prediction.html#cb179-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-7"><a href="4-4-linear-prediction.html#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co"># draw HPDI region for line</span></span>
<span id="cb179-8"><a href="4-4-linear-prediction.html#cb179-8" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>( mu.HPDI , weight.seq )</span>
<span id="cb179-9"><a href="4-4-linear-prediction.html#cb179-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-10"><a href="4-4-linear-prediction.html#cb179-10" aria-hidden="true" tabindex="-1"></a><span class="co"># draw PI region for simulated heights</span></span>
<span id="cb179-11"><a href="4-4-linear-prediction.html#cb179-11" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>( height.PI , weight.seq )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/4.61-1.svg" width="672" /></p>
<p>If the rough shaded interval bothers you, increase the number of samples from the posterior distribution.</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="4-4-linear-prediction.html#cb180-1" aria-hidden="true" tabindex="-1"></a>sim.height <span class="ot">&lt;-</span> <span class="fu">sim</span>( m4<span class="fl">.3</span> , <span class="at">data=</span><span class="fu">list</span>(<span class="at">weight=</span>weight.seq) , <span class="at">n=</span><span class="fl">1e4</span> )</span>
<span id="cb180-2"><a href="4-4-linear-prediction.html#cb180-2" aria-hidden="true" tabindex="-1"></a>height.PI <span class="ot">&lt;-</span> <span class="fu">apply</span>( sim.height , <span class="dv">2</span> , PI , <span class="at">prob=</span><span class="fl">0.89</span> )</span></code></pre></div>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="4-4-linear-prediction.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot raw data</span></span>
<span id="cb181-2"><a href="4-4-linear-prediction.html#cb181-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( height <span class="sc">~</span> weight , d2 , <span class="at">col=</span><span class="fu">col.alpha</span>(rangi2,<span class="fl">0.5</span>) )</span>
<span id="cb181-3"><a href="4-4-linear-prediction.html#cb181-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-4"><a href="4-4-linear-prediction.html#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="co"># draw MAP line</span></span>
<span id="cb181-5"><a href="4-4-linear-prediction.html#cb181-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>( weight.seq , mu.mean )</span>
<span id="cb181-6"><a href="4-4-linear-prediction.html#cb181-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-7"><a href="4-4-linear-prediction.html#cb181-7" aria-hidden="true" tabindex="-1"></a><span class="co"># draw HPDI region for line</span></span>
<span id="cb181-8"><a href="4-4-linear-prediction.html#cb181-8" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>( mu.HPDI , weight.seq )</span>
<span id="cb181-9"><a href="4-4-linear-prediction.html#cb181-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-10"><a href="4-4-linear-prediction.html#cb181-10" aria-hidden="true" tabindex="-1"></a><span class="co"># draw PI region for simulated heights</span></span>
<span id="cb181-11"><a href="4-4-linear-prediction.html#cb181-11" aria-hidden="true" tabindex="-1"></a><span class="fu">shade</span>( height.PI , weight.seq )</span></code></pre></div>
<p><img src="04_geocentric_models_files/figure-html/unnamed-chunk-66-1.svg" width="672" /></p>
</div>
<p style="text-align: center;">
<a href="4-3-gaussian-model-of-height.html"><button class="btn btn-default">Previous</button></a>
<a href="4-5-curves-from-lines.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>

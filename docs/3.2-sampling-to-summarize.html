<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.2 Sampling to summarize | Notes for Statistical Rethinking 2nd ed. by Richard McElreath" />
<meta property="og:type" content="book" />






<meta name="date" content="2021-12-04" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="3.2 Sampling to summarize | Notes for Statistical Rethinking 2nd ed. by Richard McElreath">

<title>3.2 Sampling to summarize | Notes for Statistical Rethinking 2nd ed. by Richard McElreath</title>

<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#index">Index</a></li>
<li><a href="1-the-golem-of-prague.html#the-golem-of-prague"><span class="toc-section-number">1</span> The Golem of Prague</a></li>
<li class="has-sub"><a href="2-small-worlds-and-large-worlds.html#small-worlds-and-large-worlds"><span class="toc-section-number">2</span> Small Worlds and Large Worlds</a>
<ul>
<li><a href="2.1-the-garden-of-forking-data.html#the-garden-of-forking-data"><span class="toc-section-number">2.1</span> The garden of forking data</a></li>
<li><a href="2.2-building-a-model.html#building-a-model"><span class="toc-section-number">2.2</span> Building a model</a></li>
<li><a href="2.3-components-of-the-model.html#components-of-the-model"><span class="toc-section-number">2.3</span> Components of the model</a></li>
<li class="has-sub"><a href="2.4-making-the-model-go.html#making-the-model-go"><span class="toc-section-number">2.4</span> Making the model go</a>
<ul>
<li><a href="2.4-making-the-model-go.html#markov-chain-monte-carlo"><span class="toc-section-number">2.4.1</span> Markov chain Monte Carlo</a></li>
</ul></li>
</ul></li>
<li class="has-sub"><a href="3-sampling-from-the-imaginary.html#sampling-from-the-imaginary"><span class="toc-section-number">3</span> Sampling from the Imaginary</a>
<ul>
<li><a href="3.1-sampling-from-a-grid-approximate-posterior.html#sampling-from-a-grid-approximate-posterior"><span class="toc-section-number">3.1</span> Sampling from a grid-approximate posterior</a></li>
<li><a href="3.2-sampling-to-summarize.html#sampling-to-summarize"><span class="toc-section-number">3.2</span> Sampling to summarize</a></li>
<li><a href="3.3-sampling-to-simulate-prediction.html#sampling-to-simulate-prediction"><span class="toc-section-number">3.3</span> Sampling to simulate prediction</a></li>
<li><a href="3.4-lets-practice-with-brms.html#lets-practice-with-brms"><span class="toc-section-number">3.4</span> Let’s practice with brms</a></li>
<li><a href="practice.html#practice">Practice</a></li>
<li><a href="homework-week-1.html#homework-week-1">Homework: week 1</a></li>
</ul></li>
<li class="has-sub"><a href="4-geocentric-models.html#geocentric-models"><span class="toc-section-number">4</span> Geocentric Models</a>
<ul>
<li><a href="4.1-why-normal-distributions-are-normal.html#why-normal-distributions-are-normal"><span class="toc-section-number">4.1</span> Why normal distributions are normal</a></li>
<li><a href="4.2-a-language-for-describing-models.html#a-language-for-describing-models"><span class="toc-section-number">4.2</span> A language for describing models</a></li>
<li><a href="4.3-gaussian-model-of-height.html#gaussian-model-of-height"><span class="toc-section-number">4.3</span> Gaussian model of height</a></li>
<li><a href="4.4-linear-prediction.html#linear-prediction"><span class="toc-section-number">4.4</span> Linear prediction</a></li>
<li><a href="4.5-curves-from-lines.html#curves-from-lines"><span class="toc-section-number">4.5</span> Curves from lines</a></li>
<li><a href="4.6-practice-1.html#practice-1"><span class="toc-section-number">4.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="5-the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles"><span class="toc-section-number">5</span> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li><a href="5.1-spurious-association.html#spurious-association"><span class="toc-section-number">5.1</span> Spurious association</a></li>
<li><a href="5.2-masked-relationship.html#masked-relationship"><span class="toc-section-number">5.2</span> Masked relationship</a></li>
<li><a href="5.3-categorical-variables.html#categorical-variables"><span class="toc-section-number">5.3</span> Categorical variables</a></li>
<li><a href="5.4-practice-2.html#practice-2"><span class="toc-section-number">5.4</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="6-the-haunted-dag-the-causal-terror.html#the-haunted-dag-the-causal-terror"><span class="toc-section-number">6</span> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li><a href="6.1-multicollinearity.html#multicollinearity"><span class="toc-section-number">6.1</span> Multicollinearity</a></li>
<li><a href="6.2-post-treatment-bias.html#post-treatment-bias"><span class="toc-section-number">6.2</span> Post-treatment bias</a></li>
<li><a href="6.3-collider-bias.html#collider-bias"><span class="toc-section-number">6.3</span> Collider bias</a></li>
<li><a href="6.4-confronting-confounding.html#confronting-confounding"><span class="toc-section-number">6.4</span> Confronting confounding</a></li>
<li><a href="6.5-summary.html#summary"><span class="toc-section-number">6.5</span> Summary</a></li>
<li><a href="6.6-practice-3.html#practice-3"><span class="toc-section-number">6.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="7-ulysses-compass.html#ulysses-compass"><span class="toc-section-number">7</span> Ulysses’ Compass</a>
<ul>
<li><a href="7.1-the-problem-with-parameters.html#the-problem-with-parameters"><span class="toc-section-number">7.1</span> The problem with parameters</a></li>
<li><a href="7.2-entropy-and-accuracy.html#entropy-and-accuracy"><span class="toc-section-number">7.2</span> Entropy and accuracy</a></li>
<li><a href="7.3-golem-taming-regularization.html#golem-taming-regularization"><span class="toc-section-number">7.3</span> Golem taming: regularization</a></li>
<li><a href="7.4-predicting-predictive-accuracy.html#predicting-predictive-accuracy"><span class="toc-section-number">7.4</span> Predicting predictive accuracy</a></li>
<li><a href="7.5-model-comparison.html#model-comparison"><span class="toc-section-number">7.5</span> Model comparison</a></li>
<li><a href="7.6-practice-4.html#practice-4"><span class="toc-section-number">7.6</span> Practice</a></li>
</ul></li>
<li class="has-sub"><a href="8-conditional-manatees.html#conditional-manatees"><span class="toc-section-number">8</span> Conditional Manatees</a>
<ul>
<li><a href="8.1-building-an-interaction.html#building-an-interaction"><span class="toc-section-number">8.1</span> Building an interaction</a></li>
<li><a href="8.2-symmetry-of-interactions.html#symmetry-of-interactions"><span class="toc-section-number">8.2</span> Symmetry of interactions</a></li>
<li><a href="8.3-continuous-interactions.html#continuous-interactions"><span class="toc-section-number">8.3</span> Continuous interactions</a></li>
</ul></li>
<li class="has-sub"><a href="9-markov-chain-monte-carlo-1.html#markov-chain-monte-carlo-1"><span class="toc-section-number">9</span> Markov Chain Monte Carlo</a>
<ul>
<li><a href="9.1-good-king-markov-and-his-island-kingdom.html#good-king-markov-and-his-island-kingdom"><span class="toc-section-number">9.1</span> Good King Markov and his island kingdom</a></li>
<li><a href="9.2-metropolis-algorithm.html#metropolis-algorithm"><span class="toc-section-number">9.2</span> Metropolis algorithm</a></li>
<li><a href="9.3-hamiltonian-monte-carlo.html#hamiltonian-monte-carlo"><span class="toc-section-number">9.3</span> Hamiltonian Monte Carlo</a></li>
<li><a href="9.4-easy-hmc-ulam.html#easy-hmc-ulam"><span class="toc-section-number">9.4</span> Easy HMC: <code>ulam</code></a></li>
<li><a href="9.5-care-and-feeding-of-your-markov-chain.html#care-and-feeding-of-your-markov-chain"><span class="toc-section-number">9.5</span> Care and feeding of your Markov chain</a></li>
</ul></li>
<li class="has-sub"><a href="10-big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model"><span class="toc-section-number">10</span> Big Entropy and the Generalized Linear Model</a>
<ul>
<li><a href="10.1-maximum-entropy.html#maximum-entropy"><span class="toc-section-number">10.1</span> Maximum entropy</a></li>
<li><a href="10.2-generalized-linear-models.html#generalized-linear-models"><span class="toc-section-number">10.2</span> Generalized linear models</a></li>
</ul></li>
<li class="has-sub"><a href="11-god-spiked-the-integers.html#god-spiked-the-integers"><span class="toc-section-number">11</span> God Spiked the Integers</a>
<ul>
<li><a href="11.1-binomial-regression.html#binomial-regression"><span class="toc-section-number">11.1</span> Binomial regression</a></li>
<li><a href="11.2-poisson-regression.html#poisson-regression"><span class="toc-section-number">11.2</span> Poisson regression</a></li>
<li><a href="11.3-multinomial-and-categorical-models.html#multinomial-and-categorical-models"><span class="toc-section-number">11.3</span> Multinomial and categorical models</a></li>
</ul></li>
<li class="has-sub"><a href="12-models-with-memory.html#models-with-memory"><span class="toc-section-number">12</span> Models With Memory</a>
<ul>
<li><a href="12.1-example-multilevel-tadpoles.html#example-multilevel-tadpoles"><span class="toc-section-number">12.1</span> Example: Multilevel tadpoles</a></li>
<li><a href="12.2-varying-effects-and-the-underfittingoverfitting-trade-off.html#varying-effects-and-the-underfittingoverfitting-trade-off"><span class="toc-section-number">12.2</span> Varying effects and the underfitting/overfitting trade-off</a></li>
<li><a href="12.3-more-than-one-type-of-cluster.html#more-than-one-type-of-cluster"><span class="toc-section-number">12.3</span> More than one type of cluster</a></li>
<li><a href="12.4-divergent-transitions-and-non-centered-priors.html#divergent-transitions-and-non-centered-priors"><span class="toc-section-number">12.4</span> Divergent transitions and non-centered priors</a></li>
<li><a href="12.5-multilevel-posterior-predictions.html#multilevel-posterior-predictions"><span class="toc-section-number">12.5</span> Multilevel posterior predictions</a></li>
</ul></li>
<li class="has-sub"><a href="13-adventures-in-covariance.html#adventures-in-covariance"><span class="toc-section-number">13</span> Adventures in Covariance</a>
<ul>
<li><a href="13.1-varying-slopes-by-construction.html#varying-slopes-by-construction"><span class="toc-section-number">13.1</span> Varying slopes by construction</a></li>
<li><a href="13.2-advanced-varying-slopes.html#advanced-varying-slopes"><span class="toc-section-number">13.2</span> Advanced varying slopes</a></li>
<li><a href="13.3-instruments-and-causal-designs.html#instruments-and-causal-designs"><span class="toc-section-number">13.3</span> Instruments and causal designs</a></li>
<li><a href="13.4-social-relations-as-correlated-varying-effects.html#social-relations-as-correlated-varying-effects"><span class="toc-section-number">13.4</span> Social relations as correlated varying effects</a></li>
<li><a href="13.5-continuous-categories-and-the-gaussian-process.html#continuous-categories-and-the-gaussian-process"><span class="toc-section-number">13.5</span> Continuous categories and the Gaussian process</a></li>
<li><a href="13.6-bonus-multilevel-growth-models-and-the-melsm.html#bonus-multilevel-growth-models-and-the-melsm"><span class="toc-section-number">13.6</span> Bonus: Multilevel growth models and the MELSM</a></li>
</ul></li>
<li class="has-sub"><a href="14-missing-data-and-other-opportunities.html#missing-data-and-other-opportunities"><span class="toc-section-number">14</span> Missing Data and Other Opportunities</a>
<ul>
<li><a href="14.1-measurement-error.html#measurement-error"><span class="toc-section-number">14.1</span> Measurement error</a></li>
<li><a href="14.2-missing-data.html#missing-data"><span class="toc-section-number">14.2</span> Missing data</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="sampling-to-summarize" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Sampling to summarize</h2>
<div class="figure">
<img src="slides/L02/49.png" alt="What might you want to compute? Commonly people want to construct intervals." width="80%" />
<p class="caption marginnote shownote">
What might you want to compute? Commonly people want to construct intervals.
</p>
</div>
<p><strong><em>3.2.1 Intervals of defined boudaries</em></strong></p>
<p>What’s the posterior probability that the proportion of water is less than 0.5?</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="3.2-sampling-to-summarize.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add up posterior probability where p &lt; 0.5</span></span>
<span id="cb31-2"><a href="3.2-sampling-to-summarize.html#cb31-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="3.2-sampling-to-summarize.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_grid <span class="sc">&lt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="3.2-sampling-to-summarize.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">sum</span>(posterior))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##     sum
##   &lt;dbl&gt;
## 1 0.172</code></pre>
<p>But since grid approximation isn’t practical in general, it won’t always be so easy. Once there is more than one parameter in the posterior distribution, even this simple sum is no longer very simple.</p>
<p>So let’s see how to perform it using samples from the posterior.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="3.2-sampling-to-summarize.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add up all the samples under .5, divided by the total number of samples</span></span>
<span id="cb33-2"><a href="3.2-sampling-to-summarize.html#cb33-2" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span></span>
<span id="cb33-3"><a href="3.2-sampling-to-summarize.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_grid <span class="sc">&lt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-4"><a href="3.2-sampling-to-summarize.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">n</span>() <span class="sc">/</span> n_samples)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##     sum
##   &lt;dbl&gt;
## 1 0.163</code></pre>
<p>Do the same but using <code>count()</code>:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="3.2-sampling-to-summarize.html#cb35-1" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="3.2-sampling-to-summarize.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(p_grid <span class="sc">&lt;</span> .<span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="3.2-sampling-to-summarize.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">probability =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n))</span></code></pre></div>
<pre><code>## # A tibble: 2 × 3
##   `p_grid &lt; 0.5`     n probability
##   &lt;lgl&gt;          &lt;int&gt;       &lt;dbl&gt;
## 1 FALSE           8371       0.837
## 2 TRUE            1629       0.163</code></pre>
<div class="figure">
<img src="slides/L02/50.png" alt="Two general kinds of intervals. One is an interval of defined boundaries. Upper left is the probability that less than half the world is covered by water. Compute by counting the number of samples that satisfy the criteria, then dividing by the total number of samples. Upper right is the probability between 50% and 70%. Lower right - there's an infinite number of 80% intervals." width="80%" />
<p class="caption marginnote shownote">
Two general kinds of intervals. One is an interval of defined boundaries. Upper left is the probability that less than half the world is covered by water. Compute by counting the number of samples that satisfy the criteria, then dividing by the total number of samples. Upper right is the probability between 50% and 70%. Lower right - there’s an infinite number of 80% intervals.
</p>
</div>
<p>Using the same approach, how much posterior probability lies between 0.5 and 0.75?</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="3.2-sampling-to-summarize.html#cb37-1" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="3.2-sampling-to-summarize.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(p_grid <span class="sc">&gt;</span> .<span class="dv">5</span> <span class="sc">&amp;</span> p_grid <span class="sc">&lt;</span> .<span class="dv">75</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="3.2-sampling-to-summarize.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">sum =</span> <span class="fu">n</span>() <span class="sc">/</span> n_samples)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##     sum
##   &lt;dbl&gt;
## 1 0.606</code></pre>
<p>This is shown in the upper right of Figure 3.2.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="3.2-sampling-to-summarize.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># upper left panel</span></span>
<span id="cb39-2"><a href="3.2-sampling-to-summarize.html#cb39-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb39-3"><a href="3.2-sampling-to-summarize.html#cb39-3" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb39-4"><a href="3.2-sampling-to-summarize.html#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb39-5"><a href="3.2-sampling-to-summarize.html#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb39-6"><a href="3.2-sampling-to-summarize.html#cb39-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_grid <span class="sc">&lt;</span> .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb39-7"><a href="3.2-sampling-to-summarize.html#cb39-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb39-8"><a href="3.2-sampling-to-summarize.html#cb39-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb39-9"><a href="3.2-sampling-to-summarize.html#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="3.2-sampling-to-summarize.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co"># upper right panel</span></span>
<span id="cb39-11"><a href="3.2-sampling-to-summarize.html#cb39-11" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb39-12"><a href="3.2-sampling-to-summarize.html#cb39-12" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb39-13"><a href="3.2-sampling-to-summarize.html#cb39-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb39-14"><a href="3.2-sampling-to-summarize.html#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb39-15"><a href="3.2-sampling-to-summarize.html#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># note this next line is the only difference in code from the last plot</span></span>
<span id="cb39-16"><a href="3.2-sampling-to-summarize.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_grid <span class="sc">&lt;</span> .<span class="dv">75</span> <span class="sc">&amp;</span> p_grid <span class="sc">&gt;</span> .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb39-17"><a href="3.2-sampling-to-summarize.html#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb39-18"><a href="3.2-sampling-to-summarize.html#cb39-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb39-19"><a href="3.2-sampling-to-summarize.html#cb39-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-20"><a href="3.2-sampling-to-summarize.html#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb39-21"><a href="3.2-sampling-to-summarize.html#cb39-21" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="03_sampling_from_the_imaginary_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p><strong><em>3.2.2 Intervals of defined mass</em></strong></p>
<p>What a compatibility interval indicates is a range of parameter values compatible with the model and data.</p>
<p>Where does the 80th percentile lie? i.e. the boundaries fo the lower 80% posterior probability.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="3.2-sampling-to-summarize.html#cb40-1" aria-hidden="true" tabindex="-1"></a>(q_80 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(samples<span class="sc">$</span>p_grid, <span class="at">prob =</span> .<span class="dv">8</span>))</span></code></pre></div>
<pre><code>##       80% 
## 0.7627628</code></pre>
<p>This is shown in the bottom-left of Figure 3.2. Similarly, the middle 80% interval lies between the 10th percentile and the 90th percentile.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="3.2-sampling-to-summarize.html#cb42-1" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="3.2-sampling-to-summarize.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">10th percentile</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(p_grid, <span class="at">p =</span> .<span class="dv">1</span>),</span>
<span id="cb42-3"><a href="3.2-sampling-to-summarize.html#cb42-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">`</span><span class="at">90th percentile</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(p_grid, <span class="at">p =</span> .<span class="dv">9</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   `10th percentile` `90th percentile`
##               &lt;dbl&gt;             &lt;dbl&gt;
## 1             0.451             0.815</code></pre>
<p>For quick indexing:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="3.2-sampling-to-summarize.html#cb44-1" aria-hidden="true" tabindex="-1"></a>(q_10_and_90 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(samples<span class="sc">$</span>p_grid, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">1</span>, .<span class="dv">9</span>)))</span></code></pre></div>
<pre><code>##       10%       90% 
## 0.4514515 0.8148148</code></pre>
<p>This is shown in the bottom-right of Figure 3.2.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="3.2-sampling-to-summarize.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lower left panel</span></span>
<span id="cb46-2"><a href="3.2-sampling-to-summarize.html#cb46-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb46-3"><a href="3.2-sampling-to-summarize.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="3.2-sampling-to-summarize.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb46-5"><a href="3.2-sampling-to-summarize.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb46-6"><a href="3.2-sampling-to-summarize.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_grid <span class="sc">&lt;</span> q_80)) <span class="sc">+</span></span>
<span id="cb46-7"><a href="3.2-sampling-to-summarize.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb46-8"><a href="3.2-sampling-to-summarize.html#cb46-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">25</span>, <span class="at">y =</span> .<span class="dv">0025</span>,</span>
<span id="cb46-9"><a href="3.2-sampling-to-summarize.html#cb46-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;lower 80%&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-10"><a href="3.2-sampling-to-summarize.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb46-11"><a href="3.2-sampling-to-summarize.html#cb46-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb46-12"><a href="3.2-sampling-to-summarize.html#cb46-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-13"><a href="3.2-sampling-to-summarize.html#cb46-13" aria-hidden="true" tabindex="-1"></a><span class="co"># lower right panel</span></span>
<span id="cb46-14"><a href="3.2-sampling-to-summarize.html#cb46-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb46-15"><a href="3.2-sampling-to-summarize.html#cb46-15" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb46-16"><a href="3.2-sampling-to-summarize.html#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb46-17"><a href="3.2-sampling-to-summarize.html#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb46-18"><a href="3.2-sampling-to-summarize.html#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_grid <span class="sc">&gt;</span> q_10_and_90[<span class="dv">1</span>] <span class="sc">&amp;</span> p_grid <span class="sc">&lt;</span> q_10_and_90[<span class="dv">2</span>])) <span class="sc">+</span></span>
<span id="cb46-19"><a href="3.2-sampling-to-summarize.html#cb46-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,</span>
<span id="cb46-20"><a href="3.2-sampling-to-summarize.html#cb46-20" aria-hidden="true" tabindex="-1"></a>           <span class="at">x =</span> .<span class="dv">25</span>, <span class="at">y =</span> .<span class="dv">0025</span>,</span>
<span id="cb46-21"><a href="3.2-sampling-to-summarize.html#cb46-21" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot;middle 80%&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-22"><a href="3.2-sampling-to-summarize.html#cb46-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb46-23"><a href="3.2-sampling-to-summarize.html#cb46-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb46-24"><a href="3.2-sampling-to-summarize.html#cb46-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-25"><a href="3.2-sampling-to-summarize.html#cb46-25" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code></pre></div>
<p><img src="03_sampling_from_the_imaginary_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Intervals of this sort are very common in the scientific literature. We’ll call them <strong>Percentile Intervals</strong> (PI). These do a good job of communicating the shape of a distribution, as long as it’s not too asymmetrical.</p>
<p>But in terms of supporting inferences about which parameters are consistent with the data, they are not perfect.</p>
<p>Consider the posterior distribution consistent with observing three waters in three tosses, and a flat prior.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="3.2-sampling-to-summarize.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here we update the `dbinom()` parameters</span></span>
<span id="cb47-2"><a href="3.2-sampling-to-summarize.html#cb47-2" aria-hidden="true" tabindex="-1"></a>n_success <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb47-3"><a href="3.2-sampling-to-summarize.html#cb47-3" aria-hidden="true" tabindex="-1"></a>n_trials  <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb47-4"><a href="3.2-sampling-to-summarize.html#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="3.2-sampling-to-summarize.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># update `d`</span></span>
<span id="cb47-6"><a href="3.2-sampling-to-summarize.html#cb47-6" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span></span>
<span id="cb47-7"><a href="3.2-sampling-to-summarize.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb47-8"><a href="3.2-sampling-to-summarize.html#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">likelihood =</span> <span class="fu">dbinom</span>(n_success, <span class="at">size =</span> n_trials, <span class="at">prob =</span> p_grid)) <span class="sc">%&gt;%</span> </span>
<span id="cb47-9"><a href="3.2-sampling-to-summarize.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">posterior  =</span> (likelihood <span class="sc">*</span> prior) <span class="sc">/</span> <span class="fu">sum</span>(likelihood <span class="sc">*</span> prior))</span>
<span id="cb47-10"><a href="3.2-sampling-to-summarize.html#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="3.2-sampling-to-summarize.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># make the next part reproducible</span></span>
<span id="cb47-12"><a href="3.2-sampling-to-summarize.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb47-13"><a href="3.2-sampling-to-summarize.html#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="3.2-sampling-to-summarize.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co"># here&#39;s our new samples tibble</span></span>
<span id="cb47-15"><a href="3.2-sampling-to-summarize.html#cb47-15" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb47-16"><a href="3.2-sampling-to-summarize.html#cb47-16" aria-hidden="true" tabindex="-1"></a>  samples <span class="ot">&lt;-</span></span>
<span id="cb47-17"><a href="3.2-sampling-to-summarize.html#cb47-17" aria-hidden="true" tabindex="-1"></a>    d <span class="sc">%&gt;%</span> </span>
<span id="cb47-18"><a href="3.2-sampling-to-summarize.html#cb47-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> n_samples, <span class="at">weight_by =</span> posterior, <span class="at">replace =</span> T)</span>
<span id="cb47-19"><a href="3.2-sampling-to-summarize.html#cb47-19" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 10,000 × 4
##    p_grid prior likelihood posterior
##     &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
##  1  0.717     1     0.368   0.00147 
##  2  0.652     1     0.277   0.00111 
##  3  0.548     1     0.164   0.000656
##  4  1         1     1       0.00400 
##  5  0.991     1     0.973   0.00389 
##  6  0.788     1     0.489   0.00195 
##  7  0.940     1     0.830   0.00332 
##  8  0.817     1     0.545   0.00218 
##  9  0.955     1     0.871   0.00348 
## 10  0.449     1     0.0908  0.000363
## # … with 9,990 more rows</code></pre>
<p>The <code>rethinking::PI()</code> function works like a nice shorthand for <code>quantile()</code>.</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="3.2-sampling-to-summarize.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quantile</span>(samples<span class="sc">$</span>p_grid, <span class="at">prob =</span> <span class="fu">c</span>(.<span class="dv">25</span>, .<span class="dv">75</span>))</span></code></pre></div>
<pre><code>##       25%       75% 
## 0.7087087 0.9349349</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="3.2-sampling-to-summarize.html#cb51-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">PI</span>(samples<span class="sc">$</span>p_grid, <span class="at">prob =</span> .<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##       25%       75% 
## 0.7087087 0.9349349</code></pre>
<div class="figure">
<img src="slides/L02/51.png" alt="Two basic kinds of specified mass intervals. PI gives you the central area, where .25 is left over in each tail. They're not necessarily the right thing to use. What if you have an asymmetric distribution? Now the 50 percentile interval omits the highest value. Use the HPDI to keep the highest point. But remember these are just summaries." width="80%" />
<p class="caption marginnote shownote">
Two basic kinds of specified mass intervals. PI gives you the central area, where .25 is left over in each tail. They’re not necessarily the right thing to use. What if you have an asymmetric distribution? Now the 50 percentile interval omits the highest value. Use the HPDI to keep the highest point. But remember these are just summaries.
</p>
</div>
<p><img src="slides/L02/52.png" width="80%" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="3.2-sampling-to-summarize.html#cb53-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">PI</span>(samples<span class="sc">$</span>p_grid, <span class="at">prob =</span> .<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##       25%       75% 
## 0.7087087 0.9349349</code></pre>
<p>In this example, it ends up excluding the most probable parameter values, near <span class="math inline">\(p\)</span> = 1.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="3.2-sampling-to-summarize.html#cb55-1" aria-hidden="true" tabindex="-1"></a>rethinking<span class="sc">::</span><span class="fu">HPDI</span>(samples<span class="sc">$</span>p_grid, <span class="at">prob =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<pre><code>##      |0.5      0.5| 
## 0.8418418 0.9989990</code></pre>
<p>Here the HPDI has an advantage over the PI, but in most cases, the two are very similar. That’s because the posterior is skewed. When the posterior is bell-shaped, it hardly matters what type of interval you use.</p>
<blockquote>
<p>Often, all compatibility intervals do is communicate the shape of a distribution.</p>
</blockquote>
<p><code>tidybayes</code> makes it easy to request multiple types of intervals:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="3.2-sampling-to-summarize.html#cb57-1" aria-hidden="true" tabindex="-1"></a>tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(samples<span class="sc">$</span>p_grid, <span class="at">.width =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">8</span>, .<span class="dv">99</span>))</span></code></pre></div>
<pre><code>##           y      ymin      ymax .width .point .interval
## 1 0.8428428 0.7087087 0.9349349   0.50 median        qi
## 2 0.8428428 0.5705706 0.9749750   0.80 median        qi
## 3 0.8428428 0.2562563 0.9989990   0.99 median        qi</code></pre>
<p>It also supports HPDIs:</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="3.2-sampling-to-summarize.html#cb59-1" aria-hidden="true" tabindex="-1"></a>tidybayes<span class="sc">::</span><span class="fu">mode_hdi</span>(samples<span class="sc">$</span>p_grid, <span class="at">.width =</span> .<span class="dv">5</span>)</span></code></pre></div>
<pre><code>##          y      ymin     ymax .width .point .interval
## 1 0.955384 0.8418418 0.998999    0.5   mode       hdi</code></pre>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="3.2-sampling-to-summarize.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># lower left panel</span></span>
<span id="cb61-2"><a href="3.2-sampling-to-summarize.html#cb61-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span></span>
<span id="cb61-3"><a href="3.2-sampling-to-summarize.html#cb61-3" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="3.2-sampling-to-summarize.html#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb61-5"><a href="3.2-sampling-to-summarize.html#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check out our sweet `qi()` indexing</span></span>
<span id="cb61-6"><a href="3.2-sampling-to-summarize.html#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> d <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_grid <span class="sc">&gt;</span> tidybayes<span class="sc">::</span><span class="fu">qi</span>(samples<span class="sc">$</span>p_grid, <span class="at">.width =</span> .<span class="dv">5</span>)[<span class="dv">1</span>] <span class="sc">&amp;</span> </span>
<span id="cb61-7"><a href="3.2-sampling-to-summarize.html#cb61-7" aria-hidden="true" tabindex="-1"></a>                                  p_grid <span class="sc">&lt;</span> tidybayes<span class="sc">::</span><span class="fu">qi</span>(samples<span class="sc">$</span>p_grid, <span class="at">.width =</span> .<span class="dv">5</span>)[<span class="dv">2</span>]),</span>
<span id="cb61-8"><a href="3.2-sampling-to-summarize.html#cb61-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">&quot;grey75&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-9"><a href="3.2-sampling-to-summarize.html#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb61-10"><a href="3.2-sampling-to-summarize.html#cb61-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;50% Percentile Interval&quot;</span>,</span>
<span id="cb61-11"><a href="3.2-sampling-to-summarize.html#cb61-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb61-12"><a href="3.2-sampling-to-summarize.html#cb61-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb61-13"><a href="3.2-sampling-to-summarize.html#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="3.2-sampling-to-summarize.html#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co"># lower right panel</span></span>
<span id="cb61-15"><a href="3.2-sampling-to-summarize.html#cb61-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span></span>
<span id="cb61-16"><a href="3.2-sampling-to-summarize.html#cb61-16" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb61-17"><a href="3.2-sampling-to-summarize.html#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid, <span class="at">y =</span> posterior)) <span class="sc">+</span></span>
<span id="cb61-18"><a href="3.2-sampling-to-summarize.html#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">data =</span> . <span class="sc">%&gt;%</span> <span class="fu">filter</span>(p_grid <span class="sc">&gt;</span> tidybayes<span class="sc">::</span><span class="fu">hdi</span>(samples<span class="sc">$</span>p_grid, <span class="at">.width =</span> .<span class="dv">5</span>)[<span class="dv">1</span>] <span class="sc">&amp;</span> </span>
<span id="cb61-19"><a href="3.2-sampling-to-summarize.html#cb61-19" aria-hidden="true" tabindex="-1"></a>                                  p_grid <span class="sc">&lt;</span> tidybayes<span class="sc">::</span><span class="fu">hdi</span>(samples<span class="sc">$</span>p_grid, <span class="at">.width =</span> .<span class="dv">5</span>)[<span class="dv">2</span>]),</span>
<span id="cb61-20"><a href="3.2-sampling-to-summarize.html#cb61-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">&quot;grey75&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-21"><a href="3.2-sampling-to-summarize.html#cb61-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb61-22"><a href="3.2-sampling-to-summarize.html#cb61-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">&quot;50% HPDI&quot;</span>,</span>
<span id="cb61-23"><a href="3.2-sampling-to-summarize.html#cb61-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb61-24"><a href="3.2-sampling-to-summarize.html#cb61-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>)</span>
<span id="cb61-25"><a href="3.2-sampling-to-summarize.html#cb61-25" aria-hidden="true" tabindex="-1"></a><span class="co"># combine!</span></span>
<span id="cb61-26"><a href="3.2-sampling-to-summarize.html#cb61-26" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">|</span> p2</span></code></pre></div>
<p><img src="03_sampling_from_the_imaginary_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p><strong><em>3.2.3 Point estimates</em></strong></p>
<p><img src="slides/L02/53.png" width="80%" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="3.2-sampling-to-summarize.html#cb62-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="3.2-sampling-to-summarize.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(posterior)) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="3.2-sampling-to-summarize.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   p_grid prior likelihood posterior
##    &lt;dbl&gt; &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1      1     1          1   0.00400</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="3.2-sampling-to-summarize.html#cb64-1" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="3.2-sampling-to-summarize.html#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean   =</span> <span class="fu">mean</span>(p_grid),</span>
<span id="cb64-3"><a href="3.2-sampling-to-summarize.html#cb64-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">median =</span> <span class="fu">median</span>(p_grid))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##    mean median
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1 0.803  0.843</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="3.2-sampling-to-summarize.html#cb66-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb66-2"><a href="3.2-sampling-to-summarize.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  point_estimates <span class="ot">&lt;-</span></span>
<span id="cb66-3"><a href="3.2-sampling-to-summarize.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(samples <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">mean_qi</span>(p_grid),</span>
<span id="cb66-4"><a href="3.2-sampling-to-summarize.html#cb66-4" aria-hidden="true" tabindex="-1"></a>                   samples <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">median_qi</span>(p_grid),</span>
<span id="cb66-5"><a href="3.2-sampling-to-summarize.html#cb66-5" aria-hidden="true" tabindex="-1"></a>                   samples <span class="sc">%&gt;%</span> tidybayes<span class="sc">::</span><span class="fu">mode_qi</span>(p_grid)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-6"><a href="3.2-sampling-to-summarize.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(p_grid, .point) <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="3.2-sampling-to-summarize.html#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># these last two columns will help us annotate  </span></span>
<span id="cb66-8"><a href="3.2-sampling-to-summarize.html#cb66-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">x =</span> p_grid <span class="sc">+</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">03</span>, .<span class="dv">03</span>, <span class="sc">-</span>.<span class="dv">03</span>),</span>
<span id="cb66-9"><a href="3.2-sampling-to-summarize.html#cb66-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">y =</span> <span class="fu">c</span>(.<span class="dv">0005</span>, .<span class="dv">0012</span>, .<span class="dv">002</span>))</span>
<span id="cb66-10"><a href="3.2-sampling-to-summarize.html#cb66-10" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 4
##   p_grid .point     x      y
##    &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1  0.803 mean   0.773 0.0005
## 2  0.843 median 0.873 0.0012
## 3  0.955 mode   0.925 0.002</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="3.2-sampling-to-summarize.html#cb68-1" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb68-2"><a href="3.2-sampling-to-summarize.html#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p_grid)) <span class="sc">+</span></span>
<span id="cb68-3"><a href="3.2-sampling-to-summarize.html#cb68-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="fu">aes</span>(<span class="at">y =</span> posterior),</span>
<span id="cb68-4"><a href="3.2-sampling-to-summarize.html#cb68-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">&quot;grey75&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-5"><a href="3.2-sampling-to-summarize.html#cb68-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> point_estimates<span class="sc">$</span>p_grid) <span class="sc">+</span></span>
<span id="cb68-6"><a href="3.2-sampling-to-summarize.html#cb68-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> point_estimates,</span>
<span id="cb68-7"><a href="3.2-sampling-to-summarize.html#cb68-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> .point),</span>
<span id="cb68-8"><a href="3.2-sampling-to-summarize.html#cb68-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">angle =</span> <span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb68-9"><a href="3.2-sampling-to-summarize.html#cb68-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;proportion of water (p)&quot;</span>,</span>
<span id="cb68-10"><a href="3.2-sampling-to-summarize.html#cb68-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;density&quot;</span>) <span class="sc">+</span></span>
<span id="cb68-11"><a href="3.2-sampling-to-summarize.html#cb68-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="03_sampling_from_the_imaginary_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>We care about uncertainty, and we want to summarise that. To use a point estimate, you need to provide a cost-benefit analysis. e.g. conservation or forecasting.</p>
<p>One principles way to go beyond using the entire posterior as the estimate is to choose a <strong>Loss Function</strong>: a rule that tells you the cost assoicated with using any particular point estimate.</p>
<blockquote>
<p>Tell me which value of <span class="math inline">\(p\)</span>, the proportion of water on the Earth, you think is correct, and if you get it exactly right, I will pay you $100. But I will subtract money from your gain, proportional to the distance of your decision from the correct value. Now that you have the posterior distribution in hand, how should you use it to maximise your expected winnings?</p>
</blockquote>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="3.2-sampling-to-summarize.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The expected loss will be:</span></span>
<span id="cb69-2"><a href="3.2-sampling-to-summarize.html#cb69-2" aria-hidden="true" tabindex="-1"></a>d <span class="sc">%&gt;%</span> </span>
<span id="cb69-3"><a href="3.2-sampling-to-summarize.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">expected loss</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(posterior <span class="sc">*</span> <span class="fu">abs</span>(<span class="fl">0.5</span> <span class="sc">-</span> p_grid)))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   `expected loss`
##             &lt;dbl&gt;
## 1           0.313</code></pre>
<p>We can repeat this for every possible decision:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="3.2-sampling-to-summarize.html#cb71-1" aria-hidden="true" tabindex="-1"></a>make_loss <span class="ot">&lt;-</span> <span class="cf">function</span>(our_d) {</span>
<span id="cb71-2"><a href="3.2-sampling-to-summarize.html#cb71-2" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb71-3"><a href="3.2-sampling-to-summarize.html#cb71-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">loss =</span> posterior <span class="sc">*</span> <span class="fu">abs</span>(our_d <span class="sc">-</span> p_grid)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-4"><a href="3.2-sampling-to-summarize.html#cb71-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">weighted_average_loss =</span> <span class="fu">sum</span>(loss))</span>
<span id="cb71-5"><a href="3.2-sampling-to-summarize.html#cb71-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-6"><a href="3.2-sampling-to-summarize.html#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="3.2-sampling-to-summarize.html#cb71-7" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb71-8"><a href="3.2-sampling-to-summarize.html#cb71-8" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span></span>
<span id="cb71-9"><a href="3.2-sampling-to-summarize.html#cb71-9" aria-hidden="true" tabindex="-1"></a>  d <span class="sc">%&gt;%</span> </span>
<span id="cb71-10"><a href="3.2-sampling-to-summarize.html#cb71-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(p_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb71-11"><a href="3.2-sampling-to-summarize.html#cb71-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">decision =</span> p_grid) <span class="sc">%&gt;%</span> </span>
<span id="cb71-12"><a href="3.2-sampling-to-summarize.html#cb71-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">weighted_average_loss =</span> purrr<span class="sc">::</span><span class="fu">map</span>(decision, make_loss)) <span class="sc">%&gt;%</span> </span>
<span id="cb71-13"><a href="3.2-sampling-to-summarize.html#cb71-13" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">unnest</span>(weighted_average_loss) </span>
<span id="cb71-14"><a href="3.2-sampling-to-summarize.html#cb71-14" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1,000 × 2
##    decision weighted_average_loss
##       &lt;dbl&gt;                 &lt;dbl&gt;
##  1  0                       0.800
##  2  0.00100                 0.799
##  3  0.00200                 0.798
##  4  0.00300                 0.797
##  5  0.00400                 0.796
##  6  0.00501                 0.795
##  7  0.00601                 0.794
##  8  0.00701                 0.793
##  9  0.00801                 0.792
## 10  0.00901                 0.791
## # … with 990 more rows</code></pre>
<p>Now it’s easy to find the parameter value that minimises that loss:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="3.2-sampling-to-summarize.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># this will help us find the x and y coordinates for the minimum value</span></span>
<span id="cb73-2"><a href="3.2-sampling-to-summarize.html#cb73-2" aria-hidden="true" tabindex="-1"></a>min_loss <span class="ot">&lt;-</span></span>
<span id="cb73-3"><a href="3.2-sampling-to-summarize.html#cb73-3" aria-hidden="true" tabindex="-1"></a>  l <span class="sc">%&gt;%</span> </span>
<span id="cb73-4"><a href="3.2-sampling-to-summarize.html#cb73-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weighted_average_loss <span class="sc">==</span> <span class="fu">min</span>(weighted_average_loss)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-5"><a href="3.2-sampling-to-summarize.html#cb73-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb73-6"><a href="3.2-sampling-to-summarize.html#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># the plot</span></span>
<span id="cb73-7"><a href="3.2-sampling-to-summarize.html#cb73-7" aria-hidden="true" tabindex="-1"></a>l <span class="sc">%&gt;%</span>   </span>
<span id="cb73-8"><a href="3.2-sampling-to-summarize.html#cb73-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> decision, <span class="at">y =</span> weighted_average_loss)) <span class="sc">+</span></span>
<span id="cb73-9"><a href="3.2-sampling-to-summarize.html#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">&quot;grey75&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-10"><a href="3.2-sampling-to-summarize.html#cb73-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> min_loss[<span class="dv">1</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-11"><a href="3.2-sampling-to-summarize.html#cb73-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> min_loss[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">linetype =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb73-12"><a href="3.2-sampling-to-summarize.html#cb73-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;expected proportional loss&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-13"><a href="3.2-sampling-to-summarize.html#cb73-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="03_sampling_from_the_imaginary_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>And this is actually the posterior median.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="3.2-sampling-to-summarize.html#cb74-1" aria-hidden="true" tabindex="-1"></a>samples <span class="sc">%&gt;%</span> </span>
<span id="cb74-2"><a href="3.2-sampling-to-summarize.html#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">posterior_median =</span> <span class="fu">median</span>(p_grid))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   posterior_median
##              &lt;dbl&gt;
## 1            0.843</code></pre>
<p>Usually it’s better to communicate as much as you can about the posterior distribution, as well as the data and the model itself.</p>
<p><img src="slides/L02/54.png" width="80%" /></p>
<p>You can’t have confidence in an interval. It’s doublespeak. <em>Compatibility</em> emphasises the uncertainty. Credibility is the next conversation.</p>
</div>
<p style="text-align: center;">
<a href="3.1-sampling-from-a-grid-approximate-posterior.html"><button class="btn btn-default">Previous</button></a>
<a href="3.3-sampling-to-simulate-prediction.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>

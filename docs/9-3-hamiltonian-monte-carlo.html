<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="9.3 Hamiltonian Monte Carlo | Notes for Statistical Rethinking 2nd ed. by Richard McElreath" />
<meta property="og:type" content="book" />






<meta name="date" content="2021-07-02" />

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<meta name="description" content="9.3 Hamiltonian Monte Carlo | Notes for Statistical Rethinking 2nd ed. by Richard McElreath">

<title>9.3 Hamiltonian Monte Carlo | Notes for Statistical Rethinking 2nd ed. by Richard McElreath</title>

<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="toc.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#index">Index</a></li>
<li><a href="1-the-golem-of-prague.html#the-golem-of-prague"><span class="toc-section-number">1</span> The Golem of Prague</a></li>
<li><a href="2-small-worlds-and-large-worlds.html#small-worlds-and-large-worlds"><span class="toc-section-number">2</span> Small Worlds and Large Worlds</a>
<ul>
<li><a href="2-1-the-garden-of-forking-data.html#the-garden-of-forking-data"><span class="toc-section-number">2.1</span> The garden of forking data</a></li>
<li><a href="2-2-building-a-model.html#building-a-model"><span class="toc-section-number">2.2</span> Building a model</a></li>
<li><a href="2-3-components-of-the-model.html#components-of-the-model"><span class="toc-section-number">2.3</span> Components of the model</a></li>
<li><a href="2-4-making-the-model-go.html#making-the-model-go"><span class="toc-section-number">2.4</span> Making the model go</a></li>
</ul></li>
<li><a href="3-sampling-from-the-imaginary.html#sampling-from-the-imaginary"><span class="toc-section-number">3</span> Sampling from the Imaginary</a>
<ul>
<li><a href="3-1-sampling-from-a-grid-approximate-posterior.html#sampling-from-a-grid-approximate-posterior"><span class="toc-section-number">3.1</span> Sampling from a grid-approximate posterior</a></li>
<li><a href="3-2-sampling-to-summarize.html#sampling-to-summarize"><span class="toc-section-number">3.2</span> Sampling to summarize</a></li>
<li><a href="3-3-sampling-to-simulate-prediction.html#sampling-to-simulate-prediction"><span class="toc-section-number">3.3</span> Sampling to simulate prediction</a></li>
<li><a href="practice.html#practice">Practice</a></li>
<li><a href="homework-week-1.html#homework-week-1">Homework: week 1</a></li>
</ul></li>
<li><a href="4-geocentric-models.html#geocentric-models"><span class="toc-section-number">4</span> Geocentric Models</a>
<ul>
<li><a href="4-1-why-normal-distributions-are-normal.html#why-normal-distributions-are-normal"><span class="toc-section-number">4.1</span> Why normal distributions are normal</a></li>
<li><a href="4-2-a-language-for-describing-models.html#a-language-for-describing-models"><span class="toc-section-number">4.2</span> A language for describing models</a></li>
<li><a href="4-3-gaussian-model-of-height.html#gaussian-model-of-height"><span class="toc-section-number">4.3</span> Gaussian model of height</a></li>
<li><a href="4-4-linear-prediction.html#linear-prediction"><span class="toc-section-number">4.4</span> Linear prediction</a></li>
<li><a href="4-5-curves-from-lines.html#curves-from-lines"><span class="toc-section-number">4.5</span> Curves from lines</a></li>
<li><a href="4-6-practice-1.html#practice-1"><span class="toc-section-number">4.6</span> Practice</a></li>
</ul></li>
<li><a href="5-the-many-variables-the-spurious-waffles.html#the-many-variables-the-spurious-waffles"><span class="toc-section-number">5</span> The Many Variables &amp; The Spurious Waffles</a>
<ul>
<li><a href="5-1-spurious-association.html#spurious-association"><span class="toc-section-number">5.1</span> Spurious association</a></li>
<li><a href="5-2-masked-relationship.html#masked-relationship"><span class="toc-section-number">5.2</span> Masked relationship</a></li>
<li><a href="5-3-categorical-variables.html#categorical-variables"><span class="toc-section-number">5.3</span> Categorical variables</a></li>
<li><a href="5-4-practice-2.html#practice-2"><span class="toc-section-number">5.4</span> Practice</a></li>
</ul></li>
<li><a href="6-the-haunted-dag-the-causal-terror.html#the-haunted-dag-the-causal-terror"><span class="toc-section-number">6</span> The Haunted DAG &amp; The Causal Terror</a>
<ul>
<li><a href="6-1-multicollinearity.html#multicollinearity"><span class="toc-section-number">6.1</span> Multicollinearity</a></li>
<li><a href="6-2-post-treatment-bias.html#post-treatment-bias"><span class="toc-section-number">6.2</span> Post-treatment bias</a></li>
<li><a href="6-3-collider-bias.html#collider-bias"><span class="toc-section-number">6.3</span> Collider bias</a></li>
<li><a href="6-4-confronting-confounding.html#confronting-confounding"><span class="toc-section-number">6.4</span> Confronting confounding</a></li>
<li><a href="6-5-summary.html#summary"><span class="toc-section-number">6.5</span> Summary</a></li>
<li><a href="6-6-practice-3.html#practice-3"><span class="toc-section-number">6.6</span> Practice</a></li>
</ul></li>
<li><a href="7-ulysses-compass.html#ulysses-compass"><span class="toc-section-number">7</span> Ulysses’ Compass</a>
<ul>
<li><a href="7-1-the-problem-with-parameters.html#the-problem-with-parameters"><span class="toc-section-number">7.1</span> The problem with parameters</a></li>
<li><a href="7-2-entropy-and-accuracy.html#entropy-and-accuracy"><span class="toc-section-number">7.2</span> Entropy and accuracy</a></li>
<li><a href="7-3-golem-taming-regularization.html#golem-taming-regularization"><span class="toc-section-number">7.3</span> Golem taming: regularization</a></li>
<li><a href="7-4-predicting-predictive-accuracy.html#predicting-predictive-accuracy"><span class="toc-section-number">7.4</span> Predicting predictive accuracy</a></li>
<li><a href="7-5-model-comparison.html#model-comparison"><span class="toc-section-number">7.5</span> Model comparison</a></li>
<li><a href="7-6-practice-4.html#practice-4"><span class="toc-section-number">7.6</span> Practice</a></li>
</ul></li>
<li><a href="8-conditional-manatees.html#conditional-manatees"><span class="toc-section-number">8</span> Conditional Manatees</a>
<ul>
<li><a href="8-1-building-an-interaction.html#building-an-interaction"><span class="toc-section-number">8.1</span> Building an interaction</a></li>
<li><a href="8-2-symmetry-of-interactions.html#symmetry-of-interactions"><span class="toc-section-number">8.2</span> Symmetry of interactions</a></li>
<li><a href="8-3-continuous-interactions.html#continuous-interactions"><span class="toc-section-number">8.3</span> Continuous interactions</a></li>
</ul></li>
<li><a href="9-markov-chain-monte-carlo.html#markov-chain-monte-carlo"><span class="toc-section-number">9</span> Markov Chain Monte Carlo</a>
<ul>
<li><a href="9-1-good-king-markov-and-his-island-kingdom.html#good-king-markov-and-his-island-kingdom"><span class="toc-section-number">9.1</span> Good King Markov and his island kingdom</a></li>
<li><a href="9-2-metropolis-algorithm.html#metropolis-algorithm"><span class="toc-section-number">9.2</span> Metropolis algorithm</a></li>
<li><a href="9-3-hamiltonian-monte-carlo.html#hamiltonian-monte-carlo"><span class="toc-section-number">9.3</span> Hamiltonian Monte Carlo</a></li>
<li><a href="9-4-easy-hmc-ulam.html#easy-hmc-ulam"><span class="toc-section-number">9.4</span> Easy HMC: <code>ulam</code></a></li>
<li><a href="9-5-care-and-feeding-of-your-markov-chain.html#care-and-feeding-of-your-markov-chain"><span class="toc-section-number">9.5</span> Care and feeding of your Markov chain</a></li>
</ul></li>
<li><a href="10-big-entropy-and-the-generalized-linear-model.html#big-entropy-and-the-generalized-linear-model"><span class="toc-section-number">10</span> Big Entropy and the Generalized Linear Model</a>
<ul>
<li><a href="10-1-maximum-entropy.html#maximum-entropy"><span class="toc-section-number">10.1</span> Maximum entropy</a></li>
</ul></li>
<li><a href="11-god-spiked-the-integers.html#god-spiked-the-integers"><span class="toc-section-number">11</span> God Spiked the Integers</a></li>
<li><a href="12-monsters-and-mixtures.html#monsters-and-mixtures"><span class="toc-section-number">12</span> Monsters and Mixtures</a></li>
<li><a href="13-models-with-memory.html#models-with-memory"><span class="toc-section-number">13</span> Models With Memory</a></li>
<li><a href="14-adventures-in-covariance.html#adventures-in-covariance"><span class="toc-section-number">14</span> Adventures in Covariance</a></li>
<li><a href="15-missing-data-and-other-opportunities.html#missing-data-and-other-opportunities"><span class="toc-section-number">15</span> Missing Data and Other Opportunities</a></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="hamiltonian-monte-carlo" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Hamiltonian Monte Carlo</h2>
<blockquote>
<p>It appears to be a quite general principle that, whenever there is a randomized way of doing something, then there is a nonrandomized way that delivers better performance but requires more thought. —E. T. Jaynes</p>
</blockquote>
<div class="figure">
<img src="slides/L10/32.png" alt="So what do we do instead? This is a different process entirely. No guess and check. Instead, it runs a physics simulation. We'll represent our parameter state as a coordinate in some high-dimensional space. In more dimensions, you have some hyperspace. You're a particle in this space in some position. Then we'll flick you, and it'll cruise on some surface - the posterior distribution - and record where you stop, then do it again. Because it follows the curvature, it always makes good proposals because it doesn't go into bad areas. So there's no more guessing and checking, all proposals are good proposals." width="80%" />
<p class="caption marginnote shownote">
So what do we do instead? This is a different process entirely. No guess and check. Instead, it runs a physics simulation. We’ll represent our parameter state as a coordinate in some high-dimensional space. In more dimensions, you have some hyperspace. You’re a particle in this space in some position. Then we’ll flick you, and it’ll cruise on some surface - the posterior distribution - and record where you stop, then do it again. Because it follows the curvature, it always makes good proposals because it doesn’t go into bad areas. So there’s no more guessing and checking, all proposals are good proposals.
</p>
</div>
<p><strong><em>9.3.1. Another parable</em></strong></p>
<div class="figure">
<img src="slides/L10/33.png" alt="Continuous urban smear. More living in the bottom. How to use this? Hamiltonian." width="80%" />
<p class="caption marginnote shownote">
Continuous urban smear. More living in the bottom. How to use this? Hamiltonian.
</p>
</div>
<p><img src="slides/L10/34.png" width="80%" /></p>
<div class="figure">
<img src="slides/L10/35.png" alt="In the book, here's a simulation. Time on the horizontal. It's Gaussian. You take the log of a Gaussian and it's a parabola. So you start in the middle. But you need to know the contour." width="80%" />
<p class="caption marginnote shownote">
In the book, here’s a simulation. Time on the horizontal. It’s Gaussian. You take the log of a Gaussian and it’s a parabola. So you start in the middle. But you need to know the contour.
</p>
</div>
<div class="figure">
<img src="slides/L10/36.png" alt="Roll the marble and periodically stop and record the position. Over time you get position samples that are proportional to the shape, as if there is more probability in the bottom." width="80%" />
<p class="caption marginnote shownote">
Roll the marble and periodically stop and record the position. Over time you get position samples that are proportional to the shape, as if there is more probability in the bottom.
</p>
</div>
<p><img src="slides/L10/37.png" width="80%" /></p>
<div class="figure">
<img src="slides/L10/38.png" alt="Again, 2D Gaussian hill. It's a bowl now. Flick the simulation and do the pass. Always ends up inside the bowl. What stops you from getting into the silly spots. Better living through physics." width="80%" />
<p class="caption marginnote shownote">
Again, 2D Gaussian hill. It’s a bowl now. Flick the simulation and do the pass. Always ends up inside the bowl. What stops you from getting into the silly spots. Better living through physics.
</p>
</div>
<div class="figure">
<img src="slides/L10/39.png" alt="Because each proposal is accepted, you need many many fewer. So a lot of efficiency. Using the code in the chapter, we get tours. Start with x on the left, and it rolls down the valley. Eventually we stop, then flick it again. High acceptance rate, but the sequential auto-correlation is very low. " width="80%" />
<p class="caption marginnote shownote">
Because each proposal is accepted, you need many many fewer. So a lot of efficiency. Using the code in the chapter, we get tours. Start with x on the left, and it rolls down the valley. Eventually we stop, then flick it again. High acceptance rate, but the sequential auto-correlation is very low.
</p>
</div>
<p><img src="slides/L10/40.png" width="80%" /></p>
<div class="figure">
<img src="slides/L10/41.png" alt="Hamiltonian MC does really well with the donut. It knows the curvature. Tours the whole thing, and you don't get stuck. If you have 27K parameters, that's really handy. " width="80%" />
<p class="caption marginnote shownote">
Hamiltonian MC does really well with the donut. It knows the curvature. Tours the whole thing, and you don’t get stuck. If you have 27K parameters, that’s really handy.
</p>
</div>
<div class="figure">
<img src="slides/L10/42.png" alt="You need to put in momentum variables now. You need to choose the mass. The system has energy, which is how to check that it's working. If energy is not conserved, the simulation stops working. With Metropolis, you won't know. But this breaks dramatically. Also need gradients - the log posterior at a particular point." width="80%" />
<p class="caption marginnote shownote">
You need to put in momentum variables now. You need to choose the mass. The system has energy, which is how to check that it’s working. If energy is not conserved, the simulation stops working. With Metropolis, you won’t know. But this breaks dramatically. Also need gradients - the log posterior at a particular point.
</p>
</div>
<div class="figure">
<img src="slides/L10/43.png" alt="Not that complicated, so tour through it. " width="80%" />
<p class="caption marginnote shownote">
Not that complicated, so tour through it.
</p>
</div>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="9-3-hamiltonian-monte-carlo.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># U needs to return neg-log-probability</span></span>
<span id="cb446-2"><a href="9-3-hamiltonian-monte-carlo.html#cb446-2" aria-hidden="true" tabindex="-1"></a>U <span class="ot">&lt;-</span> <span class="cf">function</span>( q , <span class="at">a=</span><span class="dv">0</span> , <span class="at">b=</span><span class="dv">1</span> , <span class="at">k=</span><span class="dv">0</span> , <span class="at">d=</span><span class="dv">1</span> ) {</span>
<span id="cb446-3"><a href="9-3-hamiltonian-monte-carlo.html#cb446-3" aria-hidden="true" tabindex="-1"></a>  muy <span class="ot">&lt;-</span> q[<span class="dv">1</span>]</span>
<span id="cb446-4"><a href="9-3-hamiltonian-monte-carlo.html#cb446-4" aria-hidden="true" tabindex="-1"></a>  mux <span class="ot">&lt;-</span> q[<span class="dv">2</span>]</span>
<span id="cb446-5"><a href="9-3-hamiltonian-monte-carlo.html#cb446-5" aria-hidden="true" tabindex="-1"></a>  U <span class="ot">&lt;-</span> <span class="fu">sum</span>( <span class="fu">dnorm</span>(y,muy,<span class="dv">1</span>,<span class="at">log=</span><span class="cn">TRUE</span>) ) <span class="sc">+</span> <span class="fu">sum</span>( <span class="fu">dnorm</span>(x,mux,<span class="dv">1</span>,<span class="at">log=</span><span class="cn">TRUE</span>) ) <span class="sc">+</span></span>
<span id="cb446-6"><a href="9-3-hamiltonian-monte-carlo.html#cb446-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dnorm</span>(muy,a,b,<span class="at">log=</span><span class="cn">TRUE</span>) <span class="sc">+</span> <span class="fu">dnorm</span>(mux,k,d,<span class="at">log=</span><span class="cn">TRUE</span>)</span>
<span id="cb446-7"><a href="9-3-hamiltonian-monte-carlo.html#cb446-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="sc">-</span>U )</span>
<span id="cb446-8"><a href="9-3-hamiltonian-monte-carlo.html#cb446-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="9-3-hamiltonian-monte-carlo.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gradient function</span></span>
<span id="cb447-2"><a href="9-3-hamiltonian-monte-carlo.html#cb447-2" aria-hidden="true" tabindex="-1"></a><span class="co"># need vector of partial derivatives of U with respect to vector q</span></span>
<span id="cb447-3"><a href="9-3-hamiltonian-monte-carlo.html#cb447-3" aria-hidden="true" tabindex="-1"></a>U_gradient <span class="ot">&lt;-</span> <span class="cf">function</span>( q , <span class="at">a=</span><span class="dv">0</span> , <span class="at">b=</span><span class="dv">1</span> , <span class="at">k=</span><span class="dv">0</span> , <span class="at">d=</span><span class="dv">1</span> ) {</span>
<span id="cb447-4"><a href="9-3-hamiltonian-monte-carlo.html#cb447-4" aria-hidden="true" tabindex="-1"></a>  muy <span class="ot">&lt;-</span> q[<span class="dv">1</span>]</span>
<span id="cb447-5"><a href="9-3-hamiltonian-monte-carlo.html#cb447-5" aria-hidden="true" tabindex="-1"></a>  mux <span class="ot">&lt;-</span> q[<span class="dv">2</span>]</span>
<span id="cb447-6"><a href="9-3-hamiltonian-monte-carlo.html#cb447-6" aria-hidden="true" tabindex="-1"></a>  G1 <span class="ot">&lt;-</span> <span class="fu">sum</span>( y <span class="sc">-</span> muy ) <span class="sc">+</span> (a <span class="sc">-</span> muy)<span class="sc">/</span>b<span class="sc">^</span><span class="dv">2</span> <span class="co">#dU/dmuy</span></span>
<span id="cb447-7"><a href="9-3-hamiltonian-monte-carlo.html#cb447-7" aria-hidden="true" tabindex="-1"></a>  G2 <span class="ot">&lt;-</span> <span class="fu">sum</span>( x <span class="sc">-</span> mux ) <span class="sc">+</span> (k <span class="sc">-</span> mux)<span class="sc">/</span>d<span class="sc">^</span><span class="dv">2</span> <span class="co">#dU/dmux</span></span>
<span id="cb447-8"><a href="9-3-hamiltonian-monte-carlo.html#cb447-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">c</span>( <span class="sc">-</span>G1 , <span class="sc">-</span>G2 ) ) <span class="co"># negative bc energy is neg-log-prob</span></span>
<span id="cb447-9"><a href="9-3-hamiltonian-monte-carlo.html#cb447-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb447-10"><a href="9-3-hamiltonian-monte-carlo.html#cb447-10" aria-hidden="true" tabindex="-1"></a><span class="co"># test data</span></span>
<span id="cb447-11"><a href="9-3-hamiltonian-monte-carlo.html#cb447-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb447-12"><a href="9-3-hamiltonian-monte-carlo.html#cb447-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>)</span>
<span id="cb447-13"><a href="9-3-hamiltonian-monte-carlo.html#cb447-13" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>)</span>
<span id="cb447-14"><a href="9-3-hamiltonian-monte-carlo.html#cb447-14" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(x))</span>
<span id="cb447-15"><a href="9-3-hamiltonian-monte-carlo.html#cb447-15" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">scale</span>(y))</span></code></pre></div>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="9-3-hamiltonian-monte-carlo.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shape) <span class="co"># for fancy arrows</span></span>
<span id="cb448-2"><a href="9-3-hamiltonian-monte-carlo.html#cb448-2" aria-hidden="true" tabindex="-1"></a>Q <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb448-3"><a href="9-3-hamiltonian-monte-carlo.html#cb448-3" aria-hidden="true" tabindex="-1"></a>Q<span class="sc">$</span>q <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>,<span class="fl">0.2</span>)</span>
<span id="cb448-4"><a href="9-3-hamiltonian-monte-carlo.html#cb448-4" aria-hidden="true" tabindex="-1"></a>pr <span class="ot">&lt;-</span> <span class="fl">0.3</span></span>
<span id="cb448-5"><a href="9-3-hamiltonian-monte-carlo.html#cb448-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>( <span class="cn">NULL</span> , <span class="at">ylab=</span><span class="st">&quot;muy&quot;</span> , <span class="at">xlab=</span><span class="st">&quot;mux&quot;</span> , <span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span>pr,pr) , <span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span>pr,pr) )</span>
<span id="cb448-6"><a href="9-3-hamiltonian-monte-carlo.html#cb448-6" aria-hidden="true" tabindex="-1"></a>step <span class="ot">&lt;-</span> <span class="fl">0.03</span></span>
<span id="cb448-7"><a href="9-3-hamiltonian-monte-carlo.html#cb448-7" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">11</span> <span class="co"># 0.03/28 for U-turns — 11 for working example</span></span>
<span id="cb448-8"><a href="9-3-hamiltonian-monte-carlo.html#cb448-8" aria-hidden="true" tabindex="-1"></a>n_samples <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb448-9"><a href="9-3-hamiltonian-monte-carlo.html#cb448-9" aria-hidden="true" tabindex="-1"></a>path_col <span class="ot">&lt;-</span> rethinking<span class="sc">::</span><span class="fu">col.alpha</span>(<span class="st">&quot;black&quot;</span>,<span class="fl">0.5</span>)</span>
<span id="cb448-10"><a href="9-3-hamiltonian-monte-carlo.html#cb448-10" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>( Q<span class="sc">$</span>q[<span class="dv">1</span>] , Q<span class="sc">$</span>q[<span class="dv">2</span>] , <span class="at">pch=</span><span class="dv">4</span> , <span class="at">col=</span><span class="st">&quot;black&quot;</span> )</span>
<span id="cb448-11"><a href="9-3-hamiltonian-monte-carlo.html#cb448-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_samples ) {</span>
<span id="cb448-12"><a href="9-3-hamiltonian-monte-carlo.html#cb448-12" aria-hidden="true" tabindex="-1"></a>  Q <span class="ot">&lt;-</span> rethinking<span class="sc">::</span><span class="fu">HMC2</span>( U , U_gradient , step , L , Q<span class="sc">$</span>q )</span>
<span id="cb448-13"><a href="9-3-hamiltonian-monte-carlo.html#cb448-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( n_samples <span class="sc">&lt;</span> <span class="dv">10</span> ) {</span>
<span id="cb448-14"><a href="9-3-hamiltonian-monte-carlo.html#cb448-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ( j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>L ) {</span>
<span id="cb448-15"><a href="9-3-hamiltonian-monte-carlo.html#cb448-15" aria-hidden="true" tabindex="-1"></a>      K0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(Q<span class="sc">$</span>ptraj[j,]<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">2</span> <span class="co"># kinetic energy</span></span>
<span id="cb448-16"><a href="9-3-hamiltonian-monte-carlo.html#cb448-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines</span>( Q<span class="sc">$</span>traj[j<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>),<span class="dv">1</span>] , Q<span class="sc">$</span>traj[j<span class="sc">:</span>(j<span class="sc">+</span><span class="dv">1</span>),<span class="dv">2</span>] , <span class="at">col=</span>path_col , <span class="at">lwd=</span><span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>K0 )</span>
<span id="cb448-17"><a href="9-3-hamiltonian-monte-carlo.html#cb448-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb448-18"><a href="9-3-hamiltonian-monte-carlo.html#cb448-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>( Q<span class="sc">$</span>traj[<span class="dv">1</span><span class="sc">:</span>L<span class="sc">+</span><span class="dv">1</span>,] , <span class="at">pch=</span><span class="dv">16</span> , <span class="at">col=</span><span class="st">&quot;white&quot;</span> , <span class="at">cex=</span><span class="fl">0.35</span> )</span>
<span id="cb448-19"><a href="9-3-hamiltonian-monte-carlo.html#cb448-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Arrows</span>( Q<span class="sc">$</span>traj[L,<span class="dv">1</span>] , Q<span class="sc">$</span>traj[L,<span class="dv">2</span>] , Q<span class="sc">$</span>traj[L<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span>] , Q<span class="sc">$</span>traj[L<span class="sc">+</span><span class="dv">1</span>,<span class="dv">2</span>] ,</span>
<span id="cb448-20"><a href="9-3-hamiltonian-monte-carlo.html#cb448-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">arr.length=</span><span class="fl">0.35</span> , <span class="at">arr.adj =</span> <span class="fl">0.7</span> )</span>
<span id="cb448-21"><a href="9-3-hamiltonian-monte-carlo.html#cb448-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">text</span>( Q<span class="sc">$</span>traj[L<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span>] , Q<span class="sc">$</span>traj[L<span class="sc">+</span><span class="dv">1</span>,<span class="dv">2</span>] , i , <span class="at">cex=</span><span class="fl">0.8</span> , <span class="at">pos=</span><span class="dv">4</span> , <span class="at">offset=</span><span class="fl">0.4</span> )</span>
<span id="cb448-22"><a href="9-3-hamiltonian-monte-carlo.html#cb448-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb448-23"><a href="9-3-hamiltonian-monte-carlo.html#cb448-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">points</span>( Q<span class="sc">$</span>traj[L<span class="sc">+</span><span class="dv">1</span>,<span class="dv">1</span>] , Q<span class="sc">$</span>traj[L<span class="sc">+</span><span class="dv">1</span>,<span class="dv">2</span>] , <span class="at">pch=</span><span class="fu">ifelse</span>( Q<span class="sc">$</span>accept<span class="sc">==</span><span class="dv">1</span> , <span class="dv">16</span> , <span class="dv">1</span> ) ,</span>
<span id="cb448-24"><a href="9-3-hamiltonian-monte-carlo.html#cb448-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">col=</span><span class="fu">ifelse</span>( <span class="fu">abs</span>(Q<span class="sc">$</span>dH)<span class="sc">&gt;</span><span class="fl">0.1</span> , <span class="st">&quot;red&quot;</span> , <span class="st">&quot;black&quot;</span> ) )</span>
<span id="cb448-25"><a href="9-3-hamiltonian-monte-carlo.html#cb448-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="09_markov_chain_monte_carlo_files/figure-html/9.7-1.png" width="672" /></p>
<p>Let’s tour through the <code>HMC2</code> function in <code>rethinking</code>:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="9-3-hamiltonian-monte-carlo.html#cb449-1" aria-hidden="true" tabindex="-1"></a>HMC2 <span class="ot">&lt;-</span> <span class="cf">function</span> (U, grad_U, epsilon, L, current_q) {</span>
<span id="cb449-2"><a href="9-3-hamiltonian-monte-carlo.html#cb449-2" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">=</span> current_q</span>
<span id="cb449-3"><a href="9-3-hamiltonian-monte-carlo.html#cb449-3" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(q),<span class="dv">0</span>,<span class="dv">1</span>) <span class="co"># random flick - p is momentum.</span></span>
<span id="cb449-4"><a href="9-3-hamiltonian-monte-carlo.html#cb449-4" aria-hidden="true" tabindex="-1"></a>  current_p <span class="ot">=</span> p</span>
<span id="cb449-5"><a href="9-3-hamiltonian-monte-carlo.html#cb449-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make a half step for momentum at the beginning</span></span>
<span id="cb449-6"><a href="9-3-hamiltonian-monte-carlo.html#cb449-6" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> p <span class="sc">-</span> epsilon <span class="sc">*</span> <span class="fu">grad_U</span>(q) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb449-7"><a href="9-3-hamiltonian-monte-carlo.html#cb449-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># initialize bookkeeping - saves trajectory</span></span>
<span id="cb449-8"><a href="9-3-hamiltonian-monte-carlo.html#cb449-8" aria-hidden="true" tabindex="-1"></a>  qtraj <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>,<span class="at">nrow=</span>L<span class="sc">+</span><span class="dv">1</span>,<span class="at">ncol=</span><span class="fu">length</span>(q))</span>
<span id="cb449-9"><a href="9-3-hamiltonian-monte-carlo.html#cb449-9" aria-hidden="true" tabindex="-1"></a>  ptraj <span class="ot">&lt;-</span> qtraj</span>
<span id="cb449-10"><a href="9-3-hamiltonian-monte-carlo.html#cb449-10" aria-hidden="true" tabindex="-1"></a>  qtraj[<span class="dv">1</span>,] <span class="ot">&lt;-</span> current_q</span>
<span id="cb449-11"><a href="9-3-hamiltonian-monte-carlo.html#cb449-11" aria-hidden="true" tabindex="-1"></a>  ptraj[<span class="dv">1</span>,] <span class="ot">&lt;-</span> p</span>
<span id="cb449-12"><a href="9-3-hamiltonian-monte-carlo.html#cb449-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p><code>L</code> steps are taken, using the gradient to compute a linear appoximation of the log-posterior surface at each point.</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="9-3-hamiltonian-monte-carlo.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Alternate full steps for position and momentum</span></span>
<span id="cb450-2"><a href="9-3-hamiltonian-monte-carlo.html#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>L ) {</span>
<span id="cb450-3"><a href="9-3-hamiltonian-monte-carlo.html#cb450-3" aria-hidden="true" tabindex="-1"></a>  q <span class="ot">=</span> q <span class="sc">+</span> epsilon <span class="sc">*</span> p <span class="co"># Full step for the position</span></span>
<span id="cb450-4"><a href="9-3-hamiltonian-monte-carlo.html#cb450-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make a full step for the momentum, except at end of trajectory</span></span>
<span id="cb450-5"><a href="9-3-hamiltonian-monte-carlo.html#cb450-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ( i<span class="sc">!=</span>L ) {</span>
<span id="cb450-6"><a href="9-3-hamiltonian-monte-carlo.html#cb450-6" aria-hidden="true" tabindex="-1"></a>    p <span class="ot">=</span> p <span class="sc">-</span> epsilon <span class="sc">*</span> <span class="fu">grad_U</span>(q)</span>
<span id="cb450-7"><a href="9-3-hamiltonian-monte-carlo.html#cb450-7" aria-hidden="true" tabindex="-1"></a>    ptraj[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> p</span>
<span id="cb450-8"><a href="9-3-hamiltonian-monte-carlo.html#cb450-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb450-9"><a href="9-3-hamiltonian-monte-carlo.html#cb450-9" aria-hidden="true" tabindex="-1"></a>    qtraj[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> q</span>
<span id="cb450-10"><a href="9-3-hamiltonian-monte-carlo.html#cb450-10" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="9-3-hamiltonian-monte-carlo.html#cb451-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make a half step for momentum at the end</span></span>
<span id="cb451-2"><a href="9-3-hamiltonian-monte-carlo.html#cb451-2" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> p <span class="sc">-</span> epsilon <span class="sc">*</span> <span class="fu">grad_U</span>(q) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb451-3"><a href="9-3-hamiltonian-monte-carlo.html#cb451-3" aria-hidden="true" tabindex="-1"></a>  ptraj[L<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> p</span>
<span id="cb451-4"><a href="9-3-hamiltonian-monte-carlo.html#cb451-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Negate momentum at end of trajectory to make the proposal symmetric</span></span>
<span id="cb451-5"><a href="9-3-hamiltonian-monte-carlo.html#cb451-5" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">=</span> <span class="sc">-</span>p</span>
<span id="cb451-6"><a href="9-3-hamiltonian-monte-carlo.html#cb451-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Evaluate potential and kinetic energies at start and end of trajectory</span></span>
<span id="cb451-7"><a href="9-3-hamiltonian-monte-carlo.html#cb451-7" aria-hidden="true" tabindex="-1"></a>  current_U <span class="ot">=</span> <span class="fu">U</span>(current_q)</span>
<span id="cb451-8"><a href="9-3-hamiltonian-monte-carlo.html#cb451-8" aria-hidden="true" tabindex="-1"></a>  current_K <span class="ot">=</span> <span class="fu">sum</span>(current_p<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb451-9"><a href="9-3-hamiltonian-monte-carlo.html#cb451-9" aria-hidden="true" tabindex="-1"></a>  proposed_U <span class="ot">=</span> <span class="fu">U</span>(q)</span>
<span id="cb451-10"><a href="9-3-hamiltonian-monte-carlo.html#cb451-10" aria-hidden="true" tabindex="-1"></a>  proposed_K <span class="ot">=</span> <span class="fu">sum</span>(p<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb451-11"><a href="9-3-hamiltonian-monte-carlo.html#cb451-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Accept or reject the state at end of trajectory, returning either</span></span>
<span id="cb451-12"><a href="9-3-hamiltonian-monte-carlo.html#cb451-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the position at the end of the trajectory or the initial position</span></span>
<span id="cb451-13"><a href="9-3-hamiltonian-monte-carlo.html#cb451-13" aria-hidden="true" tabindex="-1"></a>  accept <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb451-14"><a href="9-3-hamiltonian-monte-carlo.html#cb451-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> <span class="fu">exp</span>(current_U<span class="sc">-</span>proposed_U<span class="sc">+</span>current_K<span class="sc">-</span>proposed_K)) {</span>
<span id="cb451-15"><a href="9-3-hamiltonian-monte-carlo.html#cb451-15" aria-hidden="true" tabindex="-1"></a>    new_q <span class="ot">&lt;-</span> q <span class="co"># accept</span></span>
<span id="cb451-16"><a href="9-3-hamiltonian-monte-carlo.html#cb451-16" aria-hidden="true" tabindex="-1"></a>    accept <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb451-17"><a href="9-3-hamiltonian-monte-carlo.html#cb451-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> new_q <span class="ot">&lt;-</span> current_q <span class="co"># reject</span></span>
<span id="cb451-18"><a href="9-3-hamiltonian-monte-carlo.html#cb451-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>( <span class="at">q=</span>new_q, <span class="at">traj=</span>qtraj, <span class="at">ptraj=</span>ptraj, <span class="at">accept=</span>accept ))</span>
<span id="cb451-19"><a href="9-3-hamiltonian-monte-carlo.html#cb451-19" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<div class="figure">
<img src="slides/L10/44.png" alt="Problem is that there's stuff to pick, namely the step size (the length of time we run a segment). You want basically the biggest step size, but if you make it too big, you can overshoot the shape. THen you need to choose the number of steps you'll take in each trajectory. If you choose bad values for those, you'll have a bad time. In general it's not as bad as it gets in a 2D Gaussian. Since it's a parabolic bowl, you can get these parabolic loops. In the long run it'll still work, but it's super inefficient. How do you fix it? Choose good values for the tuning parameters, which is annoying." width="80%" />
<p class="caption marginnote shownote">
Problem is that there’s stuff to pick, namely the step size (the length of time we run a segment). You want basically the biggest step size, but if you make it too big, you can overshoot the shape. THen you need to choose the number of steps you’ll take in each trajectory. If you choose bad values for those, you’ll have a bad time. In general it’s not as bad as it gets in a 2D Gaussian. Since it’s a parabolic bowl, you can get these parabolic loops. In the long run it’ll still work, but it’s super inefficient. How do you fix it? Choose good values for the tuning parameters, which is annoying.
</p>
</div>
<p><img src="slides/L10/45.png" width="80%" /></p>
<div class="figure">
<img src="slides/L10/46.png" alt="Here's the simulation where it resembles an Ouroboros. Since you don't know the distribution, it's hard to say what the best tuning parameters are." width="80%" />
<p class="caption marginnote shownote">
Here’s the simulation where it resembles an Ouroboros. Since you don’t know the distribution, it’s hard to say what the best tuning parameters are.
</p>
</div>
<div class="figure">
<img src="slides/L10/47.png" alt="Stan does two things: 1) Warm up phase, then maximises the step size. 2) Runs the NUTS2 algorithm. " width="80%" />
<p class="caption marginnote shownote">
Stan does two things: 1) Warm up phase, then maximises the step size. 2) Runs the NUTS2 algorithm.
</p>
</div>
<p><img src="slides/L10/48.png" width="80%" /></p>
<div class="figure">
<img src="slides/L10/49.png" alt="Here's NUTS. It runs the simulation in both directions in time. It imagines a simulation that loops back on itself, and runs it backwards from teh starting point, and goes backdwards at the same time, but when it sees itself turning around, it stops. This means it figures out a good number of leapfrog steps for each trajectory. So you don't need to make a bunch of decisions." width="80%" />
<p class="caption marginnote shownote">
Here’s NUTS. It runs the simulation in both directions in time. It imagines a simulation that loops back on itself, and runs it backwards from teh starting point, and goes backdwards at the same time, but when it sees itself turning around, it stops. This means it figures out a good number of leapfrog steps for each trajectory. So you don’t need to make a bunch of decisions.
</p>
</div>
<div class="figure">
<img src="slides/L10/50.png" alt="One of the mathematicians working with Metropolis. Built mechnical MCMC simulators. Also did important work in biology. Could run Stan on anything you like. " width="80%" />
<p class="caption marginnote shownote">
One of the mathematicians working with Metropolis. Built mechnical MCMC simulators. Also did important work in biology. Could run Stan on anything you like.
</p>
</div>
<p><img src="slides/L10/51.png" width="80%" /></p>
<p><img src="slides/L10/52.png" width="80%" /></p>
<div class="figure">
<img src="slides/L10/53.png" alt="There are still problems. If you have multiple separated hills, like in factored analytical models, the wait between hills can be long indeed. In my experience you handle this by changing the geometry of the model. We get these with item-response theory models." width="80%" />
<p class="caption marginnote shownote">
There are still problems. If you have multiple separated hills, like in factored analytical models, the wait between hills can be long indeed. In my experience you handle this by changing the geometry of the model. We get these with item-response theory models.
</p>
</div>
<div class="figure">
<img src="slides/L10/54.png" alt="SWant you to recognise a bad chain when you see it." width="80%" />
<p class="caption marginnote shownote">
SWant you to recognise a bad chain when you see it.
</p>
</div>
</div>
<p style="text-align: center;">
<a href="9-2-metropolis-algorithm.html"><button class="btn btn-default">Previous</button></a>
<a href="9-4-easy-hmc-ulam.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>



</body>
</html>
